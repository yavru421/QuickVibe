(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[7770],{81615:(e,t,n)=>{"use strict";n.d(t,{VT:()=>l});var i=n(80281),s=n(7865);const o=["cm-string","cm-overlay","cm-searching"],r=["CodeMirror-selectedtext"];class a{static search(e,t){if(!(t instanceof Node))return console.warn("Unable to search with HTMLSearchEngine the provided object.",t),Promise.resolve([]);e.global||(e=new RegExp(e.source,e.flags+"g"));const n=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:n=>{let i=n.parentElement;for(;i!==t;){if(i.nodeName in a.UNSUPPORTED_ELEMENTS)return NodeFilter.FILTER_REJECT;i=i.parentElement}return e.test(n.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let s=null;for(;null!==(s=i.nextNode());){e.lastIndex=0;let t=null;for(;null!==(t=e.exec(s.textContent));)n.push({text:t[0],position:t.index,node:s})}return Promise.resolve(n)}}a.UNSUPPORTED_ELEMENTS={BASE:!0,HEAD:!0,LINK:!0,META:!0,STYLE:!0,TITLE:!0,BODY:!0,AREA:!0,AUDIO:!0,IMG:!0,MAP:!0,TRACK:!0,VIDEO:!0,APPLET:!0,EMBED:!0,IFRAME:!0,NOEMBED:!0,OBJECT:!0,PARAM:!0,PICTURE:!0,SOURCE:!0,CANVAS:!0,NOSCRIPT:!0,SCRIPT:!0,SVG:!0};class l extends s.Y{constructor(){super(...arguments),this.isReadOnly=!0,this._matches=[],this._mutationObserver=new MutationObserver(this._onWidgetChanged.bind(this)),this._markNodes=new Array}static isApplicable(e){return e instanceof i.Widget}static createNew(e,t,n){return new l(e)}get currentMatchIndex(){return this._currentMatchIndex>=0?this._currentMatchIndex:null}get currentMatch(){var e;return null!==(e=this._matches[this._currentMatchIndex])&&void 0!==e?e:null}get matches(){return this._matches?this._matches.map((e=>Object.assign({},e))):this._matches}get matchesCount(){return this._matches.length}clearHighlight(){return this._currentMatchIndex>=0&&this._markNodes[this._currentMatchIndex].classList.remove(...r),this._currentMatchIndex=-1,Promise.resolve()}dispose(){this.isDisposed||(this.endQuery().catch((e=>{console.error("Failed to end search query.",e)})),super.dispose())}async highlightNext(e){var t;return null!==(t=this._highlightNext(!1,null==e||e))&&void 0!==t?t:void 0}async highlightPrevious(e){var t;return null!==(t=this._highlightNext(!0,null==e||e))&&void 0!==t?t:void 0}async replaceCurrentMatch(e,t){return Promise.resolve(!1)}async replaceAllMatches(e){return Promise.resolve(!1)}async startQuery(e,t={}){if(await this.endQuery(),this._query=e,null===e)return Promise.resolve();const n=await a.search(e,this.widget.node);let i=0;for(;i<n.length;){let e=n[i].node,t=e.parentNode,s=[n[i]];for(;++i<n.length&&n[i].node===e;)s.unshift(n[i]);const r=s.map((n=>{const i=document.createElement("mark");i.classList.add(...o),i.textContent=n.text;const s=e.splitText(n.position);return s.textContent=s.textContent.slice(n.text.length),t.insertBefore(i,s),i}));for(let e=r.length-1;e>=0;e--)this._markNodes.push(r[e])}this._mutationObserver.observe(this.widget.node,{attributes:!1,characterData:!0,childList:!0,subtree:!0}),this._matches=n}async endQuery(){this._mutationObserver.disconnect(),this._markNodes.forEach((e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()})),this._markNodes=[],this._matches=[],this._currentMatchIndex=-1}_highlightNext(e,t){if(0===this._matches.length)return null;if(-1===this._currentMatchIndex?this._currentMatchIndex=e?this.matches.length-1:0:(this._markNodes[this._currentMatchIndex].classList.remove(...r),this._currentMatchIndex=e?this._currentMatchIndex-1:this._currentMatchIndex+1,t&&(this._currentMatchIndex<0||this._currentMatchIndex>=this._matches.length)&&(this._currentMatchIndex=(this._currentMatchIndex+this._matches.length)%this._matches.length)),this._currentMatchIndex>=0&&this._currentMatchIndex<this._matches.length){const t=this._markNodes[this._currentMatchIndex];return t.classList.add(...r),function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.left>=0&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(t)||t.scrollIntoView(e),t.focus(),this._matches[this._currentMatchIndex]}return this._currentMatchIndex=-1,null}async _onWidgetChanged(e,t){this._currentMatchIndex=-1,await this.startQuery(this._query),this._stateChanged.emit()}}},7865:(e,t,n)=>{"use strict";n.d(t,{Y:()=>s});var i=n(30427);class s{constructor(e){this.widget=e,this._stateChanged=new i.Signal(this),this._filtersChanged=new i.Signal(this),this._disposed=!1}get stateChanged(){return this._stateChanged}get filtersChanged(){return this._filtersChanged}get currentMatchIndex(){return null}get isDisposed(){return this._disposed}get matchesCount(){return null}dispose(){this._disposed||(this._disposed=!0,i.Signal.clearData(this))}getInitialQuery(){return""}getFilters(){return{}}static preserveCase(e,t){return e.toUpperCase()===e?t.toUpperCase():e.toLowerCase()===e?t.toLowerCase():o(e)===e?o(t):t}}function o([e="",...t]){return e.toUpperCase()+""+t.join("").toLowerCase()}},17770:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CellList:()=>C,CellTypeSwitcher:()=>b,CommandEditStatus:()=>P,ExecutionIndicator:()=>E,ExecutionIndicatorComponent:()=>x,INotebookCellExecutor:()=>_t,INotebookTools:()=>mt,INotebookTracker:()=>vt,INotebookWidgetFactory:()=>ft,KernelError:()=>f,Notebook:()=>Qe,NotebookActions:()=>m,NotebookAdapter:()=>pe,NotebookHistory:()=>M,NotebookModel:()=>N,NotebookModelFactory:()=>D,NotebookPanel:()=>Xe,NotebookSearchProvider:()=>rt,NotebookToCFactory:()=>gt,NotebookToCModel:()=>ut,NotebookTools:()=>Se,NotebookTracker:()=>Ct,NotebookTrustStatus:()=>wt,NotebookViewModel:()=>Pe,NotebookWidgetFactory:()=>bt,NotebookWindowedLayout:()=>Oe,RunningStatus:()=>ct,StaticNotebook:()=>Ge,ToolbarItems:()=>y,getIdForHeading:()=>pt,runCell:()=>g,setCellExecutor:()=>v});var i=n(18504),s=n(24877),o=n(42474),r=n(62246),a=n(90182),l=n(45945),c=n(68211),d=n(30427),h=n(59407),u=n.n(h);async function g({cell:e,notebook:t,notebookConfig:n,onCellExecuted:s,onCellExecutionScheduled:r,sessionContext:c,sessionDialogs:d,translator:h}){var u;const g=(h=null!=h?h:a.nullTranslator).load("jupyterlab");switch(e.model.type){case"markdown":e.rendered=!0,e.inputHidden=!1,s({cell:e,success:!0});break;case"code":if(c){if(c.isTerminating){await(0,i.showDialog)({title:g.__("Kernel Terminating"),body:g.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",null===(u=c.session)||void 0===u?void 0:u.path),buttons:[i.Dialog.okButton()]});break}if(c.pendingInput)return await(0,i.showDialog)({title:g.__("Cell not executed due to pending input"),body:g.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[i.Dialog.okButton()]}),!1;if(c.hasNoKernel&&await c.startKernel()&&d&&await d.selectKernel(c),c.hasNoKernel)return e.model.sharedModel.transact((()=>{e.model.clearExecution()})),!0;const a=t.deletedCells;r({cell:e});let h=!1;try{const i=await o.Yr.execute(e,c,{deletedCells:a,recordTiming:n.recordTiming});a.splice(0,a.length),h=(()=>{if(e.isDisposed)return!1;if(!i)return!0;if("ok"===i.content.status){const n=i.content;return n.payload&&n.payload.length&&function(e,t,n){var i;const s=null===(i=e.payload)||void 0===i?void 0:i.filter((e=>"set_next_input"===e.source))[0];if(!s)return;const o=s.text;if(s.replace)return void n.model.sharedModel.setSource(o);const r=t.sharedModel,a=t.cells,c=(0,l.findIndex)(a,(e=>e===n.model));-1===c?r.insertCell(r.cells.length,{cell_type:"code",source:o,metadata:{trusted:!1}}):r.insertCell(c+1,{cell_type:"code",source:o,metadata:{trusted:!1}})}(n,t,e),!0}throw new f(i.content)})()}catch(t){if(!e.isDisposed&&!t.message.startsWith("Canceled"))throw s({cell:e,success:!1,error:t}),t;h=!1}return h&&s({cell:e,success:!0}),h}e.model.sharedModel.transact((()=>{e.model.clearExecution()}),!1)}return Promise.resolve(!0)}const p="application/vnd.jupyter.cells";class f extends Error{constructor(e){const t=e,n=t.ename,i=t.evalue;super(`KernelReplyNotOK: ${n} ${i}`),this.errorName=n,this.errorValue=i,this.traceback=t.traceback,Object.setPrototypeOf(this,f.prototype)}}class m{static get executed(){return _.executed}static get executionScheduled(){return _.executionScheduled}static get selectionExecuted(){return _.selectionExecuted}static get outputCleared(){return _.outputCleared}constructor(){}}function v(e){if(_.executor)throw new Error("Cell executor can only be set once.");_.executor=e}var _;!function(e){function t(e,t){if(!e.model||!e.activeCell)return;const n=_.getState(e),i=e.widgets.findIndex((t=>e.isSelectedOrActive(t)));let s=e.widgets.slice(i+1).findIndex((t=>!e.isSelectedOrActive(t)));s>=0?s+=i+1:s=e.model.cells.length,t>0?e.moveCell(i,s,s-i):e.moveCell(i,i+t,s-i),_.handleState(e,n,!0)}function n(e,t="below",n,i=!1){if(!e.model||!e.activeCell)return;const s=_.getState(e),o=e.model;e.mode="command";let r=0;const a=e.activeCellIndex;o.sharedModel.transact((()=>{switch(t){case"below":r=e.activeCellIndex+1;break;case"belowSelected":e.widgets.forEach(((t,n)=>{e.isSelectedOrActive(t)&&(r=n+1)}));break;case"above":r=e.activeCellIndex;break;case"replace":{const t=[];e.widgets.forEach(((n,i)=>{const s=!1!==n.model.sharedModel.getMetadata("deletable");e.isSelectedOrActive(n)&&s&&t.push(i)})),t.length>0&&t.reverse().forEach((e=>{o.sharedModel.deleteCell(e)})),r=t[0];break}}o.sharedModel.insertCells(r,n.map((t=>(t.id="code"===t.cell_type&&"cut"===e.lastClipboardInteraction&&"string"==typeof t.id?t.id:void 0,t))))})),e.activeCellIndex=a+n.length,e.deselectAll(),i&&(e.lastClipboardInteraction="paste"),_.handleState(e,s,!0)}function d(t,n,i){const s=(0,l.findIndex)(i.widgets,((e,n)=>t.model.id===e.model.id));if(-1===s)return-1;if(!i.widgets.length)return s+1;let r=e.getHeadingInfo(t);if(t.isHidden||!(t instanceof o.KI)||!r.isHeading)return s+1;let a,c=!1,d=0;for(a=s+1;a<i.widgets.length;a++){let t=i.widgets[a],s=e.getHeadingInfo(t);if(s.isHeading&&s.headingLevel<=r.headingLevel){a-=1;break}c&&s.isHeading&&s.headingLevel<=d&&(c=!1),n||c?t.setHidden(!0):(s.collapsed&&s.isHeading&&(c=!0,d=s.headingLevel),t.setHidden(!1))}return a===i.widgets.length?t.numberChildNodes=a-s-1:t.numberChildNodes=a-s,e.setCellCollapse(t,n),a+1}function u(e){if(!(e instanceof o.KI))return{isHeading:!1,headingLevel:7};let t=e.headingInfo.level;return{isHeading:t>0,headingLevel:t,collapsed:e.headingCollapsed}}async function g(e,t={waitUntilReady:!0,preventScroll:!1}){const{activeCell:n}=e,{waitUntilReady:i,preventScroll:s}=t;n&&(i&&await n.ready,e.isDisposed||n.isDisposed||n.node.focus({preventScroll:s}))}e.splitCell=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.mode="edit",e.deselectAll();const n=e.model,i=e.activeCellIndex,s=e.widgets[i],o=s.editor;if(!o)return;const r=o.getSelections(),a=s.model.sharedModel.getSource(),l=[0];let c=-1,d=-1;for(let e=0;e<r.length;e++)c=o.getOffsetAt(r[e].start),d=o.getOffsetAt(r[e].end),c<d?(l.push(c),l.push(d)):d<c?(l.push(d),l.push(c)):l.push(c);l.push(a.length);const h=l.length-1,u=l.slice(0,-1).map(((e,t)=>{const{cell_type:n,metadata:i,outputs:o}=s.model.sharedModel.toJSON();return{cell_type:n,metadata:i,source:a.slice(e,l[t+1]).replace(/^\n+/,"").replace(/\n+$/,""),outputs:t===h-1&&"code"===n?o:void 0}}));n.sharedModel.transact((()=>{n.sharedModel.deleteCell(i),n.sharedModel.insertCells(i,u)}));const g=c!==d?2:1;e.activeCellIndex=i+u.length-g,e.scrollToItem(e.activeCellIndex).then((()=>{var t;null===(t=e.activeCell)||void 0===t||t.editor.focus()})).catch((e=>{})),_.handleState(e,t)},e.mergeCells=function(e,t=!1){if(!e.model||!e.activeCell)return;const n=_.getState(e),i=[],r=[],a=e.model,l=a.cells,c=e.activeCell,d=e.activeCellIndex,h={};if(e.widgets.forEach(((t,n)=>{if(e.isSelectedOrActive(t)){i.push(t.model.sharedModel.getSource()),n!==d&&r.push(n);const e=t.model;if((0,s.MU)(e)||(0,s.xW)(e))for(const t of e.attachments.keys)h[t]=e.attachments.get(t).toJSON()}})),1===i.length)if(!0===t){if(0===d)return;const e=l.get(d-1);i.unshift(e.sharedModel.getSource()),r.push(d-1)}else if(!1===t){if(d===l.length-1)return;const e=l.get(d+1);i.push(e.sharedModel.getSource()),r.push(d+1)}e.deselectAll();const u=c.model.sharedModel,{cell_type:g,metadata:p}=u.toJSON();"code"===u.cell_type&&(p.trusted=!0);const f={cell_type:g,metadata:p,source:i.join("\n\n"),attachments:"markdown"===u.cell_type||"raw"===u.cell_type?h:void 0};a.sharedModel.transact((()=>{a.sharedModel.deleteCell(d),a.sharedModel.insertCell(d,f),r.sort(((e,t)=>t-e)).forEach((e=>{a.sharedModel.deleteCell(e)}))})),c instanceof o.KI&&(e.activeCell.rendered=!1),_.handleState(e,n)},e.deleteCells=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);_.deleteCells(e),_.handleState(e,t,!0)},e.insertAbove=function(e){if(!e.model)return;const t=_.getState(e),n=e.model,i=e.activeCell?e.activeCellIndex:0;n.sharedModel.insertCell(i,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex=i,e.deselectAll(),_.handleState(e,t,!0)},e.insertBelow=function(e){if(!e.model)return;const t=_.getState(e),n=e.model,i=e.activeCell?e.activeCellIndex+1:0;n.sharedModel.insertCell(i,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex=i,e.deselectAll(),_.handleState(e,t,!0)},e.moveDown=function(e){t(e,1)},e.moveUp=function(e){t(e,-1)},e.changeCellType=function(e,t,n){if(!e.model||!e.activeCell)return;const i=_.getState(e);_.changeCellType(e,t,n),_.handleState(e,i)},e.run=function(e,t,n,i){if(!e.model||!e.activeCell)return Promise.resolve(!1);const s=_.getState(e),o=_.runSelected(e,t,n,i);return _.handleRunState(e,s),o},e.runCells=function(e,t,n,i,s){if(!e.model)return Promise.resolve(!1);const o=_.getState(e),r=_.runCells(e,t,n,i,s);return _.handleRunState(e,o),r},e.runAndAdvance=async function(e,t,n,i){var s;if(!e.model||!e.activeCell)return Promise.resolve(!1);const o=_.getState(e),a=_.runSelected(e,t,n,i),l=e.model;return e.activeCellIndex===e.widgets.length-1?(l.sharedModel.insertCell(e.widgets.length,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===(null===(s=e.activeCell)||void 0===s?void 0:s.inViewport)&&await(0,r.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit"):e.activeCellIndex++,_.handleRunState(e,o,"center"),a},e.runAndInsert=async function(e,t,n,i){var s;if(!e.model||!e.activeCell)return Promise.resolve(!1);const o=_.getState(e),a=_.runSelected(e,t,n,i);return e.model.sharedModel.insertCell(e.activeCellIndex+1,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===(null===(s=e.activeCell)||void 0===s?void 0:s.inViewport)&&await(0,r.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit",_.handleRunState(e,o,"center"),a},e.runAll=function(e,t,n,i){if(!e.model||!e.activeCell)return Promise.resolve(!1);const s=_.getState(e),o=e.widgets.length,r=_.runCells(e,e.widgets,t,n,i);return e.activeCellIndex=o,e.deselectAll(),_.handleRunState(e,s),r},e.renderAllMarkdown=function(e){if(!e.model||!e.activeCell)return Promise.resolve(!1);const t=e.activeCellIndex,n=_.getState(e);if(e.widgets.forEach(((t,n)=>{"markdown"===t.model.type&&(e.select(t),e.activeCellIndex=n)})),"markdown"!==e.activeCell.model.type)return Promise.resolve(!0);const i=_.runSelected(e);return e.activeCellIndex=t,_.handleRunState(e,n),i},e.runAllAbove=function(e,t,n,i){const{activeCell:s,activeCellIndex:o,model:r}=e;if(!r||!s||o<1)return Promise.resolve(!1);const a=_.getState(e),l=_.runCells(e,e.widgets.slice(0,e.activeCellIndex),t,n,i);return e.deselectAll(),_.handleRunState(e,a),l},e.runAllBelow=function(e,t,n,i){if(!e.model||!e.activeCell)return Promise.resolve(!1);const s=_.getState(e),o=e.widgets.length,r=_.runCells(e,e.widgets.slice(e.activeCellIndex),t,n,i);return e.activeCellIndex=o,e.deselectAll(),_.handleRunState(e,s),r},e.replaceSelection=function(e,t){var n,i,s;e.model&&(null===(n=e.activeCell)||void 0===n?void 0:n.editor)&&(null===(s=(i=e.activeCell.editor).replaceSelection)||void 0===s||s.call(i,t))},e.selectAbove=function(e){if(!e.model||!e.activeCell)return;const t=e.layout.footer;if(t&&document.activeElement===t.node)return t.node.blur(),void(e.mode="command");if(0===e.activeCellIndex)return;let n=e.activeCellIndex-1;for(;n>=0;){const t=e.widgets[n];if(!t.inputHidden&&!t.isHidden)break;n-=1}const i=_.getState(e);e.activeCellIndex=n,e.deselectAll(),_.handleState(e,i,!0)},e.selectBelow=function(e){if(!e.model||!e.activeCell)return;let t=e.widgets.length-1;for(;e.widgets[t].isHidden||e.widgets[t].inputHidden;)t-=1;if(e.activeCellIndex===t){const t=e.layout.footer;return void(null==t||t.node.focus())}let n=e.activeCellIndex+1;for(;n<t;){let t=e.widgets[n];if(!t.inputHidden&&!t.isHidden)break;n+=1}const i=_.getState(e);e.activeCellIndex=n,e.deselectAll(),_.handleState(e,i,!0)},e.insertSameLevelHeadingAbove=async function(e){if(!e.model||!e.activeCell)return;let t=_.Headings.determineHeadingLevel(e.activeCell,e);-1==t?await _.Headings.insertHeadingAboveCellIndex(0,1,e):await _.Headings.insertHeadingAboveCellIndex(e.activeCellIndex,t,e)},e.insertSameLevelHeadingBelow=async function(e){if(!e.model||!e.activeCell)return;let t=_.Headings.determineHeadingLevel(e.activeCell,e);t=t>-1?t:1;let n=_.Headings.findLowerEqualLevelHeadingBelow(e.activeCell,e,!0);await _.Headings.insertHeadingAboveCellIndex(-1==n?e.model.cells.length:n,t,e)},e.selectHeadingAboveOrCollapseHeading=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);let n=u(e.activeCell);if(n.isHeading&&!n.collapsed)d(e.activeCell,!0,e);else{let t=_.Headings.findLowerEqualLevelParentHeadingAbove(e.activeCell,e,!0);t>-1&&(e.activeCellIndex=t)}e.deselectAll(),_.handleState(e,t,!0)},e.selectHeadingBelowOrExpandHeading=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);let n=u(e.activeCell);if(n.isHeading&&n.collapsed)d(e.activeCell,!1,e);else{let t=_.Headings.findHeadingBelow(e.activeCell,e,!0);t>-1&&(e.activeCellIndex=t)}e.deselectAll(),_.handleState(e,t,!0)},e.extendSelectionAbove=function(e,t=!1){if(!e.model||!e.activeCell)return;if(0===e.activeCellIndex)return;const n=_.getState(e);e.mode="command",t?e.extendContiguousSelectionTo(0):e.extendContiguousSelectionTo(e.activeCellIndex-1),_.handleState(e,n,!0)},e.extendSelectionBelow=function(e,t=!1){if(!e.model||!e.activeCell)return;if(e.activeCellIndex===e.widgets.length-1)return;const n=_.getState(e);e.mode="command",t?e.extendContiguousSelectionTo(e.widgets.length-1):e.extendContiguousSelectionTo(e.activeCellIndex+1),_.handleState(e,n,!0)},e.selectAll=function(e){e.model&&e.activeCell&&e.widgets.forEach((t=>{e.select(t)}))},e.deselectAll=function(e){e.model&&e.activeCell&&e.deselectAll()},e.copy=function(e){_.copyOrCut(e,!1)},e.cut=function(e){_.copyOrCut(e,!0)},e.paste=function(e,t="below"){const s=i.Clipboard.getInstance();s.hasData(p)&&(n(e,t,s.getData(p),!0),g(e))},e.duplicate=function(e,t="below"){const i=_.selectedCells(e);i&&0!==i.length&&n(e,t,i,!1)},e.undo=function(e){if(!e.model)return;const t=_.getState(e);e.mode="command",e.model.sharedModel.undo(),e.deselectAll(),_.handleState(e,t)},e.redo=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.mode="command",e.model.sharedModel.redo(),e.deselectAll(),_.handleState(e,t)},e.toggleAllLineNumbers=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e),n=e.editorConfig,i=!(n.code.lineNumbers&&n.markdown.lineNumbers&&n.raw.lineNumbers),s={code:{...n.code,lineNumbers:i},markdown:{...n.markdown,lineNumbers:i},raw:{...n.raw,lineNumbers:i}};e.editorConfig=s,_.handleState(e,t)},e.clearOutputs=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);let n=-1;for(const t of e.model.cells){const i=e.widgets[++n];e.isSelectedOrActive(i)&&"code"===t.type&&(t.sharedModel.transact((()=>{t.clearExecution(),i.outputHidden=!1}),!1),_.outputCleared.emit({notebook:e,cell:i}))}_.handleState(e,t,!0)},e.clearAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);let n=-1;for(const t of e.model.cells){const i=e.widgets[++n];"code"===t.type&&(t.sharedModel.transact((()=>{t.clearExecution(),i.outputHidden=!1}),!1),_.outputCleared.emit({notebook:e,cell:i}))}_.handleState(e,t,!0)},e.hideCode=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.inputHidden=!0)})),_.handleState(e,t)},e.showCode=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.inputHidden=!1)})),_.handleState(e,t)},e.hideAllCode=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.inputHidden=!0)})),_.handleState(e,t)},e.showAllCode=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.inputHidden=!1)})),_.handleState(e,t)},e.hideOutput=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputHidden=!0)})),_.handleState(e,t,!0)},e.showOutput=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputHidden=!1)})),_.handleState(e,t)},e.hideAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.outputHidden=!0)})),_.handleState(e,t,!0)},e.renderSideBySide=function(e){e.renderingLayout="side-by-side"},e.renderDefault=function(e){e.renderingLayout="default"},e.showAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.outputHidden=!1)})),_.handleState(e,t)},e.enableOutputScrolling=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputsScrolled=!0)})),_.handleState(e,t,!0)},e.disableOutputScrolling=function(e){if(!e.model||!e.activeCell)return;const t=_.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputsScrolled=!1)})),_.handleState(e,t)},e.selectLastRunCell=function(e){let t=null,n=null;e.widgets.forEach(((e,i)=>{if("code"===e.model.type){const s=e.model.getMetadata("execution");if(s&&c.JSONExt.isObject(s)&&void 0!==s["iopub.status.busy"]){const e=s["iopub.status.busy"].toString();if(e){const s=new Date(e);(!t||s>=t)&&(t=s,n=i)}}}})),null!==n&&(e.activeCellIndex=n)},e.setMarkdownHeader=function(e,t,n){if(!e.model||!e.activeCell)return;const i=_.getState(e),s=e.model.cells;t=Math.min(Math.max(t,1),6),e.widgets.forEach(((n,i)=>{e.isSelectedOrActive(n)&&_.setMarkdownHeader(s.get(i),t)})),_.changeCellType(e,"markdown",n),_.handleState(e,i)},e.collapseAllHeadings=function(t){const n=_.getState(t);for(const n of t.widgets)e.getHeadingInfo(n).isHeading&&(e.setHeadingCollapse(n,!0,t),e.setCellCollapse(n,!0));t.activeCellIndex=0,_.handleState(t,n,!0)},e.expandAllHeadings=function(t){for(const n of t.widgets)e.getHeadingInfo(n).isHeading&&(e.setHeadingCollapse(n,!1,t),e.setCellCollapse(n,!1))},e.expandParent=function e(t,n){let i=function(e,t){const n=(0,l.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(-1===n)return;if(n>=t.widgets.length)return;let i=u(t.widgets[n]);for(let e=n-1;e>=0;e--)if(e<t.widgets.length){let n=u(t.widgets[e]);if(n.isHeading&&n.headingLevel<i.headingLevel)return t.widgets[e]}}(t,n);i&&(u(i).collapsed||i.isHidden)&&(i.isHidden&&e(i,n),u(i).collapsed&&d(i,!1,n))},e.findNextParentHeading=function(e,t){let n=(0,l.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(-1===n)return-1;let i=u(e);for(n+=1;n<t.widgets.length;n++){let e=u(t.widgets[n]);if(e.isHeading&&e.headingLevel<=i.headingLevel)return n}return t.widgets.length},e.setHeadingCollapse=d,e.toggleCurrentHeadingCollapse=function(t){if(!t.activeCell||void 0===t.activeCellIndex)return;let n=e.getHeadingInfo(t.activeCell);n.isHeading&&e.setHeadingCollapse(t.activeCell,!n.collapsed,t),t.scrollToItem(t.activeCellIndex).catch((e=>{}))},e.setCellCollapse=function(e,t){e instanceof o.KI?e.headingCollapsed=t:e.setHidden(t)},e.getHeadingInfo=u,e.trust=function(e,t){const n=(t=t||a.nullTranslator).load("jupyterlab");if(!e.model)return Promise.resolve();const s=(0,l.every)(e.model.cells,(e=>e.trusted)),o=h.createElement("p",null,n.__("A trusted Jupyter notebook may execute hidden malicious code when you open it."),h.createElement("br",null),n.__('Selecting "Trust" will re-render this notebook in a trusted state.'),h.createElement("br",null),n.__("For more information, see")," ",h.createElement("a",{href:"https://jupyter-server.readthedocs.io/en/stable/operators/security.html",target:"_blank",rel:"noopener noreferrer"},n.__("the Jupyter security documentation")),".");return s?(0,i.showDialog)({body:n.__("Notebook is already trusted"),buttons:[i.Dialog.okButton()]}).then((()=>{})):(0,i.showDialog)({body:o,title:n.__("Trust this notebook?"),buttons:[i.Dialog.cancelButton(),i.Dialog.warnButton({label:n.__("Trust"),ariaLabel:n.__("Confirm Trusting this notebook")})]}).then((t=>{if(t.button.accept&&e.model)for(const t of e.model.cells)t.trusted=!0}))},e.focusActiveCell=g,e.accessPreviousHistory=async function(e){if(!e.notebookConfig.accessKernelHistory)return;const t=e.activeCell;if(t&&e.kernelHistory){const n=await e.kernelHistory.back(t);e.kernelHistory.updateEditor(t,n)}},e.accessNextHistory=async function(e){if(!e.notebookConfig.accessKernelHistory)return;const t=e.activeCell;if(t&&e.kernelHistory){const n=await e.kernelHistory.forward(t);e.kernelHistory.updateEditor(t,n)}}}(m||(m={})),function(e){function t(e){var t,n;return{wasFocused:e.node.contains(document.activeElement),activeCellId:null!==(n=null===(t=e.activeCell)||void 0===t?void 0:t.model.id)&&void 0!==n?n:null}}async function n(e,t,n=!1){const{activeCell:i,activeCellIndex:s}=e;n&&i&&await e.scrollToItem(s,"auto",0).catch((e=>{})),(t.wasFocused||"edit"===e.mode)&&e.activate()}function s(t,n,s,o,r){const l=n[-1];t.mode="command";let c=!1;return Promise.all(n.map((n=>{if("code"===n.model.type&&t.notebookConfig.enableKernelInitNotification&&s&&"initializing"===s.kernelDisplayStatus&&!c){c=!0;const e=(r=r||a.nullTranslator).load("jupyterlab");return i.Notification.emit(e.__(`Kernel '${s.kernelDisplayName}' for '${s.path}' is still initializing. You can run code cells when the kernel has initialized.`),"warning",{autoClose:!1}),Promise.resolve(!1)}return"code"===n.model.type&&t.notebookConfig.enableKernelInitNotification&&c?Promise.resolve(!1):async function(t,n,i,s,o){e.executor||console.warn("Requesting cell execution without any cell executor defined. Falling back to default execution.");const r={cell:n,notebook:t.model,notebookConfig:t.notebookConfig,onCellExecuted:n=>{e.executed.emit({notebook:t,...n})},onCellExecutionScheduled:n=>{e.executionScheduled.emit({notebook:t,...n})},sessionContext:i,sessionDialogs:s,translator:o};return e.executor?e.executor.runCell(r):g(r)}(t,n,s,o,r)}))).then((n=>!t.isDisposed&&(e.selectionExecuted.emit({notebook:t,lastCell:l}),t.update(),n.every((e=>e))))).catch((i=>{if(!i.message.startsWith("KernelReplyNotOK"))throw i;return n.map((e=>{"code"===e.model.type&&null==e.model.executionCount&&e.setPrompt("")})),e.selectionExecuted.emit({notebook:t,lastCell:l}),t.update(),!1}))}function o(e){const t=e.model.sharedModel,n=[];e.mode="command",e.widgets.forEach(((t,i)=>{var s;const o=!1!==t.model.getMetadata("deletable");e.isSelectedOrActive(t)&&o&&(n.push(i),null===(s=e.model)||void 0===s||s.deletedCells.push(t.model.id))})),n.length>0&&(t.transact((()=>{n.reverse().forEach((e=>{t.deleteCell(e)})),t.cells.length==n.length&&t.insertCell(0,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}})})),e.activeCellIndex=n[0]-n.length+1),e.deselectAll()}let l;e.executed=new d.Signal({}),e.executionScheduled=new d.Signal({}),e.selectionExecuted=new d.Signal({}),e.outputCleared=new d.Signal({}),e.getState=t,e.handleState=n,e.handleRunState=async function(e,t,n){const{activeCell:i,activeCellIndex:s}=e;i&&await e.scrollToItem(s,"smart",0,n).catch((e=>{})),(t.wasFocused||"edit"===e.mode)&&e.activate()},e.runCells=s,e.runSelected=function(e,t,n,i){e.mode="command";let o=e.activeCellIndex;const r=e.widgets.filter(((t,n)=>{const i=e.isSelectedOrActive(t);return i&&(o=n),i}));return e.activeCellIndex=o,e.deselectAll(),s(e,r,t,n,i)},e.selectedCells=function(e){return e.widgets.filter((t=>e.isSelectedOrActive(t))).map((e=>e.model.toJSON())).map((e=>(void 0!==e.metadata.deletable&&delete e.metadata.deletable,e)))},e.copyOrCut=function(s,r){if(!s.model||!s.activeCell)return;const a=t(s),l=i.Clipboard.getInstance();s.mode="command",l.clear();const c=e.selectedCells(s);l.setData(p,c),r?o(s):s.deselectAll(),s.lastClipboardInteraction=r?"cut":"copy",n(s,a)},e.changeCellType=function(e,t,n){const s=e.model.sharedModel;e.widgets.forEach(((o,r)=>{if(e.isSelectedOrActive(o))if("code"===o.model.type&&o.outputArea.pendingInput){const e=(n=n||a.nullTranslator).load("jupyterlab");(0,i.showDialog)({title:e.__("Cell type not changed due to pending input"),body:e.__("The cell type has not been changed to avoid kernel deadlock as this cell has pending input! Submit your pending input and try again."),buttons:[i.Dialog.okButton()]})}else{if(o.model.type!==t){const e=o.model.toJSON();s.transact((()=>{s.deleteCell(r),e.metadata.trusted="code"===t||void 0;const n=s.insertCell(r,{cell_type:t,source:e.source,metadata:e.metadata});e.attachments&&["markdown","raw"].includes(t)&&(n.attachments=e.attachments)}))}"markdown"===t&&((o=e.widgets[r]).rendered=!1)}})),e.deselectAll()},e.deleteCells=o,e.setMarkdownHeader=function(e,t){let n=e.sharedModel.getSource();const i=Array(t+1).join("#")+" ",s=/^(#+\s*)|^(\s*)/.exec(n);s&&(n=n.slice(s[0].length)),e.sharedModel.setSource(i+n)},function(t){function n(e,t,n=!1,i=!1){let s=t.widgets.indexOf(e)-(n?1:0);for(;s>=0;){if(m.getHeadingInfo(t.widgets[s]).isHeading)return i?s:t.widgets[s];s--}return i?-1:null}t.findParentHeading=n,t.findLowerEqualLevelParentHeadingAbove=function(t,n,i=!1){let s=e.Headings.determineHeadingLevel(t,n);-1==s&&(s=1);let o=n.widgets.indexOf(t)-1;for(;o>=0;){let e=n.widgets[o],t=m.getHeadingInfo(e);if(t.isHeading&&t.headingLevel<=s)return i?o:e;o--}return i?-1:null},t.findLowerEqualLevelHeadingBelow=function(t,n,i=!1){let s=e.Headings.determineHeadingLevel(t,n);-1==s&&(s=1);let o=n.widgets.indexOf(t)+1;for(;o<n.widgets.length;){let e=n.widgets[o],t=m.getHeadingInfo(e);if(t.isHeading&&t.headingLevel<=s)return i?o:e;o++}return i?-1:null},t.findHeadingBelow=function(e,t,n=!1){let i=t.widgets.indexOf(e)+1;for(;i<t.widgets.length;){let e=t.widgets[i];if(m.getHeadingInfo(e).isHeading)return n?i:e;i++}return n?-1:null},t.determineHeadingLevel=function(e,t){let i=m.getHeadingInfo(e);if(i.isHeading)return i.headingLevel;{let i=n(e,t,!0);return null==i?-1:m.getHeadingInfo(i).headingLevel}},t.insertHeadingAboveCellIndex=async function(t,n,i){var s;n=Math.min(Math.max(n,1),6);const o=e.getState(i);i.model.sharedModel.insertCell(t,{cell_type:"markdown",source:"#".repeat(n)+" "}),i.activeCellIndex=t,!1===(null===(s=i.activeCell)||void 0===s?void 0:s.inViewport)&&await(0,r.signalToPromise)(i.activeCell.inViewportChanged,200).catch((()=>{})),i.deselectAll(),e.handleState(i,o,!0),i.mode="edit",i.widgets[t].setHidden(!1)}}(l=e.Headings||(e.Headings={}))}(_||(_={}));class C{constructor(e){this.model=e,this._cellMap=new WeakMap,this._changed=new d.Signal(this),this._isDisposed=!1,this._insertCells(0,this.model.cells),this.model.changed.connect(this._onSharedModelChanged,this)}get changed(){return this._changed}get isDisposed(){return this._isDisposed}get length(){return this.model.cells.length}*[Symbol.iterator](){for(const e of this.model.cells)yield this._cellMap.get(e)}dispose(){var e;if(!this._isDisposed){this._isDisposed=!0;for(const t of this.model.cells)null===(e=this._cellMap.get(t))||void 0===e||e.dispose();d.Signal.clearData(this)}}get(e){return this._cellMap.get(this.model.cells[e])}_insertCells(e,t){return t.forEach((e=>{let t;switch(e.cell_type){case"code":t=new s.DJ({sharedModel:e});break;case"markdown":t=new s.Xr({sharedModel:e});break;default:t=new s.mT({sharedModel:e})}this._cellMap.set(e,t),e.disposed.connect((()=>{t.dispose(),this._cellMap.delete(e)}))})),this.length}_onSharedModelChanged(e,t){var n;let i=0;const s=new Array;null===(n=t.cellsChange)||void 0===n||n.forEach((e=>{null!=e.insert?(this._insertCells(i,e.insert),s.push({type:"add",newIndex:i,newValues:e.insert.map((e=>this._cellMap.get(e))),oldIndex:-2,oldValues:[]}),i+=e.insert.length):null!=e.delete?s.push({type:"remove",newIndex:-1,newValues:[],oldIndex:i,oldValues:new Array(e.delete).fill(void 0)}):null!=e.retain&&(i+=e.retain)})),s.forEach((e=>this._changed.emit(e)))}}var y,w=n(64530);!function(e){function t(e,t){const n=(t||a.nullTranslator).load("jupyterlab");function s(){if(e.context.model.readOnly)return(0,i.showDialog)({title:n.__("Cannot Save"),body:n.__("Document is read-only"),buttons:[i.Dialog.okButton()]});e.context.save().then((()=>{if(!e.isDisposed)return e.context.createCheckpoint()}))}return(0,w.addToolbarButtonClass)(w.ReactWidget.create(h.createElement(w.UseSignal,{signal:e.context.fileChanged},(()=>h.createElement(w.ToolbarButtonComponent,{icon:w.saveIcon,onClick:s,tooltip:n.__("Save the notebook contents and create checkpoint"),enabled:!!(e&&e.context&&e.context.contentsModel&&e.context.contentsModel.writable)})))))}function n(e,t){const n=(t||a.nullTranslator).load("jupyterlab");return new w.ToolbarButton({icon:w.addIcon,onClick:()=>{m.insertBelow(e.content)},tooltip:n.__("Insert a cell below")})}function s(e,t){const n=(t||a.nullTranslator).load("jupyterlab");return new w.ToolbarButton({icon:w.cutIcon,onClick:()=>{m.cut(e.content)},tooltip:n.__("Cut the selected cells")})}function o(e,t){const n=(t||a.nullTranslator).load("jupyterlab");return new w.ToolbarButton({icon:w.copyIcon,onClick:()=>{m.copy(e.content)},tooltip:n.__("Copy the selected cells")})}function r(e,t){const n=(t||a.nullTranslator).load("jupyterlab");return new w.ToolbarButton({icon:w.pasteIcon,onClick:()=>{m.paste(e.content)},tooltip:n.__("Paste cells from the clipboard")})}function l(e,t,n){const i=(null!=n?n:a.nullTranslator).load("jupyterlab");return new w.ToolbarButton({icon:w.runIcon,onClick:()=>{m.runAndAdvance(e.content,e.sessionContext,t,n)},tooltip:i.__("Run the selected cells and advance")})}function c(e,t,n){const s=(null!=n?n:a.nullTranslator).load("jupyterlab");return new w.ToolbarButton({icon:w.fastForwardIcon,onClick:()=>{const s=null!=t?t:new i.SessionContextDialogs({translator:n});s.restart(e.sessionContext).then((t=>(t&&m.runAll(e.content,e.sessionContext,s,n),t)))},tooltip:s.__("Restart the kernel, then re-run the whole notebook")})}function d(e,t){return new b(e.content,t)}e.createSaveButton=t,e.createInsertButton=n,e.createCutButton=s,e.createCopyButton=o,e.createPasteButton=r,e.createRunButton=l,e.createRestartRunAllButton=c,e.createCellTypeItem=d,e.getDefaultItems=function(e,a,h){return[{name:"save",widget:t(e,h)},{name:"insert",widget:n(e,h)},{name:"cut",widget:s(e,h)},{name:"copy",widget:o(e,h)},{name:"paste",widget:r(e,h)},{name:"run",widget:l(e,a,h)},{name:"interrupt",widget:i.Toolbar.createInterruptButton(e.sessionContext,h)},{name:"restart",widget:i.Toolbar.createRestartButton(e.sessionContext,a,h)},{name:"restart-and-run",widget:c(e,a,h)},{name:"cellType",widget:d(e,h)},{name:"spacer",widget:w.Toolbar.createSpacerItem()},{name:"kernelName",widget:i.Toolbar.createKernelNameItem(e.sessionContext,a,h)}]}}(y||(y={}));class b extends w.ReactWidget{constructor(e,t){super(),this.handleChange=e=>{"-"!==e.target.value&&(m.changeCellType(this._notebook,e.target.value),this._notebook.activate())},this.handleKeyDown=e=>{13===e.keyCode&&this._notebook.activate()},this._trans=(t||a.nullTranslator).load("jupyterlab"),this.addClass("jp-Notebook-toolbarCellType"),this._notebook=e,e.model&&this.update(),e.activeCellChanged.connect(this.update,this),e.selectionChanged.connect(this.update,this)}render(){let e="-";this._notebook.activeCell&&(e=this._notebook.activeCell.model.type);for(const t of this._notebook.widgets)if(this._notebook.isSelectedOrActive(t)&&t.model.type!==e){e="-";break}return h.createElement(w.HTMLSelect,{className:"jp-Notebook-toolbarCellTypeDropdown",onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:e,"aria-label":this._trans.__("Cell type"),title:this._trans.__("Select the cell type")},h.createElement("option",{value:"-"},"-"),h.createElement("option",{value:"code"},this._trans.__("Code")),h.createElement("option",{value:"markdown"},this._trans.__("Markdown")),h.createElement("option",{value:"raw"},this._trans.__("Raw")))}}var S=n(41205),k=n(51827);function x(e){const t=e.translator||a.nullTranslator,n=(0,i.translateKernelStatuses)(t),s=t.load("jupyterlab"),o=e.state,r=e.displayOption.showOnToolBar,l=e.displayOption.showProgress,c=r?"down":"up",d=u().createElement("div",null);if(!o)return d;const h=o.kernelStatus,g={alignSelf:"normal",height:"24px"},p=o.totalTime,f=o.scheduledCellNumber||0,m=f-(o.scheduledCell.size||0);let v=100*m/f,_=l?"":"hidden";!l&&v<100&&(v=0);const C=e=>u().createElement(S.a3,{progress:e,width:16,height:24,label:s.__("Kernel status")}),y=e=>s.__("Kernel status: %1",e),b=(e,t,i)=>u().createElement("div",{className:"jp-Notebook-ExecutionIndicator",title:l?"":y(n[e]),"data-status":e},t,u().createElement("div",{className:`jp-Notebook-ExecutionIndicator-tooltip ${c} ${_}`},u().createElement("span",null," ",y(n[e])," "),i));if("connecting"===o.kernelStatus||"disconnected"===o.kernelStatus||"unknown"===o.kernelStatus)return b(h,u().createElement(w.offlineBoltIcon.react,{...g}),[]);if("starting"===o.kernelStatus||"terminating"===o.kernelStatus||"restarting"===o.kernelStatus||"initializing"===o.kernelStatus)return b(h,u().createElement(w.circleIcon.react,{...g}),[]);if("busy"===o.executionStatus)return b("busy",C(v),[u().createElement("span",{key:0},s.__(`Executed ${m}/${f} cells`)),u().createElement("span",{key:1},s._n("Elapsed time: %1 second","Elapsed time: %1 seconds",p))]);{const e="busy"===o.kernelStatus?0:100,t="busy"===o.kernelStatus||0===p?[]:[u().createElement("span",{key:0},s._n("Executed %1 cell","Executed %1 cells",f)),u().createElement("span",{key:1},s._n("Elapsed time: %1 second","Elapsed time: %1 seconds",p))];return b(o.kernelStatus,C(e),t)}}class E extends w.VDomRenderer{constructor(e,t=!0){super(new E.Model),this.translator=e||a.nullTranslator,this.addClass("jp-mod-highlighted")}render(){if(null!==this.model&&this.model.renderFlag){const e=this.model.currentNotebook;return e?u().createElement(x,{displayOption:this.model.displayOption,state:this.model.executionState(e),translator:this.translator}):u().createElement(x,{displayOption:this.model.displayOption,state:void 0,translator:this.translator})}return u().createElement("div",null)}}!function(e){class t extends w.VDomModel{constructor(){super(),this._notebookExecutionProgress=new WeakMap,this._displayOption={showOnToolBar:!0,showProgress:!0},this._renderFlag=!0}attachNotebook(e){var t,n,i,s;if(e&&e.content&&e.context){const o=e.content,r=e.context;if(this._currentNotebook=o,!this._notebookExecutionProgress.has(o)){this._notebookExecutionProgress.set(o,{executionStatus:"idle",kernelStatus:"idle",totalTime:0,interval:0,timeout:0,scheduledCell:new Set,scheduledCellNumber:0,needReset:!0});const e=this._notebookExecutionProgress.get(o),a=t=>{e&&(e.kernelStatus=t.kernelDisplayStatus),this.stateChanged.emit(void 0)};r.statusChanged.connect(a,this);const l=t=>{e&&(e.kernelStatus=t.kernelDisplayStatus),this.stateChanged.emit(void 0)};r.connectionStatusChanged.connect(l,this),r.disposed.connect((e=>{e.connectionStatusChanged.disconnect(l,this),e.statusChanged.disconnect(a,this)}));const c=(e,t)=>{const n=t.msg,i=n.header.msg_id;if("execute_request"===n.header.msg_type)this._cellScheduledCallback(o,i);else if(k.KernelMessage.isStatusMsg(n)&&"idle"===n.content.execution_state){const e=n.parent_header.msg_id;this._cellExecutedCallback(o,e)}else k.KernelMessage.isStatusMsg(n)&&"restarting"===n.content.execution_state?this._restartHandler(o):"execute_input"===n.header.msg_type&&this._startTimer(o)};null===(n=null===(t=r.session)||void 0===t?void 0:t.kernel)||void 0===n||n.anyMessage.connect(c),null===(s=null===(i=r.session)||void 0===i?void 0:i.kernel)||void 0===s||s.disposed.connect((e=>e.anyMessage.disconnect(c)));const d=(t,n)=>{e&&(this._resetTime(e),this.stateChanged.emit(void 0),n.newValue&&n.newValue.anyMessage.connect(c))};r.kernelChanged.connect(d),r.disposed.connect((e=>e.kernelChanged.disconnect(d)))}}}get currentNotebook(){return this._currentNotebook}get displayOption(){return this._displayOption}set displayOption(e){this._displayOption=e}executionState(e){return this._notebookExecutionProgress.get(e)}_scheduleSwitchToIdle(e){window.setTimeout((()=>{e.executionStatus="idle",clearInterval(e.interval),this.stateChanged.emit(void 0)}),150),e.timeout=window.setTimeout((()=>{e.needReset=!0}),1e3)}_cellExecutedCallback(e,t){const n=this._notebookExecutionProgress.get(e);n&&n.scheduledCell.has(t)&&(n.scheduledCell.delete(t),0===n.scheduledCell.size&&this._scheduleSwitchToIdle(n))}_restartHandler(e){const t=this._notebookExecutionProgress.get(e);t&&(t.scheduledCell.clear(),this._scheduleSwitchToIdle(t))}_startTimer(e){const t=this._notebookExecutionProgress.get(e);t&&(t.scheduledCell.size>0?"busy"!==t.executionStatus&&(t.executionStatus="busy",clearTimeout(t.timeout),this.stateChanged.emit(void 0),t.interval=window.setInterval((()=>{this._tick(t)}),1e3)):this._resetTime(t))}_cellScheduledCallback(e,t){const n=this._notebookExecutionProgress.get(e);n&&!n.scheduledCell.has(t)&&(n.needReset&&this._resetTime(n),n.scheduledCell.add(t),n.scheduledCellNumber+=1)}_tick(e){e.totalTime+=1,this.stateChanged.emit(void 0)}_resetTime(e){e.totalTime=0,e.scheduledCellNumber=0,e.executionStatus="idle",e.scheduledCell=new Set,clearTimeout(e.timeout),clearInterval(e.interval),e.needReset=!1}get renderFlag(){return this._renderFlag}updateRenderOption(e){this.displayOption.showOnToolBar&&(e.showOnToolBar?this._renderFlag=!0:this._renderFlag=!1),this.displayOption.showProgress=e.showProgress,this.stateChanged.emit(void 0)}}function n(e){let t=!0,n=!0;const i=e.get("kernelStatus").composite;return i&&(t=!i.showOnStatusBar,n=i.showProgress),{showOnToolBar:t,showProgress:n}}e.Model=t,e.createExecutionIndicatorItem=function(t,i,s){const o=new e(i);return o.model.displayOption={showOnToolBar:!0,showProgress:!0},o.model.attachNotebook({content:t.content,context:t.sessionContext}),s&&s.then((e=>{const t=e=>{o.model.updateRenderOption(n(e))};e.changed.connect(t),t(e),o.disposed.connect((()=>{e.changed.disconnect(t)}))})).catch((e=>{console.error(e.message)})),o},e.getSettingValue=n}(E||(E={}));class M{constructor(e){this._requestBatchSize=10,this._cursor=0,this._hasSession=!1,this._history=[],this._placeholder="",this._kernelSession="",this._setByHistory=!1,this._isDisposed=!1,this._editor=null,this._filtered=[],this._kernel=null,this._sessionContext=e.sessionContext,this._trans=(e.translator||a.nullTranslator).load("jupyterlab"),this._handleKernel().then((()=>{this._sessionContext.kernelChanged.connect(this._handleKernel,this)})),this._toRequest=this._requestBatchSize}get editor(){return this._editor}set editor(e){if(this._editor===e)return;const t=this._editor;t&&t.model.sharedModel.changed.disconnect(this.onTextChange,this),this._editor=e,e&&e.model.sharedModel.changed.connect(this.onTextChange,this)}get placeholder(){return this._placeholder}get kernelSession(){return this._kernelSession}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=!0,this._history.length=0,d.Signal.clearData(this)}async checkSession(e){var t;this._hasSession||(await this._retrieveHistory(),this._hasSession=!0,this.editor=e.editor,this._placeholder=(null===(t=this._editor)||void 0===t?void 0:t.model.sharedModel.getSource())||"",this.setFilter(this._placeholder),this._cursor=this._filtered.length-1)}async back(e){return await this.checkSession(e),--this._cursor,this._cursor<0&&await this.fetchBatch(),this._cursor=Math.max(0,this._cursor),this._filtered[this._cursor]}async forward(e){return await this.checkSession(e),++this._cursor,this._cursor=Math.min(this._filtered.length-1,this._cursor),this._filtered[this._cursor]}updateEditor(e,t){var n,i;if(e){const s=null===(n=e.editor)||void 0===n?void 0:n.model,o=null==s?void 0:s.sharedModel.getSource();if(this.isDisposed||!t)return;if(o===t)return;this._setByHistory=!0,null==s||s.sharedModel.setSource(t);let r=0;r=t.indexOf("\n"),r<0&&(r=t.length),null===(i=e.editor)||void 0===i||i.setCursorPosition({line:0,column:r})}}reset(){this._hasSession=!1,this._placeholder="",this._toRequest=this._requestBatchSize}async fetchBatch(){this._toRequest+=this._requestBatchSize;let e=this._filtered.slice().reverse(),t=this._history.slice();await this._retrieveHistory().then((()=>{this.setFilter(this._placeholder);let t=0,n=this._filtered.slice().reverse();for(let i=0;i<e.length;i++){let s=e[i];for(let e=i+t;e<n.length&&s!==n[e];e++)t+=1}this._cursor=this._filtered.length-(e.length+1)-t})),this._cursor<0&&this._history.length>t.length&&await this.fetchBatch()}onHistory(e,t){this._history.length=0;let n=["","",""],i=["","",""],s="";if("ok"===e.content.status){for(let t=0;t<e.content.history.length;t++)i=e.content.history[t],i!==n&&(s=e.content.history[t][0],this._history.push(n=i));this.kernelSession||i[2]==(null==t?void 0:t.model.sharedModel.getSource())&&(this._kernelSession=s)}}onTextChange(){this._setByHistory?this._setByHistory=!1:this.reset()}async _handleKernel(){var e;this._kernel=null===(e=this._sessionContext.session)||void 0===e?void 0:e.kernel,this._kernel?await this._retrieveHistory().catch():this._history.length=0}async _retrieveHistory(e){var t,n;return await(null===(t=this._kernel)||void 0===t?void 0:t.requestHistory((n=this._toRequest,{output:!1,raw:!0,hist_access_type:"tail",n})).then((t=>{this.onHistory(t,e)})).catch((()=>{console.warn(this._trans.__("History was unable to be retrieved"))})))}setFilter(e=""){this._filtered.length=0;let t="",n="";for(let i=0;i<this._history.length;i++)n=this._history[i][2],n!==t&&e!==n&&this._filtered.push(t=n);this._filtered.push(e)}}var I=n(54908),T=n(94958);class N{constructor(e={}){var t,n;this.standaloneModel=!1,this._dirty=!1,this._readOnly=!1,this._contentChanged=new d.Signal(this),this._stateChanged=new d.Signal(this),this._isDisposed=!1,this._metadataChanged=new d.Signal(this),this.standaloneModel=void 0===e.sharedModel,e.sharedModel?this.sharedModel=e.sharedModel:this.sharedModel=T.Xn.create({disableDocumentWideUndoRedo:null===(t=e.disableDocumentWideUndoRedo)||void 0===t||t,data:{nbformat:I.MAJOR_VERSION,nbformat_minor:I.MINOR_VERSION,metadata:{kernelspec:{name:"",display_name:""},language_info:{name:null!==(n=e.languagePreference)&&void 0!==n?n:""}}}}),this._cells=new C(this.sharedModel),this._trans=(e.translator||a.nullTranslator).load("jupyterlab"),this._deletedCells=[],this._collaborationEnabled=!!(null==e?void 0:e.collaborationEnabled),this._cells.changed.connect(this._onCellsChanged,this),this.sharedModel.changed.connect(this._onStateChanged,this),this.sharedModel.metadataChanged.connect(this._onMetadataChanged,this)}get contentChanged(){return this._contentChanged}get metadataChanged(){return this._metadataChanged}get stateChanged(){return this._stateChanged}get cells(){return this._cells}get dirty(){return this._dirty}set dirty(e){const t=this._dirty;e!==t&&(this._dirty=e,this.triggerStateChange({name:"dirty",oldValue:t,newValue:e}))}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly)return;const t=this._readOnly;this._readOnly=e,this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get metadata(){return this.sharedModel.metadata}get nbformat(){return this.sharedModel.nbformat}get nbformatMinor(){return this.sharedModel.nbformat_minor}get defaultKernelName(){var e;const t=this.getMetadata("kernelspec");return null!==(e=null==t?void 0:t.name)&&void 0!==e?e:""}get deletedCells(){return this._deletedCells}get defaultKernelLanguage(){var e;const t=this.getMetadata("language_info");return null!==(e=null==t?void 0:t.name)&&void 0!==e?e:""}get collaborative(){return this._collaborationEnabled}dispose(){if(this.isDisposed)return;this._isDisposed=!0;const e=this.cells;this._cells=null,e.dispose(),this.standaloneModel&&this.sharedModel.dispose(),d.Signal.clearData(this)}deleteMetadata(e){return this.sharedModel.deleteMetadata(e)}getMetadata(e){return this.sharedModel.getMetadata(e)}setMetadata(e,t){void 0===t?this.sharedModel.deleteMetadata(e):this.sharedModel.setMetadata(e,t)}toString(){return JSON.stringify(this.toJSON())}fromString(e){this.fromJSON(JSON.parse(e))}toJSON(){return this._ensureMetadata(),this.sharedModel.toJSON()}fromJSON(e){var t,n;const s=c.JSONExt.deepCopy(e),o=e.metadata.orig_nbformat;if(s.nbformat=Math.max(e.nbformat,I.MAJOR_VERSION),(s.nbformat!==e.nbformat||s.nbformat_minor<I.MINOR_VERSION)&&(s.nbformat_minor=I.MINOR_VERSION),void 0!==o&&s.nbformat!==o){let e;e=s.nbformat>o?this._trans.__("This notebook has been converted from an older notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\n'Older versions of Jupyter may not be able to read the new format.' To preserve the original format version,\nclose the notebook without saving it.",o,s.nbformat):this._trans.__("This notebook has been converted from an newer notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\nSome features of the original notebook may not be available.' To preserve the original format version,\nclose the notebook without saving it.",o,s.nbformat),(0,i.showDialog)({title:this._trans.__("Notebook converted"),body:e,buttons:[i.Dialog.okButton({label:this._trans.__("Ok")})]})}0===(null!==(n=null===(t=s.cells)||void 0===t?void 0:t.length)&&void 0!==n?n:0)&&(s.cells=[{cell_type:"code",source:"",metadata:{trusted:!0}}]),this.sharedModel.fromJSON(s),this._ensureMetadata(),this.dirty=!0}_onCellsChanged(e,t){switch(t.type){case"add":case"set":t.newValues.forEach((e=>{e.contentChanged.connect(this.triggerContentChange,this)}))}this.triggerContentChange()}_onMetadataChanged(e,t){this._metadataChanged.emit(t),this.triggerContentChange()}_onStateChanged(e,t){t.stateChange&&t.stateChange.forEach((e=>{"dirty"===e.name?this.dirty=e.newValue:e.oldValue!==e.newValue&&this.triggerStateChange({newValue:void 0,oldValue:void 0,...e})}))}_ensureMetadata(e=""){this.getMetadata("language_info")||this.sharedModel.setMetadata("language_info",{name:e}),this.getMetadata("kernelspec")||this.sharedModel.setMetadata("kernelspec",{name:"",display_name:""})}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0),this.dirty=!0}get isDisposed(){return this._isDisposed}}class D{constructor(e={}){var t,n;this._disposed=!1,this._disableDocumentWideUndoRedo=null===(t=e.disableDocumentWideUndoRedo)||void 0===t||t,this._collaborative=null===(n=e.collaborative)||void 0===n||n}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}set disableDocumentWideUndoRedo(e){this._disableDocumentWideUndoRedo=e}get name(){return"notebook"}get contentType(){return"notebook"}get fileFormat(){return"json"}get collaborative(){return this._collaborative}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}createNew(e={}){return new N({languagePreference:e.languagePreference,sharedModel:e.sharedModel,collaborationEnabled:e.collaborationEnabled&&this.collaborative,disableDocumentWideUndoRedo:this._disableDocumentWideUndoRedo})}preferredLanguage(e){return""}}function A(e){const t=(e.translator||a.nullTranslator).load("jupyterlab");return h.createElement(S.pC,{source:t.__("Mode: %1",e.modeNames[e.notebookMode])})}class P extends w.VDomRenderer{constructor(e){super(new P.Model),this.translator=e||a.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._modeNames={command:this._trans.__("Command"),edit:this._trans.__("Edit")}}render(){return this.model?(this.node.title=this._trans.__("Notebook is in %1 mode",this._modeNames[this.model.notebookMode]),h.createElement(A,{notebookMode:this.model.notebookMode,translator:this.translator,modeNames:this._modeNames})):null}}!function(e){class t extends w.VDomModel{constructor(){super(...arguments),this._onChanged=e=>{const t=this._notebookMode;this._notebook?this._notebookMode=e.mode:this._notebookMode="command",this._triggerChange(t,this._notebookMode)},this._notebookMode="command",this._notebook=null}get notebookMode(){return this._notebookMode}set notebook(e){const t=this._notebook;null!==t&&(t.stateChanged.disconnect(this._onChanged,this),t.activeCellChanged.disconnect(this._onChanged,this),t.modelContentChanged.disconnect(this._onChanged,this));const n=this._notebookMode;this._notebook=e,null===this._notebook?this._notebookMode="command":(this._notebookMode=this._notebook.mode,this._notebook.stateChanged.connect(this._onChanged,this),this._notebook.activeCellChanged.connect(this._onChanged,this),this._notebook.modelContentChanged.connect(this._onChanged,this)),this._triggerChange(n,this._notebookMode)}_triggerChange(e,t){e!==t&&this.stateChanged.emit(void 0)}}e.Model=t}(P||(P={}));var O=n(56259),R=n(66229),L=n.n(R);class H{constructor(e){this._widgetAdapter=e.widgetAdapter,this._extensions=e.extensions,e.editor.ready().then((t=>{this._injectExtensions(e.editor)}))}dispose(){this.isDisposed||(this.isDisposed=!0,d.Signal.clearData(this))}_injectExtensions(e){const t=e.getEditor();t&&!t.isDisposed&&this._extensions.forEach((n=>{const i=n.factory({path:this._widgetAdapter.widget.context.path,editor:e,widgetAdapter:this._widgetAdapter,model:t.model,inline:!0});i&&t.injectExtension(i.instance(t))}))}}const j=i.Dialog.createButton,F={"text/x-rsrc":"r","text/x-r-source":"r","text/x-ipython":"python"};class B{constructor(e,t){this.widget=e,this.options=t,this._adapterConnected=new d.Signal(this),this._activeEditorChanged=new d.Signal(this),this._editorAdded=new d.Signal(this),this._editorRemoved=new d.Signal(this),this._disposed=new d.Signal(this),this._isDisposed=!1,this._virtualDocument=null,this._connectionManager=t.connectionManager,this._isConnected=!1,this._trans=(t.translator||a.nullTranslator).load("jupyterlab"),this.widget.context.saveState.connect(this.onSaveState,this),this.connectionManager.closed.connect(this.onConnectionClosed,this),this.widget.disposed.connect(this.dispose,this),this._editorToAdapter=new WeakMap,this.editorAdded.connect(this._onEditorAdded,this),this.editorRemoved.connect(this._onEditorRemoved,this),this._connectionManager.languageServerManager.sessionsChanged.connect(this._onLspSessionOrFeatureChanged,this),this.options.featureManager.featureRegistered.connect(this._onLspSessionOrFeatureChanged,this)}get isDisposed(){return this._isDisposed}get hasMultipleEditors(){return this.editors.length>1}get widgetId(){return this.widget.id}get language(){if(F.hasOwnProperty(this.mimeType))return F[this.mimeType];{let e=this.mimeType.split(";")[0],[t,n]=e.split("/");return"application"===t||"text"===t?n.startsWith("x-")?n.substring(2):n:this.mimeType}}get adapterConnected(){return this._adapterConnected}get activeEditorChanged(){return this._activeEditorChanged}get disposed(){return this._disposed}get editorAdded(){return this._editorAdded}get editorRemoved(){return this._editorRemoved}get isConnected(){return this._isConnected}get connectionManager(){return this._connectionManager}get trans(){return this._trans}get updateFinished(){return this._updateFinished}get virtualDocument(){return this._virtualDocument}onConnectionClosed(e,{virtualDocument:t}){t===this.virtualDocument&&this.dispose()}dispose(){this._isDisposed||(this.editorAdded.disconnect(this._onEditorAdded,this),this.editorRemoved.disconnect(this._onEditorRemoved,this),this._connectionManager.languageServerManager.sessionsChanged.disconnect(this._onLspSessionOrFeatureChanged,this),this.options.featureManager.featureRegistered.disconnect(this._onLspSessionOrFeatureChanged,this),this._isDisposed=!0,this.disconnect(),this._virtualDocument=null,this._disposed.emit(),d.Signal.clearData(this))}disconnect(){var e,t;const n=null===(e=this.virtualDocument)||void 0===e?void 0:e.uri,{model:i}=this.widget.context;n&&this.connectionManager.unregisterDocument(n),i.contentChanged.disconnect(this._onContentChanged,this);for(let{ceEditor:e}of this.editors)this._editorRemoved.emit({editor:e});null===(t=this.virtualDocument)||void 0===t||t.dispose()}updateDocuments(){return this._isDisposed?(console.warn("Cannot update documents: adapter disposed"),Promise.reject("Cannot update documents: adapter disposed")):this.virtualDocument.updateManager.updateDocuments(this.editors)}documentChanged(e,t,n=!1){if(this._isDisposed)return void console.warn("Cannot swap document: adapter disposed");let i=this.connectionManager.connections.get(e.uri);(null==i?void 0:i.isReady)?i.sendFullTextChange(e.value,e.documentInfo):console.log("Skipping document update signal: connection not ready")}reloadConnection(){null!==this.virtualDocument&&(this.disconnect(),this.initVirtual(),this.connectDocument(this.virtualDocument,!0).catch(console.warn))}onSaveState(e,t){if(null!==this.virtualDocument&&"completed"===t){const e=[this.virtualDocument];for(let t of e){let n=this.connectionManager.connections.get(t.uri);if(n){n.sendSaved(t.documentInfo);for(let n of t.foreignDocuments.values())e.push(n)}}}}async onConnected(e){let{virtualDocument:t}=e;this._adapterConnected.emit(e),this._isConnected=!0;try{await this.updateDocuments()}catch(e){return void console.warn("Could not update documents",e)}this.documentChanged(t,t,!0),e.connection.serverNotifications["$/logTrace"].connect(((n,i)=>{console.log(e.connection.serverIdentifier,"trace",t.uri,i)})),e.connection.serverNotifications["window/logMessage"].connect(((e,t)=>{console.log(e.serverIdentifier+": "+t.message)})),e.connection.serverNotifications["window/showMessage"].connect(((e,t)=>{(0,i.showDialog)({title:this.trans.__("Message from ")+e.serverIdentifier,body:t.message})})),e.connection.serverRequests["window/showMessageRequest"].setHandler((async t=>{const n=t.actions,s=n?n.map((e=>j({label:e.title}))):[j({label:this.trans.__("Dismiss")})],o=await(0,i.showDialog)({title:this.trans.__("Message from ")+e.connection.serverIdentifier,body:t.message,buttons:s}),r=s.indexOf(o.button);return-1===r?null:n?n[r]:null}))}async connectDocument(e,t=!1){e.foreignDocumentOpened.connect(this.onForeignDocumentOpened,this);const n=await this._connect(e).catch(console.error);n&&n.connection&&(e.changed.connect(this.documentChanged,this),t&&n.connection.sendOpenWhenReady(e.documentInfo))}initVirtual(){var e;null===(e=this._virtualDocument)||void 0===e||e.dispose(),this._virtualDocument=this.createVirtualDocument(),this._onLspSessionOrFeatureChanged()}async onForeignDocumentOpened(e,t){const{foreignDocument:n}=t;await this.connectDocument(n,!0),n.foreignDocumentClosed.connect(this._onForeignDocumentClosed,this)}_onEditorAdded(e,t){const{editor:n}=t,i=new H({editor:n,widgetAdapter:this,extensions:this.options.featureManager.extensionFactories()});this._editorToAdapter.set(n,i)}_onEditorRemoved(e,t){const{editor:n}=t,i=this._editorToAdapter.get(n);null==i||i.dispose(),this._editorToAdapter.delete(n)}_onForeignDocumentClosed(e,t){const{foreignDocument:n}=t;n.foreignDocumentClosed.disconnect(this._onForeignDocumentClosed,this),n.foreignDocumentOpened.disconnect(this.onForeignDocumentOpened,this),n.changed.disconnect(this.documentChanged,this)}async _connect(e){let t=e.language,n={textDocument:{synchronization:{dynamicRegistration:!0,willSave:!1,didSave:!0,willSaveWaitUntil:!1}},workspace:{didChangeConfiguration:{dynamicRegistration:!0}}};n=L()(n,this.options.featureManager.clientCapabilities());let i={capabilities:n,virtualDocument:e,language:t,hasLspSupportedFile:e.hasLspSupportedFile},s=await this.connectionManager.connect(i);return s?(await this.onConnected({virtualDocument:e,connection:s}),{connection:s,virtualDocument:e}):void 0}async _onContentChanged(e){const t=this.updateDocuments();t?(this._updateFinished=t.catch(console.warn),await this.updateFinished):console.warn("Could not update documents")}_shouldUpdateVirtualDocument(){const{languageServerManager:e}=this.connectionManager;return e.isEnabled&&this.options.featureManager.features.length>0}_onLspSessionOrFeatureChanged(){if(!this._virtualDocument)return;const{model:e}=this.widget.context;this._shouldUpdateVirtualDocument()?e.contentChanged.connect(this._onContentChanged,this):e.contentChanged.disconnect(this._onContentChanged,this)}}async function q(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}function W(e,t=35,n=50,i=e=>e){return(async()=>{let s=0;for(;!0!==e();){if(s+=1,-1!==t&&s>t)throw Error("Too many retrials");n=i(n),await q(n)}return e})()}function V(e){const t=[];for(let n in e){const i=U(n.split("."),e[n]);t.push(i)}return L()({},...t)}const U=(e,t)=>{const n=Object.create(null);let i=n;return e.forEach(((n,s)=>{i[n]=Object.create(null),s===e.length-1?i[n]=t:i=i[n]})),n};class z extends Map{constructor(e,t){super(t),this.defaultFactory=e}get(e){return this.getOrCreate(e)}getOrCreate(e,...t){if(this.has(e))return super.get(e);{let n=this.defaultFactory(e,...t);return this.set(e,n),n}}}var $,J;function K(e,t){const n=JSON.parse(JSON.stringify(e)),{method:i,registerOptions:s}=t,o=i.substring(13)+"Provider";return o?(n[o]=!s||JSON.parse(JSON.stringify(s)),n):(console.warn("Could not register server capability.",t),null)}function G(e,t){const n=JSON.parse(JSON.stringify(e)),{method:i}=t;return delete n[i.substring(13)+"Provider"],n}!function(e){e.URL_NS="lsp"}($||($={})),new c.Token("@jupyterlab/lsp:ILSPDocumentConnectionManager","Provides the virtual documents and language server connections service."),new c.Token("@jupyterlab/lsp:ILSPFeatureManager","Provides the language server feature manager. This token is required to register new client capabilities."),new c.Token("@jupyterlab/lsp:ILSPCodeExtractorsManager","Provides the code extractor manager. This token is required in your extension to register code extractor allowing the creation of multiple virtual document from an opened document."),new c.Token("@jupyterlab/lsp:IWidgetLSPAdapterTracker","Provides the WidgetLSPAdapter tracker. This token is required in your extension to track WidgetLSPAdapters."),function(e){let t,n,i,s;!function(e){e.PUBLISH_DIAGNOSTICS="textDocument/publishDiagnostics",e.SHOW_MESSAGE="window/showMessage",e.LOG_TRACE="$/logTrace",e.LOG_MESSAGE="window/logMessage"}(t=e.ServerNotification||(e.ServerNotification={})),function(e){e.DID_CHANGE="textDocument/didChange",e.DID_CHANGE_CONFIGURATION="workspace/didChangeConfiguration",e.DID_OPEN="textDocument/didOpen",e.DID_SAVE="textDocument/didSave",e.INITIALIZED="initialized",e.SET_TRACE="$/setTrace"}(n=e.ClientNotification||(e.ClientNotification={})),function(e){e.REGISTER_CAPABILITY="client/registerCapability",e.SHOW_MESSAGE_REQUEST="window/showMessageRequest",e.UNREGISTER_CAPABILITY="client/unregisterCapability",e.WORKSPACE_CONFIGURATION="workspace/configuration"}(i=e.ServerRequest||(e.ServerRequest={})),function(e){e.CODE_ACTION="textDocument/codeAction",e.COMPLETION="textDocument/completion",e.COMPLETION_ITEM_RESOLVE="completionItem/resolve",e.DEFINITION="textDocument/definition",e.DOCUMENT_COLOR="textDocument/documentColor",e.DOCUMENT_HIGHLIGHT="textDocument/documentHighlight",e.DOCUMENT_SYMBOL="textDocument/documentSymbol",e.HOVER="textDocument/hover",e.IMPLEMENTATION="textDocument/implementation",e.INITIALIZE="initialize",e.REFERENCES="textDocument/references",e.RENAME="textDocument/rename",e.SIGNATURE_HELP="textDocument/signatureHelp",e.TYPE_DEFINITION="textDocument/typeDefinition",e.LINKED_EDITING_RANGE="textDocument/linkedEditingRange",e.INLINE_VALUE="textDocument/inlineValue",e.INLAY_HINT="textDocument/inlayHint",e.WORKSPACE_SYMBOL="workspace/symbol",e.WORKSPACE_SYMBOL_RESOLVE="workspaceSymbol/resolve",e.FORMATTING="textDocument/formatting",e.RANGE_FORMATTING="textDocument/rangeFormatting"}(s=e.ClientRequest||(e.ClientRequest={}))}(J||(J={}));var Q=n(84879);n(44313);var Y=n(79813);class X extends Y.AbstractMessageReader{constructor(e){super(),this.socket=e,this.state="initial",this.events=[],this.socket.onMessage((e=>this.readMessage(e))),this.socket.onError((e=>this.fireError(e))),this.socket.onClose(((e,t)=>{if(1e3!==e){const n={name:""+e,message:`Error during socket reconnect: code = ${e}, reason = ${t}`};this.fireError(n)}this.fireClose()}))}listen(e){if("initial"===this.state)for(this.state="listening",this.callback=e;0!==this.events.length;){const e=this.events.pop();e.message?this.readMessage(e.message):e.error?this.fireError(e.error):this.fireClose()}return{dispose:()=>{this.callback===e&&(this.callback=void 0)}}}readMessage(e){if("initial"===this.state)this.events.splice(0,0,{message:e});else if("listening"===this.state){const t=JSON.parse(e);this.callback(t)}}fireError(e){"initial"===this.state?this.events.splice(0,0,{error:e}):"listening"===this.state&&super.fireError(e)}fireClose(){"initial"===this.state?this.events.splice(0,0,{}):"listening"===this.state&&super.fireClose(),this.state="closed"}}var Z,ee,te=n(87745);class ne extends te.AbstractMessageWriter{constructor(e){super(),this.socket=e,this.errorCount=0}end(){}async write(e){try{const t=JSON.stringify(e);this.socket.send(t)}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}}}class ie{error(e){console.error(e)}warn(e){console.warn(e)}info(e){console.info(e)}log(e){console.log(e)}debug(e){console.debug(e)}}class se{constructor(e){this.openedUris=new Map,this._isConnected=!1,this._isInitialized=!1,this._disposables=[],this._disposed=new d.Signal(this),this._isDisposed=!1,this._rootUri=e.rootUri}get isConnected(){return this._isConnected}get isInitialized(){return this._isInitialized}get isReady(){return this._isConnected&&this._isInitialized}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}connect(e){this.socket=e,function(e){const{webSocket:t,onConnection:n}=e,i=e.logger||new ie;t.onopen=()=>{const e=function(e){return{send:t=>e.send(t),onMessage:t=>{e.onmessage=e=>t(e.data)},onError:t=>{e.onerror=e=>{"message"in e&&t(e.message)}},onClose:t=>{e.onclose=e=>t(e.code,e.reason)},dispose:()=>e.close()}}(t),s=function(e,t){const n=new X(e),i=new ne(e),s=(0,Q.createMessageConnection)(n,i,t);return s.onClose((()=>s.dispose())),s}(e,i);n(s)}}({webSocket:this.socket,logger:new ie,onConnection:e=>{e.listen(),this._isConnected=!0,this.connection=e,this.sendInitialize();const t=this.connection.onRequest("client/registerCapability",(e=>{e.registrations.forEach((e=>{try{this.serverCapabilities=K(this.serverCapabilities,e)}catch(e){console.error(e)}}))}));this._disposables.push(t);const n=this.connection.onRequest("client/unregisterCapability",(e=>{e.unregisterations.forEach((e=>{this.serverCapabilities=G(this.serverCapabilities,e)}))}));this._disposables.push(n);const i=this.connection.onClose((()=>{this._isConnected=!1}));this._disposables.push(i)}})}close(){this.connection&&this.connection.dispose(),this.openedUris.clear(),this.socket.close()}sendInitialize(){if(!this._isConnected)return;this.openedUris.clear();const e=this.initializeParams();this.connection.sendRequest("initialize",e).then((e=>{this.onServerInitialized(e)}),(e=>{console.warn("LSP websocket connection initialization failure",e)}))}sendOpen(e){const t={textDocument:{uri:e.uri,languageId:e.languageId,text:e.text,version:e.version}};this.connection.sendNotification("textDocument/didOpen",t).catch(console.error),this.openedUris.set(e.uri,!0),this.sendChange(e)}sendChange(e){if(!this.isReady)return;if(!this.openedUris.get(e.uri))return void this.sendOpen(e);const t={textDocument:{uri:e.uri,version:e.version},contentChanges:[{text:e.text}]};this.connection.sendNotification("textDocument/didChange",t).catch(console.error),e.version++}sendSaved(e){if(!this.isReady)return;const t={textDocument:{uri:e.uri,version:e.version},text:e.text};this.connection.sendNotification("textDocument/didSave",t).catch(console.error)}sendConfigurationChange(e){this.isReady&&this.connection.sendNotification("workspace/didChangeConfiguration",e).catch(console.error)}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposables.forEach((e=>{e.dispose()})),this._disposed.emit(),d.Signal.clearData(this))}onServerInitialized(e){this._isInitialized=!0,this.serverCapabilities=e.capabilities,this.connection.sendNotification("initialized",{}).catch(console.error),this.connection.sendNotification("workspace/didChangeConfiguration",{settings:{}}).catch(console.error)}initializeParams(){return{capabilities:{},processId:null,rootUri:this._rootUri,workspaceFolders:null}}}class oe{constructor(e,t,n){this.connection=e,this.method=t,this.emitter=n}request(e){return this.emitter.log(Z.clientRequested,{method:this.method,message:e}),this.connection.sendRequest(this.method,e).then((t=>(this.emitter.log(Z.resultForClient,{method:this.method,message:e}),t)))}}class re{constructor(e,t,n){this.connection=e,this.method=t,this.emitter=n,this.connection.onRequest(t,this._handle.bind(this)),this._handler=null}setHandler(e){this._handler=e}clearHandler(){this._handler=null}_handle(e){return this.emitter.log(Z.serverRequested,{method:this.method,message:e}),this._handler?this._handler(e,this.emitter).then((e=>(this.emitter.log(Z.responseForServer,{method:this.method,message:e}),e))):new Promise((()=>{}))}}function ae(e,t){const n={};for(let i of Object.values(e))n[i]=t(i);return n}!function(e){e[e.clientNotifiedServer=0]="clientNotifiedServer",e[e.serverNotifiedClient=1]="serverNotifiedClient",e[e.serverRequested=2]="serverRequested",e[e.clientRequested=3]="clientRequested",e[e.resultForClient=4]="resultForClient",e[e.responseForServer=5]="responseForServer"}(Z||(Z={}));class le extends se{constructor(e){super(e),this._closingManually=!1,this._closeSignal=new d.Signal(this),this._errorSignal=new d.Signal(this),this._serverInitialized=new d.Signal(this),this._options=e,this.logAllCommunication=!1,this.serverIdentifier=e.serverIdentifier,this.serverLanguage=e.languageId,this.documentsToOpen=[],this.clientNotifications=this.constructNotificationHandlers(J.ClientNotification),this.serverNotifications=this.constructNotificationHandlers(J.ServerNotification)}get closeSignal(){return this._closeSignal}get errorSignal(){return this._errorSignal}get serverInitialized(){return this._serverInitialized}dispose(){this.isDisposed||(Object.values(this.serverRequests).forEach((e=>e.clearHandler())),this.close(),super.dispose())}log(e,t){this.logAllCommunication&&console.log(e,t)}sendOpenWhenReady(e){this.isReady?this.sendOpen(e):this.documentsToOpen.push(e)}sendSelectiveChange(e,t){this._sendChange([e],t)}sendFullTextChange(e,t){this._sendChange([{text:e}],t)}provides(e){return!(!this.serverCapabilities||!this.serverCapabilities[e])}close(){try{this._closingManually=!0,super.close()}catch(e){this._closingManually=!1}}connect(e){super.connect(e),W((()=>this.isConnected),-1).then((()=>{const e=this.connection.onClose((()=>{this._isConnected=!1,this._closeSignal.emit(this._closingManually)}));this._disposables.push(e)})).catch((()=>{console.error("Could not connect onClose signal")}))}async getCompletionResolve(e){if(this.isReady)return this.connection.sendRequest("completionItem/resolve",e)}constructNotificationHandlers(e){return ae(e,(()=>new d.Signal(this)))}constructClientRequestHandler(e){return ae(e,(e=>new oe(this.connection,e,this)))}constructServerRequestHandler(e){return ae(e,(e=>new re(this.connection,e,this)))}initializeParams(){return{...super.initializeParams(),capabilities:this._options.capabilities,initializationOptions:null,processId:null,workspaceFolders:null}}onServerInitialized(e){for(this.afterInitialized(),super.onServerInitialized(e);this.documentsToOpen.length;)this.sendOpen(this.documentsToOpen.pop());this._serverInitialized.emit(this.serverCapabilities)}afterInitialized(){const e=this.connection.onError((e=>this._errorSignal.emit(e)));this._disposables.push(e);for(const e of Object.values(J.ServerNotification)){const t=this.serverNotifications[e],n=this.connection.onNotification(e,(n=>{this.log(Z.serverNotifiedClient,{method:e,message:n}),t.emit(n)}));this._disposables.push(n)}for(const e of Object.values(J.ClientNotification))this.clientNotifications[e].connect(((t,n)=>{this.log(Z.clientNotifiedServer,{method:e,message:n}),this.connection.sendNotification(e,n).catch(console.error)}));this.clientRequests=this.constructClientRequestHandler(J.ClientRequest),this.serverRequests=this.constructServerRequestHandler(J.ServerRequest),this.serverRequests["client/registerCapability"].setHandler((async e=>{e.registrations.forEach((e=>{try{const t=K(this.serverCapabilities,e);if(null===t)return void console.error(`Failed to register server capability: ${e}`);this.serverCapabilities=t}catch(e){console.error(e)}}))})),this.serverRequests["client/unregisterCapability"].setHandler((async e=>{e.unregisterations.forEach((e=>{this.serverCapabilities=G(this.serverCapabilities,e)}))})),this.serverRequests["workspace/configuration"].setHandler((async e=>e.items.map((e=>null))))}_sendChange(e,t){if(!this.isReady)return;if(0===t.uri.length)return;this.openedUris.get(t.uri)||this.sendOpen(t);const n={textDocument:{uri:t.uri,version:t.version},contentChanges:e};this.connection.sendNotification("textDocument/didChange",n).catch(console.error),t.version++}}class ce{constructor(e){this.onNewConnection=e=>{e.errorSignal.connect(((t,n)=>{console.error(n);let i=n.length&&n.length>=1?n[0]:new Error;-1!==i.message.indexOf("code = 1005")?(console.error(`Connection failed for ${e}`),this._forEachDocumentOfConnection(e,(t=>{console.error("disconnecting "+t.uri),this._closed.emit({connection:e,virtualDocument:t}),this._ignoredLanguages.add(t.language),console.error(`Cancelling further attempts to connect ${t.uri} and other documents for this language (no support from the server)`)}))):-1!==i.message.indexOf("code = 1006")?console.error("Connection closed by the server"):console.error("Connection error:",n)})),e.serverInitialized.connect((()=>{this._forEachDocumentOfConnection(e,(t=>{this._initialized.emit({connection:e,virtualDocument:t})})),this.updateServerConfigurations(this.initialConfigurations)})),e.closeSignal.connect(((t,n)=>{n?(console.log("Connection closed"),this._forEachDocumentOfConnection(e,(t=>{this._closed.emit({connection:e,virtualDocument:t})}))):console.error("Connection unexpectedly disconnected")}))},this._initialized=new d.Signal(this),this._connected=new d.Signal(this),this._disconnected=new d.Signal(this),this._closed=new d.Signal(this),this._documentsChanged=new d.Signal(this),this.connections=new Map,this.documents=new Map,this.adapters=new Map,this._ignoredLanguages=new Set,this.languageServerManager=e.languageServerManager,ee.setLanguageServerManager(e.languageServerManager),e.adapterTracker.adapterAdded.connect(((e,t)=>{const n=t.widget.context.path;this.registerAdapter(n,t)}))}get initialized(){return this._initialized}get connected(){return this._connected}get disconnected(){return this._disconnected}get closed(){return this._closed}get documentsChanged(){return this._documentsChanged}get ready(){return ee.getLanguageServerManager().ready}connectDocumentSignals(e){e.foreignDocumentOpened.connect(this.onForeignDocumentOpened,this),e.foreignDocumentClosed.connect(this.onForeignDocumentClosed,this),this.documents.set(e.uri,e),this._documentsChanged.emit(this.documents)}disconnectDocumentSignals(e,t=!0){e.foreignDocumentOpened.disconnect(this.onForeignDocumentOpened,this),e.foreignDocumentClosed.disconnect(this.onForeignDocumentClosed,this),this.documents.delete(e.uri);for(const t of e.foreignDocuments.values())this.disconnectDocumentSignals(t,!1);t&&this._documentsChanged.emit(this.documents)}onForeignDocumentOpened(e,t){}onForeignDocumentClosed(e,t){const{foreignDocument:n}=t;this.unregisterDocument(n.uri,!1),this.disconnectDocumentSignals(n)}registerAdapter(e,t){this.adapters.set(e,t),t.widget.context.pathChanged.connect(((n,i)=>{this.adapters.delete(e),this.adapters.set(i,t)})),t.disposed.connect((()=>{t.virtualDocument&&this.documents.delete(t.virtualDocument.uri),this.adapters.delete(e)}))}updateConfiguration(e){this.languageServerManager.setConfiguration(e)}updateServerConfigurations(e){let t;for(t in e){if(!e.hasOwnProperty(t))continue;const n={settings:V(e[t].configuration||{})};ee.updateServerConfiguration(t,n)}}async retryToConnect(e,t,n=-1){let{virtualDocument:i}=e;if(this._ignoredLanguages.has(i.language))return;let s=1e3*t,o=!1;for(;0!==n&&!o;)await this.connect(e).then((()=>{o=!0})).catch((e=>{console.warn(e)})),console.log("will attempt to re-connect in "+s/1e3+" seconds"),await q(s),s=s<5e3?s+500:s}disconnect(e){ee.disconnect(e)}async connect(e,t=30,n=5){let i=await this._connectSocket(e),{virtualDocument:s}=e;if(i){if(!i.isReady)try{await W((()=>i.isReady),Math.round(1e3*t/150),150)}catch(e){console.log(`Connection to ${s.uri} timed out after ${t} seconds, will continue retrying for another ${n} minutes`);try{await W((()=>i.isReady),60*n,1e3)}catch(e){return void console.log(`Connection to ${s.uri} timed out again after ${n} minutes, giving up`)}}return this._connected.emit({connection:i,virtualDocument:s}),i}}unregisterDocument(e,t=!0){const n=this.connections.get(e);n&&(this.connections.delete(e),new Set(this.connections.values()).has(n)||(this.disconnect(n.serverIdentifier),n.dispose()),t&&this._documentsChanged.emit(this.documents))}updateLogging(e,t){for(const n of this.connections.values())n.logAllCommunication=e,null!==t&&n.clientNotifications["$/setTrace"].emit({value:t})}async _connectSocket(e){let{language:t,capabilities:n,virtualDocument:i}=e;this.connectDocumentSignals(i);const s=ce.solveUris(i,t),o=this.languageServerManager.getMatchingServers({language:t}),r=0===o.length?null:o[0];if(!s)return;const a=await ee.connection(t,r,s,this.onNewConnection,n);return this.connections.set(i.uri,a),a}_forEachDocumentOfConnection(e,t){for(const[n,i]of this.connections.entries())e===i&&t(this.documents.get(n))}}function de(e,t){return t.start.line===t.end.line?e.line===t.start.line&&e.column>=t.start.column&&e.column<=t.end.column:e.line===t.start.line&&e.column>=t.start.column&&e.line<t.end.line||e.line>t.start.line&&e.column<=t.end.column&&e.line===t.end.line||e.line>t.start.line&&e.line<t.end.line}!function(e){e.solveUris=function(e,t){var n;const i=ee.getLanguageServerManager(),s=i.settings.wsUrl,o=r.PageConfig.getOption("rootUri"),a=r.PageConfig.getOption("virtualDocumentsUri"),l={language:t},c=i.getMatchingServers(l),d=0===c.length?null:c[0];if(null===d)return;const h=i.getMatchingSpecs(l).get(d);h||console.warn(`Specification not available for server ${d}`);const u=!(null===(n=null==h?void 0:h.requires_documents_on_disk)||void 0===n||n),g=e.hasLspSupportedFile||u?o:a;let p=r.URLExt.join(g,e.uri);return!p.startsWith("file:///")&&p.startsWith("file://")&&(p=p.replace("file://","file:///"),p.startsWith("file:///users/")&&g.startsWith("file:///Users/")&&(p=p.replace("file:///users/","file:///Users/"))),{base:g,document:p,server:r.URLExt.join("ws://jupyter-lsp",t),socket:r.URLExt.join(s,"lsp","ws",d)}}}(ce||(ce={})),function(e){const t=new Map;let n;e.getLanguageServerManager=function(){return n},e.setLanguageServerManager=function(e){n=e},e.disconnect=function(e){const n=t.get(e);n&&(n.close(),t.delete(e))},e.connection=async function(n,i,s,o,r){let a=t.get(i);if(!a){const{settings:a}=e.getLanguageServerManager(),l=new a.WebSocket(s.socket),c=new le({languageId:n,serverUri:s.server,rootUri:s.base,serverIdentifier:i,capabilities:r});t.set(i,c),c.connect(l),o(c)}return a=t.get(i),a},e.updateServerConfiguration=function(e,n){const i=t.get(e);i&&i.sendConfigurationChange(n)}}(ee||(ee={}));class he{constructor(e){this.version=0,this._document=e}get text(){return this._document.value}get uri(){const e=ce.solveUris(this._document,this.languageId);return e?e.document:""}get languageId(){return this._document.language}}class ue{constructor(e){this.blankLinesBetweenCells=2,this._isDisposed=!1,this._foreignDocumentClosed=new d.Signal(this),this._foreignDocumentOpened=new d.Signal(this),this._changed=new d.Signal(this),this.options=e,this.path=this.options.path,this.fileExtension=e.fileExtension,this.hasLspSupportedFile=e.hasLspSupportedFile,this.parent=e.parent,this.language=e.language,this.virtualLines=new Map,this.sourceLines=new Map,this.foreignDocuments=new Map,this._editorToSourceLine=new Map,this._foreignCodeExtractors=e.foreignCodeExtractors,this.standalone=e.standalone||!1,this.instanceId=ue.instancesCount,ue.instancesCount+=1,this.unusedStandaloneDocuments=new z((()=>new Array)),this._remainingLifetime=6,this.documentInfo=new he(this),this.updateManager=new ge(this),this.updateManager.updateBegan.connect(this._updateBeganSlot,this),this.updateManager.blockAdded.connect(this._blockAddedSlot,this),this.updateManager.updateFinished.connect(this._updateFinishedSlot,this),this.clear()}static ceToCm(e){return{line:e.line,ch:e.column}}get isDisposed(){return this._isDisposed}get foreignDocumentClosed(){return this._foreignDocumentClosed}get foreignDocumentOpened(){return this._foreignDocumentOpened}get changed(){return this._changed}get virtualId(){return this.standalone?this.instanceId+"("+this.language+")":this.language}get ancestry(){return this.parent?this.parent.ancestry.concat([this]):[this]}get idPath(){return this.parent?this.parent.idPath+"-"+this.virtualId:this.virtualId}get uri(){const e=encodeURI(this.path);return this.parent?e+"."+this.idPath+"."+this.fileExtension:e}get value(){let e="\n".repeat(this.blankLinesBetweenCells);return this.lineBlocks.join(e)}get lastLine(){const e=this.lineBlocks[this.lineBlocks.length-1].split("\n");return e[e.length-1]}get root(){return this.parent?this.parent.root:this}dispose(){this._isDisposed||(this._isDisposed=!0,this.parent=null,this.closeAllForeignDocuments(),this.updateManager.dispose(),this.foreignDocuments.clear(),this.sourceLines.clear(),this.unusedStandaloneDocuments.clear(),this.virtualLines.clear(),this.documentInfo=null,this.lineBlocks=null,d.Signal.clearData(this))}clear(){this.unusedStandaloneDocuments.clear();for(let e of this.foreignDocuments.values())e.clear(),e.standalone&&this.unusedStandaloneDocuments.get(e.language).push(e);this.virtualLines.clear(),this.sourceLines.clear(),this.lastVirtualLine=0,this.lastSourceLine=0,this.lineBlocks=[]}documentAtSourcePosition(e){let t=this.sourceLines.get(e.line);if(!t)return this;let n={line:t.editorLine,column:e.ch};for(let[e,{virtualDocument:i}]of t.foreignDocumentsMap)if(de(n,e)){let t={line:n.line-e.start.line,ch:n.column-e.start.column};return i.documentAtSourcePosition(t)}return this}isWithinForeign(e){let t=this.sourceLines.get(e.line),n={line:t.editorLine,column:e.ch};for(let[e]of t.foreignDocumentsMap)if(de(n,e))return!0;return!1}transformFromEditorToRoot(e,t){if(!this._editorToSourceLine.has(e))return console.log("Editor not found in _editorToSourceLine map"),null;let n=this._editorToSourceLine.get(e);return{...t,line:t.line+n}}virtualPositionAtDocument(e){let t=this.sourceLines.get(e.line);if(null==t)throw new Error("Source line not mapped to virtual position");let n=t.virtualLine,i={line:t.editorLine,column:e.ch};for(let[e,n]of t.foreignDocumentsMap){const{virtualLine:t,virtualDocument:s}=n;if(de(i,e)){let n={line:i.line-e.start.line,ch:i.column-e.start.column};return s.isWithinForeign(n)?this.virtualPositionAtDocument(n):(n.line+=t,n)}}return{ch:e.ch,line:n}}appendCodeBlock(e,t={line:0,column:0},n){let i=e.value,s=e.ceEditor;if(this.isDisposed)return void console.warn("Cannot append code block: document disposed");let o=i.split("\n"),{lines:r,foreignDocumentsMap:a}=this.prepareCodeBlock(e,t);for(let e=0;e<r.length;e++)this.virtualLines.set(this.lastVirtualLine+e,{skipInspect:[],editor:s,sourceLine:this.lastSourceLine+e});for(let e=0;e<o.length;e++)this.sourceLines.set(this.lastSourceLine+e,{editorLine:e,editorShift:{line:t.line-((null==n?void 0:n.line)||0),column:0===e?t.column-((null==n?void 0:n.column)||0):0},editor:s,foreignDocumentsMap:a,virtualLine:this.lastVirtualLine+e});this.lastVirtualLine+=r.length,this.lineBlocks.push(r.join("\n")+"\n");for(let e=0;e<this.blankLinesBetweenCells;e++)this.virtualLines.set(this.lastVirtualLine+e,{skipInspect:[this.idPath],editor:s,sourceLine:null});this.lastVirtualLine+=this.blankLinesBetweenCells,this.lastSourceLine+=o.length}prepareCodeBlock(e,t={line:0,column:0}){let{cellCodeKept:n,foreignDocumentsMap:i}=this.extractForeignCode(e,t);return{lines:n.split("\n"),foreignDocumentsMap:i}}extractForeignCode(e,t){let n=new Map,i=e.value;const s=this._foreignCodeExtractors.getExtractors(e.type,null),o=this._foreignCodeExtractors.getExtractors(e.type,this.language);for(let r of[...s,...o]){if(!r.hasForeignCode(i,e.type))continue;let s=r.extractForeignCode(i),o="";for(let i of s){if(null!==i.foreignCode){if(null===i.range){console.log("Failure in foreign code extraction: `range` is null but `foreign_code` is not!");continue}let s=this._chooseForeignDocument(r);n.set(i.range,{virtualLine:s.lastVirtualLine,virtualDocument:s,editor:e.ceEditor});let o={line:t.line+i.range.start.line,column:t.column+i.range.start.column};s.appendCodeBlock({value:i.foreignCode,ceEditor:e.ceEditor,type:"code"},o,i.virtualShift)}null!=i.hostCode&&(o+=i.hostCode)}i=o}return{cellCodeKept:i,foreignDocumentsMap:n}}closeForeign(e){this._foreignDocumentClosed.emit({foreignDocument:e,parentHost:this}),this.foreignDocuments.delete(e.virtualId),e.closeAllForeignDocuments(),e.foreignDocumentClosed.disconnect(this.forwardClosedSignal,this),e.foreignDocumentOpened.disconnect(this.forwardOpenedSignal,this),e.dispose()}closeAllForeignDocuments(){for(let e of this.foreignDocuments.values())this.closeForeign(e)}closeExpiredDocuments(){const e=new Set;for(const t of this.sourceLines.values())for(const n of t.foreignDocumentsMap.values())e.add(n.virtualDocument);const t=new Map;for(const[e,n]of this.foreignDocuments.entries()){const i=t.get(n);void 0!==i&&t.set(n,[...i,e]),t.set(n,[e])}const n=new Set(t.keys()),i=new Set([...n].filter((t=>!e.has(t))));for(let e of i.values())if(e.remainingLifetime-=1,e.remainingLifetime<=0){e.dispose();const n=t.get(e);for(const e of n)this.foreignDocuments.delete(e)}}transformSourceToEditor(e){let t=this.sourceLines.get(e.line),n=t.editorLine,i=t.editorShift;return{ch:e.ch+(0===n?i.column:0),line:n+i.line}}transformVirtualToEditor(e){let t=this.transformVirtualToSource(e);return null==t?null:this.transformSourceToEditor(t)}transformVirtualToSource(e){const t=this.virtualLines.get(e.line).sourceLine;return null==t?null:{ch:e.ch,line:t}}transformVirtualToRoot(e){var t;const n=null===(t=this.virtualLines.get(e.line))||void 0===t?void 0:t.editor,i=this.transformVirtualToEditor(e);return n&&i?this.root.transformFromEditorToRoot(n,i):null}getEditorAtVirtualLine(e){let t=e.line;return this.virtualLines.has(t)||(t-=1),this.virtualLines.get(t).editor}getEditorAtSourceLine(e){return this.sourceLines.get(e.line).editor}maybeEmitChanged(){this.value!==this.previousValue&&this._changed.emit(this),this.previousValue=this.value;for(let e of this.foreignDocuments.values())e.maybeEmitChanged()}get remainingLifetime(){return this.parent?this._remainingLifetime:1/0}set remainingLifetime(e){this.parent&&(this._remainingLifetime=e)}_chooseForeignDocument(e){let t,n=this.foreignDocuments.has(e.language);if(!e.standalone&&n)t=this.foreignDocuments.get(e.language);else{let n=this.unusedStandaloneDocuments.get(e.language);t=e.standalone&&n.length>0?n.pop():this.openForeign(e.language,e.standalone,e.fileExtension)}return t}openForeign(e,t,n){let i=new this.constructor({...this.options,parent:this,standalone:t,fileExtension:n,language:e});const s={foreignDocument:i,parentHost:this};return this._foreignDocumentOpened.emit(s),i.foreignDocumentClosed.connect(this.forwardClosedSignal,this),i.foreignDocumentOpened.connect(this.forwardOpenedSignal,this),this.foreignDocuments.set(i.virtualId,i),i}forwardClosedSignal(e,t){this._foreignDocumentClosed.emit(t)}forwardOpenedSignal(e,t){this._foreignDocumentOpened.emit(t)}_updateBeganSlot(){this._editorToSourceLineNew=new Map}_blockAddedSlot(e,t){this._editorToSourceLineNew.set(t.block.ceEditor,t.virtualDocument.lastSourceLine)}_updateFinishedSlot(){this._editorToSourceLine=this._editorToSourceLineNew}}ue.instancesCount=0;class ge{constructor(e){this.virtualDocument=e,this._isDisposed=!1,this._updateDone=new Promise((e=>{e()})),this._isUpdateInProgress=!1,this._updateLock=!1,this._blockAdded=new d.Signal(this),this._documentUpdated=new d.Signal(this),this._updateBegan=new d.Signal(this),this._updateFinished=new d.Signal(this),this.documentUpdated.connect(this._onUpdated,this)}get updateDone(){return this._updateDone}get isDisposed(){return this._isDisposed}get blockAdded(){return this._blockAdded}get documentUpdated(){return this._documentUpdated}get updateBegan(){return this._updateBegan}get updateFinished(){return this._updateFinished}dispose(){this._isDisposed||(this._isDisposed=!0,this.documentUpdated.disconnect(this._onUpdated),d.Signal.clearData(this))}async withUpdateLock(e){await W((()=>this._canUpdate()),12,10).then((()=>{try{this._updateLock=!0,e()}finally{this._updateLock=!1}}))}async updateDocuments(e){let t=new Promise(((t,n)=>{W((()=>this._canUpdate()),10,5).then((()=>{!this.isDisposed&&this.virtualDocument||t();try{this._isUpdateInProgress=!0,this._updateBegan.emit(e),this.virtualDocument.clear();for(let t of e)this._blockAdded.emit({block:t,virtualDocument:this.virtualDocument}),this.virtualDocument.appendCodeBlock(t);this._updateFinished.emit(e),this.virtualDocument&&(this._documentUpdated.emit(this.virtualDocument),this.virtualDocument.maybeEmitChanged()),t()}catch(e){console.warn("Documents update failed:",e),n(e)}finally{this._isUpdateInProgress=!1}})).catch(console.error)}));return this._updateDone=t,t}_onUpdated(e,t){try{t.closeExpiredDocuments()}catch(e){console.warn("Failed to close expired documents")}}_canUpdate(){return!this.isDisposed&&!this._isUpdateInProgress&&!this._updateLock}}class pe extends B{constructor(e,t){super(e,t),this.editorWidget=e,this.options=t,this._type="code",this._readyDelegate=new c.PromiseDelegate,this._editorToCell=new Map,this.editor=e.content,this._cellToEditor=new WeakMap,Promise.all([this.widget.context.sessionContext.ready,this.connectionManager.ready]).then((async()=>{await this.initOnceReady(),this._readyDelegate.resolve()})).catch(console.error)}get documentPath(){return this.widget.context.path}get mimeType(){var e;let t,n=this.language_info();return t=n&&n.mimetype?n.mimetype:this.widget.content.codeMimetype,Array.isArray(t)?null!==(e=t[0])&&void 0!==e?e:O.U.defaultMimeType:t}get languageFileExtension(){let e=this.language_info();if(e&&e.file_extension)return e.file_extension.replace(".","")}get wrapperElement(){return this.widget.node}get editors(){if(this.isDisposed)return[];let e=this.widget.content;return this._editorToCell.clear(),e.isDisposed?[]:e.widgets.map((e=>({ceEditor:this._getCellEditor(e),type:e.model.type,value:e.model.sharedModel.getSource()})))}get activeEditor(){return this.editor.activeCell?this._getCellEditor(this.editor.activeCell):void 0}get ready(){return this._readyDelegate.promise}getEditorIndexAt(e){let t=this._getCellAt(e);return this.widget.content.widgets.findIndex((e=>t===e))}getEditorIndex(e){let t=this._editorToCell.get(e);return this.editor.widgets.findIndex((e=>t===e))}getEditorWrapper(e){return this._editorToCell.get(e).node}async onKernelChanged(e,t){if(t.newValue)try{const e=this._languageInfo;await W(this.isReady,-1),await this._updateLanguageInfo();const t=this._languageInfo;(null==e?void 0:e.name)!=t.name||(null==e?void 0:e.mimetype)!=(null==t?void 0:t.mimetype)||(null==e?void 0:e.file_extension)!=(null==t?void 0:t.file_extension)?(console.log(`Changed to ${this._languageInfo.name} kernel, reconnecting`),this.reloadConnection()):console.log("Keeping old LSP connection as the new kernel uses the same langauge")}catch(e){console.warn(e),this.reloadConnection()}}dispose(){this.isDisposed||(this.widget.context.sessionContext.kernelChanged.disconnect(this.onKernelChanged,this),this.widget.content.activeCellChanged.disconnect(this._activeCellChanged,this),super.dispose(),this._editorToCell.clear(),d.Signal.clearData(this))}isReady(){var e;return!this.widget.isDisposed&&this.widget.context.isReady&&this.widget.content.isVisible&&this.widget.content.widgets.length>0&&null!=(null===(e=this.widget.context.sessionContext.session)||void 0===e?void 0:e.kernel)}async handleCellChange(e,t){let n=[],i=[];const s=this._type;if("set"===t.type){let e=[],o=[];if(t.newValues.length===t.oldValues.length){for(let n=0;n<t.newValues.length;n++)t.oldValues[n].type===s&&t.newValues[n].type!==s?e.push(t.newValues[n]):t.oldValues[n].type!==s&&t.newValues[n].type===s&&o.push(t.newValues[n]);n=o,i=e}}else"add"==t.type&&(n=t.newValues.filter((e=>e.type===s)));(i.length||n.length||"set"===t.type||"move"===t.type||"remove"===t.type)&&await this.updateDocuments();for(let e of n){let t=this.widget.content.widgets.find((t=>t.model.id===e.id));t?this._getCellEditor(t):console.warn(`Widget for added cell with ID: ${e.id} not found!`)}}createVirtualDocument(){return new ue({language:this.language,foreignCodeExtractors:this.options.foreignCodeExtractorsManager,path:this.documentPath,fileExtension:this.languageFileExtension,standalone:!1,hasLspSupportedFile:!1})}language_info(){return this._languageInfo}async initOnceReady(){await W(this.isReady.bind(this),-1),await this._updateLanguageInfo(),this.initVirtual(),this.connectDocument(this.virtualDocument,!1).catch(console.warn),this.widget.context.sessionContext.kernelChanged.connect(this.onKernelChanged,this),this.widget.content.activeCellChanged.connect(this._activeCellChanged,this),this._connectModelSignals(this.widget),this.editor.modelChanged.connect((e=>{console.warn("Model changed, connecting cell change handler; this is not something we were expecting"),this._connectModelSignals(e)}))}_connectModelSignals(e){null===e.model?console.warn(`Model is missing for notebook ${e}, cannot connect cell changed signal!`):e.model.cells.changed.connect(this.handleCellChange,this)}async _updateLanguageInfo(){var e,t,n,i;const s=null===(i=await(null===(n=null===(t=null===(e=this.widget.context.sessionContext)||void 0===e?void 0:e.session)||void 0===t?void 0:t.kernel)||void 0===n?void 0:n.info))||void 0===i?void 0:i.language_info;if(!s)throw new Error("Language info update failed (no session, kernel, or info available)");this._languageInfo=s}_activeCellChanged(e,t){t&&t.model.type===this._type&&this._activeEditorChanged.emit({editor:this._getCellEditor(t)})}_getCellAt(e){let t=this.virtualDocument.getEditorAtVirtualLine(e);return this._editorToCell.get(t)}_getCellEditor(e){if(!this._cellToEditor.has(e)){const t=Object.freeze({getEditor:()=>e.editor,ready:async()=>(await e.ready,e.editor),reveal:async()=>(await this.editor.scrollToCell(e),e.editor)});this._cellToEditor.set(e,t),this._editorToCell.set(t,e),e.disposed.connect((()=>{this._cellToEditor.delete(e),this._editorToCell.delete(t),this._editorRemoved.emit({editor:t})})),this._editorAdded.emit({editor:t})}return this._cellToEditor.get(e)}}var fe=n(80281),me=n(86382);const ve="jp-mod-error";class _e extends fe.Widget{constructor(e){super(),this._dataDirty=!1,this._inputDirty=!1,this._source=null,this._originalValue=c.JSONExt.emptyObject,this._changeGuard=!1,this.translator=e.translator||a.nullTranslator,this._trans=this.translator.load("jupyterlab"),this.addClass("jp-JSONEditor"),this.headerNode=document.createElement("div"),this.headerNode.className="jp-JSONEditor-header",this.revertButtonNode=w.undoIcon.element({tag:"span",title:this._trans.__("Revert changes to data")}),this.commitButtonNode=w.checkIcon.element({tag:"span",title:this._trans.__("Commit changes to data"),marginLeft:"8px"}),this.editorHostNode=document.createElement("div"),this.editorHostNode.className="jp-JSONEditor-host",this.headerNode.appendChild(this.revertButtonNode),this.headerNode.appendChild(this.commitButtonNode),this.node.appendChild(this.headerNode),this.node.appendChild(this.editorHostNode);const t=new me.B.Model({mimeType:"application/json"});t.sharedModel.changed.connect(this._onModelChanged,this),this.model=t,this.editor=e.editorFactory({host:this.editorHostNode,model:t,config:{readOnly:!0}})}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.changed.disconnect(this._onSourceChanged,this),this._source=e,this.editor.setOption("readOnly",null===e),e&&e.changed.connect(this._onSourceChanged,this),this._setValue())}get isDirty(){return this._dataDirty||this._inputDirty}dispose(){var e;this.isDisposed||(null===(e=this.source)||void 0===e||e.dispose(),this.model.dispose(),this.editor.dispose(),super.dispose())}handleEvent(e){switch(e.type){case"blur":this._evtBlur(e);break;case"click":this._evtClick(e)}}onAfterAttach(e){const t=this.editorHostNode;t.addEventListener("blur",this,!0),t.addEventListener("click",this,!0),this.revertButtonNode.hidden=!0,this.commitButtonNode.hidden=!0,this.headerNode.addEventListener("click",this)}onBeforeDetach(e){const t=this.editorHostNode;t.removeEventListener("blur",this,!0),t.removeEventListener("click",this,!0),this.headerNode.removeEventListener("click",this)}_onSourceChanged(e,t){this._changeGuard||(this._inputDirty||this.editor.hasFocus()?this._dataDirty=!0:this._setValue())}_onModelChanged(e,t){if(t.sourceChange){let e=!0;try{const e=JSON.parse(this.editor.model.sharedModel.getSource());this.removeClass(ve),this._inputDirty=!this._changeGuard&&!c.JSONExt.deepEqual(e,this._originalValue)}catch(t){this.addClass(ve),this._inputDirty=!0,e=!1}this.revertButtonNode.hidden=!this._inputDirty,this.commitButtonNode.hidden=!e||!this._inputDirty}}_evtBlur(e){!this._inputDirty&&this._dataDirty&&this._setValue()}_evtClick(e){const t=e.target;this.revertButtonNode.contains(t)?this._setValue():this.commitButtonNode.contains(t)?this.commitButtonNode.hidden||this.hasClass(ve)||(this._changeGuard=!0,this._mergeContent(),this._changeGuard=!1,this._setValue()):this.editorHostNode.contains(t)&&this.editor.focus()}_mergeContent(){const e=this.editor.model,t=this._originalValue,n=JSON.parse(e.sharedModel.getSource()),i=this.source;if(i){for(const e in n)c.JSONExt.deepEqual(n[e],t[e]||null)||i.set(e,n[e]);for(const e in t)e in n||i.delete(e)}}_setValue(){this._dataDirty=!1,this._inputDirty=!1,this.revertButtonNode.hidden=!0,this.commitButtonNode.hidden=!0,this.removeClass(ve);const e=this.editor.model,t=this._source?this._source.toJSON():{};if(this._changeGuard=!0,void 0===t)e.sharedModel.setSource(this._trans.__("No data!")),this._originalValue=c.JSONExt.emptyObject;else{const n=JSON.stringify(t,null,4);e.sharedModel.setSource(n),this._originalValue=t,n.length>1&&"{"===n[0]&&this.editor.setCursorPosition({line:0,column:1})}this._changeGuard=!1,this.commitButtonNode.hidden=!0,this.revertButtonNode.hidden=!0}}var Ce,ye=n(29540),we=n(60731);class be extends fe.Widget{constructor(){super(),this._items=[],this.layout=new fe.PanelLayout,this.addClass("jp-RankedPanel")}addWidget(e,t){const n={widget:e,rank:t},i=l.ArrayExt.upperBound(this._items,n,Ce.itemCmp);l.ArrayExt.insert(this._items,i,n),this.layout.insertWidget(i,e)}onChildRemoved(e){const t=l.ArrayExt.findFirstIndex(this._items,(t=>t.widget===e.child));-1!==t&&l.ArrayExt.removeAt(this._items,t)}}class Se extends fe.Widget{constructor(e){super(),this.addClass("jp-NotebookTools"),this.translator=e.translator||a.nullTranslator,this._tools=[],this.layout=new fe.PanelLayout,this._tracker=e.tracker,this._tracker.currentChanged.connect(this._onActiveNotebookPanelChanged,this),this._tracker.activeCellChanged.connect(this._onActiveCellChanged,this),this._tracker.selectionChanged.connect(this._onSelectionChanged,this),this._onActiveNotebookPanelChanged(),this._onActiveCellChanged(),this._onSelectionChanged()}get activeCell(){return this._tracker.activeCell}get selectedCells(){const e=this._tracker.currentWidget;if(!e)return[];const t=e.content;return t.widgets.filter((e=>t.isSelectedOrActive(e)))}get activeNotebookPanel(){return this._tracker.currentWidget}addItem(e){var t;const n=e.tool,i=null!==(t=e.rank)&&void 0!==t?t:100;let s;const o=this._tools.find((t=>t.section===e.section));if(!o)throw new Error(`The section ${e.section} does not exist`);s=o.panel,n.addClass("jp-NotebookTools-tool"),s.addWidget(n,i),n.notebookTools=this,we.MessageLoop.sendMessage(n,Se.ActiveNotebookPanelMessage),we.MessageLoop.sendMessage(n,Se.ActiveCellMessage)}addSection(e){var t;const n=e.sectionName,i=e.label||e.sectionName,s=e.tool;let o=null!==(t=e.rank)&&void 0!==t?t:null;const r=new be;if(r.title.label=i,s&&r.addWidget(s,0),this._tools.push({section:n,panel:r,rank:o}),null!=o)this.layout.insertWidget(o,new w.Collapser({widget:r}));else{let e=null;const t=this.layout;for(let n=0;n<t.widgets.length;n++){let i=t.widgets[n];if(i instanceof w.Collapser&&"advancedToolsSection"===i.widget.id){e=n;break}}null!==e?this.layout.insertWidget(e,new w.Collapser({widget:r})):this.layout.addWidget(new w.Collapser({widget:r}))}}_onActiveNotebookPanelChanged(){this._prevActiveNotebookModel&&!this._prevActiveNotebookModel.isDisposed&&this._prevActiveNotebookModel.metadataChanged.disconnect(this._onActiveNotebookPanelMetadataChanged,this);const e=this.activeNotebookPanel&&this.activeNotebookPanel.content?this.activeNotebookPanel.content.model:null;this._prevActiveNotebookModel=e,e&&e.metadataChanged.connect(this._onActiveNotebookPanelMetadataChanged,this);for(const e of this._toolChildren())we.MessageLoop.sendMessage(e,Se.ActiveNotebookPanelMessage)}_onActiveCellChanged(){this._prevActiveCell&&!this._prevActiveCell.isDisposed&&this._prevActiveCell.metadataChanged.disconnect(this._onActiveCellMetadataChanged,this);const e=this.activeCell?this.activeCell.model:null;this._prevActiveCell=e,e&&e.metadataChanged.connect(this._onActiveCellMetadataChanged,this);for(const e of this._toolChildren())we.MessageLoop.sendMessage(e,Se.ActiveCellMessage)}_onSelectionChanged(){for(const e of this._toolChildren())we.MessageLoop.sendMessage(e,Se.SelectionMessage)}_onActiveNotebookPanelMetadataChanged(e,t){const n=new ye.U.ChangeMessage("activenotebookpanel-metadata-changed",{oldValue:void 0,newValue:void 0,...t});for(const e of this._toolChildren())we.MessageLoop.sendMessage(e,n)}_onActiveCellMetadataChanged(e,t){const n=new ye.U.ChangeMessage("activecell-metadata-changed",{newValue:void 0,oldValue:void 0,...t});for(const e of this._toolChildren())we.MessageLoop.sendMessage(e,n)}*_toolChildren(){for(let e of this._tools)yield*e.panel.children()}}!function(e){e.ActiveNotebookPanelMessage=new we.ConflatableMessage("activenotebookpanel-changed"),e.ActiveCellMessage=new we.ConflatableMessage("activecell-changed"),e.SelectionMessage=new we.ConflatableMessage("selection-changed");class t extends fe.Widget{dispose(){super.dispose(),this.notebookTools&&(this.notebookTools=null)}processMessage(e){switch(super.processMessage(e),e.type){case"activenotebookpanel-changed":this.onActiveNotebookPanelChanged(e);break;case"activecell-changed":this.onActiveCellChanged(e);break;case"selection-changed":this.onSelectionChanged(e);break;case"activecell-metadata-changed":this.onActiveCellMetadataChanged(e);break;case"activenotebookpanel-metadata-changed":this.onActiveNotebookPanelMetadataChanged(e)}}onActiveNotebookPanelChanged(e){}onActiveCellChanged(e){}onSelectionChanged(e){}onActiveCellMetadataChanged(e){}onActiveNotebookPanelMetadataChanged(e){}}e.Tool=t,e.MetadataEditorTool=class extends t{constructor(e){super();const{editorFactory:t}=e;this.addClass("jp-MetadataEditorTool");const n=this.layout=new fe.PanelLayout;this._editorFactory=t,this._editorLabel=e.label||"Edit Metadata",this.createEditor();const i=new fe.Widget({node:document.createElement("label")});i.node.textContent=e.label||"Edit Metadata",n.addWidget(i),n.addWidget(this.editor)}get editor(){return this._editor}onActiveNotebookPanelChanged(e){this.editor.dispose(),this.notebookTools.activeNotebookPanel&&this.createEditor()}createEditor(){this._editor=new _e({editorFactory:this._editorFactory}),this.editor.title.label=this._editorLabel,this.layout.addWidget(this.editor)}}}(Se||(Se={})),function(e){e.itemCmp=function(e,t){return e.rank-t.rank}}(Ce||(Ce={}));var ke=n(54006),xe=n(86752),Ee=n(72363),Me=n(38047),Ie=n(76231),Te=n(74299);const Ne="jp-mod-dropTarget",De="jp-mod-dropSource";var Ae=n(8363);class Pe extends w.WindowedListModel{constructor(e,t){super(t),this.cells=e,this.estimateWidgetSize=e=>{var t;const n=this.cells[e].model,i=this.cellsEstimatedHeight.get(n.id);if("number"==typeof i)return i;const o=n.sharedModel.getSource().split("\n").length;let r=0;if(n instanceof s.DJ)for(let e=0;e<n.outputs.length;e++)r=(null!==(t=n.outputs.get(e).data["text/plain"])&&void 0!==t?t:"").split("\n").length;return Pe.DEFAULT_EDITOR_LINE_HEIGHT*(o+r)+Pe.DEFAULT_CELL_MARGIN},this.widgetRenderer=e=>this.cells[e],this.scrollDownThreshold=Pe.DEFAULT_CELL_MARGIN/2+Pe.DEFAULT_EDITOR_LINE_HEIGHT,this.scrollUpThreshold=Pe.DEFAULT_CELL_MARGIN/2,this.cellsEstimatedHeight=new Map,this._emitEstimatedHeightChanged=new Ae.Debouncer((()=>{this._stateChanged.emit({name:"estimatedWidgetSize",newValue:null,oldValue:null})})),this._estimatedWidgetSize=Pe.DEFAULT_CELL_SIZE}setEstimatedWidgetSize(e,t){null===t?this.cellsEstimatedHeight.has(e)&&this.cellsEstimatedHeight.delete(e):(this.cellsEstimatedHeight.set(e,t),this._emitEstimatedHeightChanged.invoke().catch((e=>{console.error("Fail to trigger an update following a estimated height update.",e)})))}}Pe.DEFAULT_CELL_SIZE=39,Pe.DEFAULT_EDITOR_LINE_HEIGHT=17,Pe.DEFAULT_CELL_MARGIN=22;class Oe extends w.WindowedLayout{constructor(){super(...arguments),this._header=null,this._footer=null,this._willBeRemoved=null,this._topHiddenCodeCells=-1}get header(){return this._header}set header(e){var t;this._header&&this._header.isAttached&&fe.Widget.detach(this._header),this._header=e,this._header&&(null===(t=this.parent)||void 0===t?void 0:t.isAttached)&&fe.Widget.attach(this._header,this.parent.node)}get footer(){return this._footer}set footer(e){var t;this._footer&&this._footer.isAttached&&fe.Widget.detach(this._footer),this._footer=e,this._footer&&(null===(t=this.parent)||void 0===t?void 0:t.isAttached)&&fe.Widget.attach(this._footer,this.parent.outerNode)}get activeCell(){return this._activeCell}set activeCell(e){this._activeCell=e}dispose(){var e,t;this.isDisposed||(null===(e=this._header)||void 0===e||e.dispose(),null===(t=this._footer)||void 0===t||t.dispose(),super.dispose())}removeWidget(e){const t=this.widgets.indexOf(e);t>=0?this.removeWidgetAt(t):e===this._willBeRemoved&&this.parent&&this.detachWidget(t,e)}attachWidget(e,t){const n=t.isPlaceholder(),i=this._isSoftHidden(t);if(this.parent.isAttached&&!i&&we.MessageLoop.sendMessage(t,fe.Widget.Msg.BeforeAttach),i&&this._toggleSoftVisibility(t,!0),!n&&t instanceof o.Yr&&t.node.parentElement)t.node.style.display="",this._topHiddenCodeCells=-1;else if(!i){const e=this._findNearestChildBinarySearch(this.parent.viewportNode.childElementCount-1,0,parseInt(t.dataset.windowedListIndex,10)+1);let n=this.parent.viewportNode.children[e];this.parent.viewportNode.insertBefore(t.node,n),this.parent.isAttached&&we.MessageLoop.sendMessage(t,fe.Widget.Msg.AfterAttach)}t.inViewport=!0}detachWidget(e,t){t.inViewport=!1,t!==this.activeCell||t===this._willBeRemoved?(t instanceof o.Yr&&!t.node.classList.contains(De)&&t!==this._willBeRemoved?(t.node.style.display="none",this._topHiddenCodeCells=-1):(this.parent.isAttached&&we.MessageLoop.sendMessage(t,fe.Widget.Msg.BeforeDetach),this.parent.viewportNode.removeChild(t.node),t.node.classList.remove(Ne)),this.parent.isAttached&&we.MessageLoop.sendMessage(t,fe.Widget.Msg.AfterDetach)):this._toggleSoftVisibility(t,!1)}moveWidget(e,t,n){if(this._topHiddenCodeCells<0){this._topHiddenCodeCells=0;for(let e=0;e<this.parent.viewportNode.children.length&&"none"==this.parent.viewportNode.children[e].style.display;e++)this._topHiddenCodeCells++}const i=this.parent.viewportNode.children[t+this._topHiddenCodeCells];e<t?i.insertAdjacentElement("afterend",n.node):i.insertAdjacentElement("beforebegin",n.node)}onAfterAttach(e){super.onAfterAttach(e),this._header&&!this._header.isAttached&&fe.Widget.attach(this._header,this.parent.node,this.parent.node.firstElementChild),this._footer&&!this._footer.isAttached&&fe.Widget.attach(this._footer,this.parent.outerNode)}onBeforeDetach(e){var t,n;(null===(t=this._header)||void 0===t?void 0:t.isAttached)&&fe.Widget.detach(this._header),(null===(n=this._footer)||void 0===n?void 0:n.isAttached)&&fe.Widget.detach(this._footer),super.onBeforeDetach(e)}onChildRemoved(e){this._willBeRemoved=e.child,super.onChildRemoved(e),this._willBeRemoved=null}_toggleSoftVisibility(e,t){t?(e.node.style.opacity="",e.node.style.height="",e.node.style.padding=""):(e.node.style.opacity="0",e.node.style.height="0",e.node.style.padding="0")}_isSoftHidden(e){return"0"===e.node.style.opacity}_findNearestChildBinarySearch(e,t,n){for(;t<=e;){const i=t+Math.floor((e-t)/2),s=parseInt(this.parent.viewportNode.children[i].dataset.windowedListIndex,10);if(s===n)return i;s<n?t=i+1:s>n&&(e=i-1)}return t>0?t:0}}class Re extends fe.Widget{constructor(e){super({node:document.createElement("button")}),this.notebook=e;const t=e.translator.load("jupyterlab");this.addClass("jp-Notebook-footer"),this.node.setAttribute("tabindex","-1"),this.node.innerText=t.__("Click to add a cell.")}handleEvent(e){switch(e.type){case"click":this.onClick();break;case"keydown":if("ArrowUp"===e.key){this.onArrowUp();break}}}onClick(){this.notebook.widgets.length>0&&(this.notebook.activeCellIndex=this.notebook.widgets.length-1),m.insertBelow(this.notebook),m.focusActiveCell(this.notebook)}onArrowUp(){}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("click",this),this.node.addEventListener("keydown",this)}onBeforeDetach(e){this.node.removeEventListener("click",this),this.node.removeEventListener("keydown",this),super.onBeforeDetach(e)}}const Le="jp-Notebook-cell",He="jp-mod-editMode",je="jp-mod-commandMode",Fe="jp-mod-active",Be="jp-mod-selected",qe="jp-mod-multiSelected",We="jp-dragImage",Ve="jp-dragImage-singlePrompt",Ue="jp-dragImage-content",ze="jp-dragImage-prompt",$e="jp-dragImage-multipleBack",Je="application/vnd.jupyter.cells",Ke="jp-mod-sideBySide";void 0===window.requestIdleCallback&&(window.requestIdleCallback=function(e){let t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1)},window.cancelIdleCallback=function(e){clearTimeout(e)});class Ge extends w.WindowedList{constructor(e){var t,n,i,s,o,r;const l=new Array,c="full"===(null!==(n=null===(t=e.notebookConfig)||void 0===t?void 0:t.windowingMode)&&void 0!==n?n:Ge.defaultNotebookConfig.windowingMode);super({model:new Pe(l,{overscanCount:null!==(s=null===(i=e.notebookConfig)||void 0===i?void 0:i.overscanCount)&&void 0!==s?s:Ge.defaultNotebookConfig.overscanCount,windowingActive:c}),layout:new Oe,renderer:null!==(o=e.renderer)&&void 0!==o?o:w.WindowedList.defaultRenderer,scrollbar:!1}),this._cellCollapsed=new d.Signal(this),this._cellInViewportChanged=new d.Signal(this),this._renderingLayoutChanged=new d.Signal(this),this.addClass("jp-Notebook"),this.cellsArray=l,this._idleCallBack=null,this._editorConfig=Ge.defaultEditorConfig,this._notebookConfig=Ge.defaultNotebookConfig,this._mimetype=O.U.defaultMimeType,this._notebookModel=null,this._modelChanged=new d.Signal(this),this._modelContentChanged=new d.Signal(this),this.node.dataset.jpKernelUser="true",this.node.dataset.jpUndoer="true",this.node.dataset.jpCodeRunner="true",this.rendermime=e.rendermime,this.translator=e.translator||a.nullTranslator,this.contentFactory=e.contentFactory,this.editorConfig=e.editorConfig||Ge.defaultEditorConfig,this.notebookConfig=e.notebookConfig||Ge.defaultNotebookConfig,this._updateNotebookConfig(),this._mimetypeService=e.mimeTypeService,this.renderingLayout=null===(r=e.notebookConfig)||void 0===r?void 0:r.renderingLayout,this.kernelHistory=e.kernelHistory}get cellCollapsed(){return this._cellCollapsed}get cellInViewportChanged(){return this._cellInViewportChanged}get modelChanged(){return this._modelChanged}get modelContentChanged(){return this._modelContentChanged}get renderingLayoutChanged(){return this._renderingLayoutChanged}get model(){return this._notebookModel}set model(e){var t;if(e=e||null,this._notebookModel===e)return;const n=this._notebookModel;this._notebookModel=e,this._onModelChanged(n,e),this.onModelChanged(n,e),this._modelChanged.emit(void 0),this.viewModel.itemsList=null!==(t=null==e?void 0:e.cells)&&void 0!==t?t:null}get codeMimetype(){return this._mimetype}get widgets(){return this.cellsArray}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e,this._updateEditorConfig()}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e,this._updateNotebookConfig()}get renderingLayout(){return this._renderingLayout}set renderingLayout(e){var t;this._renderingLayout=e,"side-by-side"===this._renderingLayout?this.node.classList.add(Ke):this.node.classList.remove(Ke),this._renderingLayoutChanged.emit(null!==(t=this._renderingLayout)&&void 0!==t?t:"default")}dispose(){var e;this.isDisposed||(this._notebookModel=null,null===(e=this.layout.header)||void 0===e||e.dispose(),super.dispose())}moveCell(e,t,n=1){if(!this.model)return;const i=Math.min(this.model.cells.length-1,Math.max(0,t));if(i===e)return;const s=new Array(n);let o=new Array(n);for(let t=0;t<n;t++){s[t]={};const n=this.widgets[e+t];if("markdown"===n.model.type)for(const e of["rendered","headingCollapsed"])s[t][e]=n[e];else if("code"===n.model.type){const e=n.model;o[t]=e.isDirty}}this.model.sharedModel.moveCells(e,i,n);for(let i=0;i<n;i++){const r=this.widgets[t+i],a=s[i];for(const e in a)r[e]=a[e];e>t?"code"===this.widgets[t+i].model.type&&(this.widgets[t+i].model.isDirty=o[i]):"code"===this.widgets[t+i-n+1].model.type&&(this.widgets[t+i-n+1].model.isDirty=o[i])}}renderCellOutputs(e){const t=this.viewModel.widgetRenderer(e);t instanceof o.Yr&&t.isPlaceholder()&&(t.dataset.windowedListIndex=`${e}`,this.layout.insertWidget(e,t),"full"===this.notebookConfig.windowingMode&&requestAnimationFrame((()=>{this.layout.removeWidget(t)})))}addHeader(){const e=this.translator.load("jupyterlab"),t=new fe.Widget;t.node.textContent=e.__("The notebook is empty. Click the + button on the toolbar to add a new cell."),this.layout.header=t}removeHeader(){var e;null===(e=this.layout.header)||void 0===e||e.dispose(),this.layout.header=null}onModelChanged(e,t){}onModelContentChanged(e,t){this._modelContentChanged.emit(void 0)}onMetadataChanged(e,t){"language_info"===t.key&&this._updateMimetype()}onCellInserted(e,t){}onCellRemoved(e,t){}onUpdateRequest(e){"defer"===this.notebookConfig.windowingMode?this._runOnIdleTime():super.onUpdateRequest(e)}_onModelChanged(e,t){var n;if(e)for(e.contentChanged.disconnect(this.onModelContentChanged,this),e.metadataChanged.disconnect(this.onMetadataChanged,this),e.cells.changed.disconnect(this._onCellsChanged,this);this.cellsArray.length;)this._removeCell(0);if(!t)return void(this._mimetype=O.U.defaultMimeType);this._updateMimetype();const i=t.cells;null!==(n=t.collaborative)&&void 0!==n&&n||i.length||t.sharedModel.insertCell(0,{cell_type:this.notebookConfig.defaultCell,metadata:"code"===this.notebookConfig.defaultCell?{trusted:!0}:{}});let s=-1;for(const e of i)this._insertCell(++s,e);t.cells.changed.connect(this._onCellsChanged,this),t.metadataChanged.connect(this.onMetadataChanged,this),t.contentChanged.connect(this.onModelContentChanged,this)}_onCellsChanged(e,t){switch(this.removeHeader(),t.type){case"add":{let e=0;e=t.newIndex;for(const n of t.newValues)this._insertCell(e++,n);this._updateDataWindowedListIndex(t.newIndex,this.model.cells.length,t.newValues.length);break}case"remove":for(let e=t.oldValues.length;e>0;e--)this._removeCell(t.oldIndex);if(this._updateDataWindowedListIndex(t.oldIndex,this.model.cells.length+t.oldValues.length,-1*t.oldValues.length),!e.length){const e=this.model;requestAnimationFrame((()=>{!e||e.isDisposed||e.sharedModel.cells.length||e.sharedModel.insertCell(0,{cell_type:this.notebookConfig.defaultCell,metadata:"code"===this.notebookConfig.defaultCell?{trusted:!0}:{}})}))}break;default:return}this.model.sharedModel.cells.length||this.addHeader(),this.update()}_insertCell(e,t){let n;switch(t.type){case"code":n=this._createCodeCell(t),n.model.mimeType=this._mimetype;break;case"markdown":n=this._createMarkdownCell(t),""===t.sharedModel.getSource()&&(n.rendered=!1);break;default:n=this._createRawCell(t)}n.inViewportChanged.connect(this._onCellInViewportChanged,this),n.addClass(Le),l.ArrayExt.insert(this.cellsArray,e,n),this.onCellInserted(e,n),this._scheduleCellRenderOnIdle()}_createCodeCell(e){const t=this.rendermime,n={contentFactory:this.contentFactory,editorConfig:this.editorConfig.code,inputHistoryScope:this.notebookConfig.inputHistoryScope,maxNumberOutputs:this.notebookConfig.maxNumberOutputs,model:e,placeholder:"none"!==this._notebookConfig.windowingMode,rendermime:t,translator:this.translator},i=this.contentFactory.createCodeCell(n);return i.syncCollapse=!0,i.syncEditable=!0,i.syncScrolled=!0,i.outputArea.inputRequested.connect(((e,t)=>{this._onInputRequested(i).catch((e=>{console.error("Failed to scroll to cell requesting input.",e)})),t.disposed.connect((()=>{i.node.focus()}))})),i}_createMarkdownCell(e){const t=this.rendermime,n={contentFactory:this.contentFactory,editorConfig:this.editorConfig.markdown,model:e,placeholder:"none"!==this._notebookConfig.windowingMode,rendermime:t,showEditorForReadOnlyMarkdown:this._notebookConfig.showEditorForReadOnlyMarkdown},i=this.contentFactory.createMarkdownCell(n);return i.syncCollapse=!0,i.syncEditable=!0,i.headingCollapsedChanged.connect(this._onCellCollapsed,this),i}_createRawCell(e){const t=this.contentFactory,n={editorConfig:this.editorConfig.raw,model:e,contentFactory:t,placeholder:"none"!==this._notebookConfig.windowingMode},i=this.contentFactory.createRawCell(n);return i.syncCollapse=!0,i.syncEditable=!0,i}_removeCell(e){const t=this.cellsArray[e];t.parent=null,l.ArrayExt.removeAt(this.cellsArray,e),this.onCellRemoved(e,t),t.dispose()}_updateMimetype(){var e;const t=null===(e=this._notebookModel)||void 0===e?void 0:e.getMetadata("language_info");if(t){this._mimetype=this._mimetypeService.getMimeTypeByLanguage(t);for(const e of this.widgets)"code"===e.model.type&&(e.model.mimeType=this._mimetype)}}_onCellCollapsed(e,t){m.setHeadingCollapse(e,t,this),this._cellCollapsed.emit(e)}_onCellInViewportChanged(e){this._cellInViewportChanged.emit(e)}async _onInputRequested(e){if(!e.inViewport){const t=this.widgets.findIndex((t=>t===e));if(t>=0){await this.scrollToItem(t);const n=e.node.querySelector(".jp-Stdin");n&&(Ee.ElementExt.scrollIntoViewIfNeeded(this.node,n),n.focus())}}}_scheduleCellRenderOnIdle(){"none"===this.notebookConfig.windowingMode||this.isDisposed||this._idleCallBack||(this._idleCallBack=requestIdleCallback((e=>{this._idleCallBack=null,this._runOnIdleTime(e.didTimeout?50:e.timeRemaining())}),{timeout:3e3}))}_updateDataWindowedListIndex(e,t,n){for(let i=0;i<this.viewportNode.childElementCount;i++){const s=this.viewportNode.children[i],o=parseInt(s.dataset.windowedListIndex,10);o>=e&&o<t&&(s.dataset.windowedListIndex=`${o+n}`)}}_updateEditorConfig(){for(let e=0;e<this.widgets.length;e++){const t=this.widgets[e];let n={};switch(t.model.type){case"code":n=this._editorConfig.code;break;case"markdown":n=this._editorConfig.markdown;break;default:n=this._editorConfig.raw}t.updateEditorConfig({...n})}}async _runOnIdleTime(e=50){const t=Date.now();let n=0;for(;Date.now()-t<e&&n<this.cellsArray.length;){const e=this.cellsArray[n];e.isPlaceholder()&&["defer","full"].includes(this.notebookConfig.windowingMode)&&(await this._updateForDeferMode(e,n),"full"===this.notebookConfig.windowingMode&&requestAnimationFrame((()=>{this.viewModel.setEstimatedWidgetSize(e.model.id,e.node.getBoundingClientRect().height),this.layout.removeWidget(e)}))),n++}n<this.cellsArray.length?"defer"===this.notebookConfig.windowingMode&&this.viewportNode.clientHeight<this.node.clientHeight?await this._runOnIdleTime():this._scheduleCellRenderOnIdle():this._idleCallBack&&(window.cancelIdleCallback(this._idleCallBack),this._idleCallBack=null)}async _updateForDeferMode(e,t){e.dataset.windowedListIndex=`${t}`,this.layout.insertWidget(t,e),await e.ready}_updateNotebookConfig(){this.toggleClass("jp-mod-scrollPastEnd",this._notebookConfig.scrollPastEnd),this.toggleClass("jp-mod-showHiddenCellsButton",this._notebookConfig.showHiddenCellsButton);const e=this._notebookConfig.showEditorForReadOnlyMarkdown;if(void 0!==e)for(const t of this.cellsArray)"markdown"===t.model.type&&(t.showEditorForReadOnly=e);this.viewModel.windowingActive="full"===this._notebookConfig.windowingMode}}!function(e){e.defaultEditorConfig={code:{lineNumbers:!1,lineWrap:!1,matchBrackets:!0,tabFocusable:!1},markdown:{lineNumbers:!1,lineWrap:!0,matchBrackets:!1,tabFocusable:!1},raw:{lineNumbers:!1,lineWrap:!0,matchBrackets:!1,tabFocusable:!1}},e.defaultNotebookConfig={enableKernelInitNotification:!1,showHiddenCellsButton:!0,scrollPastEnd:!0,defaultCell:"code",recordTiming:!1,inputHistoryScope:"global",maxNumberOutputs:50,showEditorForReadOnlyMarkdown:!0,disableDocumentWideUndoRedo:!0,renderingLayout:"default",sideBySideLeftMarginOverride:"10px",sideBySideRightMarginOverride:"10px",sideBySideOutputRatio:1,overscanCount:1,windowingMode:"full",accessKernelHistory:!1};class t extends o.fh.ContentFactory{createCodeCell(e){return new o.Yr(e).initializeState()}createMarkdownCell(e){return new o.KI(e).initializeState()}createRawCell(e){return new o.J0(e).initializeState()}}e.ContentFactory=t}(Ge||(Ge={}));class Qe extends Ge{constructor(e){super({renderer:{createOuter:()=>document.createElement("div"),createViewport(){const e=document.createElement("div");return e.setAttribute("role","feed"),e.setAttribute("aria-label","Cells"),e},createScrollbar:()=>document.createElement("ol"),createScrollbarItem(e,t,n){const i=document.createElement("li");return i.appendChild(document.createTextNode(`${t+1}`)),e.activeCellIndex===t&&i.classList.add("jp-mod-active"),e.selectedCells.some((e=>n===e.model))&&i.classList.add("jp-mod-selected"),i}},...e}),this._activeCellIndex=-1,this._activeCell=null,this._mode="command",this._drag=null,this._dragData=null,this._selectData=null,this._mouseMode=null,this._activeCellChanged=new d.Signal(this),this._stateChanged=new d.Signal(this),this._selectionChanged=new d.Signal(this),this._checkCacheOnNextResize=!1,this._lastClipboardInteraction=null,this._selectedCells=[],this.outerNode.setAttribute("data-lm-dragscroll","true"),this.activeCellChanged.connect(this._updateSelectedCells,this),this.jumped.connect(((e,t)=>this.activeCellIndex=t)),this.selectionChanged.connect(this._updateSelectedCells,this),this.addFooter()}get selectedCells(){return this._selectedCells}addFooter(){const e=new Re(this);this.layout.footer=e}_onCellsChanged(e,t){var n,i;const s=null===(n=this.activeCell)||void 0===n?void 0:n.model.id;if(super._onCellsChanged(e,t),s){const e=null===(i=this.model)||void 0===i?void 0:i.sharedModel.cells.findIndex((e=>e.getId()===s));null!=e&&(this.activeCellIndex=e)}}get activeCellChanged(){return this._activeCellChanged}get stateChanged(){return this._stateChanged}get selectionChanged(){return this._selectionChanged}get mode(){return this._mode}set mode(e){this.setMode(e)}setMode(e,t={}){var n;const i=null===(n=t.focus)||void 0===n||n,s=this.activeCell;if(s||(e="command"),e===this._mode)return void(i&&this._ensureFocus());this.update();const r=this._mode;if(this._mode=e,"edit"===e){for(const e of this.widgets)this.deselect(e);s instanceof o.KI&&(s.rendered=!1),s.inputHidden=!1}else i&&m.focusActiveCell(this,{waitUntilReady:!1,preventScroll:!0});this._stateChanged.emit({name:"mode",oldValue:r,newValue:e}),i&&this._ensureFocus()}get activeCellIndex(){return this.model&&this.widgets.length?this._activeCellIndex:-1}set activeCellIndex(e){var t;const n=this._activeCellIndex;this.model&&this.widgets.length?(e=Math.max(e,0),e=Math.min(e,this.widgets.length-1)):e=-1,this._activeCellIndex=e;const i=null!==(t=this.widgets[e])&&void 0!==t?t:null;this.layout.activeCell=i;const s=i!==this._activeCell;s&&(this.update(),this._activeCell=i),(s||e!=n)&&this._activeCellChanged.emit(i),"edit"===this.mode&&i instanceof o.KI&&(i.rendered=!1),this._ensureFocus(),e!==n&&(this._trimSelections(),this._stateChanged.emit({name:"activeCellIndex",oldValue:n,newValue:e}))}get activeCell(){return this._activeCell}get lastClipboardInteraction(){return this._lastClipboardInteraction}set lastClipboardInteraction(e){this._lastClipboardInteraction=e}dispose(){this.isDisposed||(this._activeCell=null,super.dispose())}moveCell(e,t,n=1){const i=e<=this.activeCellIndex&&this.activeCellIndex<e+n?this.activeCellIndex+t-e-(e>t?0:n-1):-1,s=this.widgets.slice(e,e+n).map((e=>this.isSelected(e)));super.moveCell(e,t,n),i>=0&&(this.activeCellIndex=i),e>t?s.forEach(((e,n)=>{e&&this.select(this.widgets[t+n])})):s.forEach(((e,i)=>{e&&this.select(this.widgets[t-n+1+i])}))}select(e){Ye.selectedProperty.get(e)||(Ye.selectedProperty.set(e,!0),this._selectionChanged.emit(void 0),this.update())}deselect(e){Ye.selectedProperty.get(e)&&(Ye.selectedProperty.set(e,!1),this._selectionChanged.emit(void 0),this.update())}isSelected(e){return Ye.selectedProperty.get(e)}isSelectedOrActive(e){return e===this._activeCell||Ye.selectedProperty.get(e)}deselectAll(){let e=!1;for(const t of this.widgets)Ye.selectedProperty.get(t)&&(e=!0),Ye.selectedProperty.set(t,!1);e&&this._selectionChanged.emit(void 0),this.activeCellIndex=this.activeCellIndex,this.update()}extendContiguousSelectionTo(e){let t,{head:n,anchor:i}=this.getContiguousSelection();if(null===i||null===n){if(e===this.activeCellIndex)return;n=this.activeCellIndex,i=this.activeCellIndex}if(this.activeCellIndex=e,(e=this.activeCellIndex)===i)return void this.deselectAll();let s=!1;if(n<e)for(n<i&&(Ye.selectedProperty.set(this.widgets[n],!1),s=!0),t=n+1;t<e;t++)t!==i&&(Ye.selectedProperty.set(this.widgets[t],!Ye.selectedProperty.get(this.widgets[t])),s=!0);else if(e<n)for(i<n&&(Ye.selectedProperty.set(this.widgets[n],!1),s=!0),t=e+1;t<n;t++)t!==i&&(Ye.selectedProperty.set(this.widgets[t],!Ye.selectedProperty.get(this.widgets[t])),s=!0);Ye.selectedProperty.get(this.widgets[i])||(s=!0),Ye.selectedProperty.set(this.widgets[i],!0),Ye.selectedProperty.get(this.widgets[e])||(s=!0),Ye.selectedProperty.set(this.widgets[e],!0),s&&this._selectionChanged.emit(void 0)}getContiguousSelection(){const e=this.widgets,t=l.ArrayExt.findFirstIndex(e,(e=>this.isSelected(e)));if(-1===t)return{head:null,anchor:null};const n=l.ArrayExt.findLastIndex(e,(e=>this.isSelected(e)),-1,t);for(let i=t;i<=n;i++)if(!this.isSelected(e[i]))throw new Error("Selection not contiguous");const i=this.activeCellIndex;if(t!==i&&n!==i)throw new Error("Active cell not at endpoint of selection");return t===i?{head:t,anchor:n}:{head:n,anchor:t}}async scrollToCell(e,t="auto"){try{await this.scrollToItem(this.widgets.findIndex((t=>t===e)),t)}catch(e){}this.deselectAll(),this.select(e),e.activate()}_parseFragment(e){const t=e.slice(1);if(!t)return;const n=t.split("=");return 1===n.length?{kind:"heading",value:t}:{kind:n[0],value:n.slice(1).join("=")}}async setFragment(e){const t=this._parseFragment(e);if(!t)return;let n;switch(t.kind){case"heading":n=await this._findHeading(t.value);break;case"cell-id":n=this._findCellById(t.value);break;default:console.warn(`Unknown target type for URI fragment ${e}, interpreting as a heading`),n=await this._findHeading(t.kind+"="+t.value)}if(null==n)return;let{cell:i,element:s}=n;i.inViewport||await this.scrollToCell(i,"center"),null==s&&(s=i.node);const o=this.node.getBoundingClientRect(),r=s.getBoundingClientRect();(r.top>o.bottom||r.bottom<o.top)&&s.scrollIntoView({block:"center"})}handleEvent(e){if(this.model)switch(e.type){case"contextmenu":e.eventPhase===Event.CAPTURING_PHASE&&this._evtContextMenuCapture(e);break;case"mousedown":e.eventPhase===Event.CAPTURING_PHASE?this._evtMouseDownCapture(e):e.defaultPrevented||this._evtMouseDown(e);break;case"mouseup":e.currentTarget===document&&this._evtDocumentMouseup(e);break;case"mousemove":e.currentTarget===document&&this._evtDocumentMousemove(e);break;case"keydown":this._ensureFocus(!0);break;case"dblclick":this._evtDblClick(e);break;case"focusin":this._evtFocusIn(e);break;case"focusout":this._evtFocusOut(e);break;case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:super.handleEvent(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("contextmenu",this,!0),t.addEventListener("mousedown",this,!0),t.addEventListener("mousedown",this),t.addEventListener("keydown",this),t.addEventListener("dblclick",this),t.addEventListener("focusin",this),t.addEventListener("focusout",this),t.addEventListener("lm-dragenter",this,!0),t.addEventListener("lm-dragleave",this,!0),t.addEventListener("lm-dragover",this,!0),t.addEventListener("lm-drop",this,!0)}onBeforeDetach(e){const t=this.node;t.removeEventListener("contextmenu",this,!0),t.removeEventListener("mousedown",this,!0),t.removeEventListener("mousedown",this),t.removeEventListener("keydown",this),t.removeEventListener("dblclick",this),t.removeEventListener("focusin",this),t.removeEventListener("focusout",this),t.removeEventListener("lm-dragenter",this,!0),t.removeEventListener("lm-dragleave",this,!0),t.removeEventListener("lm-dragover",this,!0),t.removeEventListener("lm-drop",this,!0),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),super.onBeforeAttach(e)}onAfterShow(e){super.onAfterShow(e),this._checkCacheOnNextResize=!0}onResize(e){var t;if(!this._checkCacheOnNextResize)return super.onResize(e);super.onResize(e),this._checkCacheOnNextResize=!1;const n=this._cellLayoutStateCache,i=parseInt(this.node.style.width,10);if(!n||i!==n.width){this._cellLayoutStateCache={width:i};for(const e of this.widgets)e instanceof o.fh&&e.inViewport&&(null===(t=e.editorWidget)||void 0===t||t.update())}}onBeforeHide(e){super.onBeforeHide(e);const t=parseInt(this.node.style.width,10);this._cellLayoutStateCache={width:t}}onActivateRequest(e){super.onActivateRequest(e),this._ensureFocus(!0)}onUpdateRequest(e){super.onUpdateRequest(e);const t=this.activeCell;"edit"===this.mode?(this.addClass(He),this.removeClass(je)):(this.addClass(je),this.removeClass(He));let n=0;for(const e of this.widgets)e.node.tabIndex=-1,e.removeClass(Fe),e.removeClass(qe),this.isSelectedOrActive(e)?(e.addClass(Be),n++):e.removeClass(Be);t&&(t.addClass(Fe),t.addClass(Be),t.node.tabIndex=0,n>1&&t.addClass(qe))}onCellInserted(e,t){t.ready.then((()=>{t.isDisposed||t.editor.edgeRequested.connect(this._onEdgeRequest,this)})),t.scrollRequested.connect(((e,n)=>{if(t!==this.activeCell)return;if(!n.defaultPrevented)return;const i=this.outerNode;if(t.inViewport)return n.scrollWithinCell({scroller:i});this.scrollToItem(this.activeCellIndex).then((()=>{t.ready.then((()=>{n.scrollWithinCell({scroller:i})}))})).catch((e=>{}))})),this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex+1:this.activeCellIndex}onCellRemoved(e,t){this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex-1:this.activeCellIndex,this.isSelected(t)&&this._selectionChanged.emit(void 0)}onModelChanged(e,t){super.onModelChanged(e,t),this.activeCellIndex=0}_onEdgeRequest(e,t){const n=this.activeCellIndex;if("top"===t){if(this.activeCellIndex--,this.activeCellIndex<n){const e=this.activeCell.editor;if(e){const t=e.lineCount-1;e.setCursorPosition({line:t,column:0})}}}else if("bottom"===t&&(this.activeCellIndex++,this.activeCellIndex>n)){const e=this.activeCell.editor;e&&e.setCursorPosition({line:0,column:0})}this.mode="edit"}_ensureFocus(e=!1){var t,n;const i=this.layout.footer;if(i&&document.activeElement===i.node)return;const s=this.activeCell;"edit"===this.mode&&s&&!0!==(null===(t=s.editor)||void 0===t?void 0:t.hasFocus())&&(s.inViewport?null===(n=s.editor)||void 0===n||n.focus():this.scrollToItem(this.activeCellIndex).then((()=>{s.ready.then((()=>{var e;null===(e=s.editor)||void 0===e||e.focus()}))})).catch((e=>{}))),e&&s&&!s.node.contains(document.activeElement)&&m.focusActiveCell(this,{preventScroll:!0})}_findCell(e){let t=e;for(;t&&t!==this.node;){if(t.classList.contains(Le)){const e=l.ArrayExt.findFirstIndex(this.widgets,(e=>e.node===t));if(-1!==e)return e;break}t=t.parentElement}return-1}_findEventTargetAndCell(e){let t=e.target,n=this._findCell(t);return-1===n&&(t=document.elementFromPoint(e.clientX,e.clientY),n=this._findCell(t)),[t,n]}async _findHeading(e){for(let t=0;t<this.widgets.length;t++){const n=this.widgets[t];if("raw"!==n.model.type&&("markdown"!==n.model.type||n.rendered))for(const t of n.headings){let i="";switch(t.type){case o.fh.HeadingType.HTML:i=t.id;break;case o.fh.HeadingType.Markdown:{const e=t;i=await xe.oQ(this.rendermime.markdownParser,e.raw,e.level,this.rendermime.sanitizer)}}if(i===e)return{cell:n,element:this.node.querySelector(`h${t.level}[id="${CSS.escape(i)}"]`)}}}return null}_findCellById(e){for(let t=0;t<this.widgets.length;t++){const n=this.widgets[t];if(n.model.id===e)return{cell:n}}return null}_evtContextMenuCapture(e){var t;if(e.shiftKey)return;const[n,i]=this._findEventTargetAndCell(e),s=this.widgets[i];s&&(null===(t=s.editorWidget)||void 0===t?void 0:t.node.contains(n))&&e.preventDefault()}_evtMouseDownCapture(e){var t;const{button:n,shiftKey:i}=e,[s,o]=this._findEventTargetAndCell(e),r=this.widgets[o];2===n&&!i&&r&&(null===(t=r.editorWidget)||void 0===t?void 0:t.node.contains(s))&&(this.mode="command",e.preventDefault())}_evtMouseDown(e){var t,n,i;const{button:s,shiftKey:o}=e;if(0!==s&&2!==s)return;if(o&&2===s)return;const[r,a]=this._findEventTargetAndCell(e),l=this.widgets[a];let c;if(c=l?(null===(t=l.editorWidget)||void 0===t?void 0:t.node.contains(r))?"input":(null===(n=l.promptNode)||void 0===n?void 0:n.contains(r))?"prompt":"cell":"notebook","input"!==c&&(this.mode="command"),"notebook"===c)this.deselectAll();else if("prompt"===c||"cell"===c){const t=""!==(null!==(i=window.getSelection())&&void 0!==i?i:"").toString();if(0!==s||!o||t||["INPUT","OPTION"].includes(r.tagName))0!==s||o?2===s&&(this.isSelectedOrActive(l)||(this.deselectAll(),this.activeCellIndex=a),e.preventDefault()):("prompt"===c&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:a},this._mouseMode="couldDrag",document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault()),this.isSelectedOrActive(l)||(this.deselectAll(),this.activeCellIndex=a));else{e.preventDefault();try{this.extendContiguousSelectionTo(a)}catch(e){return console.error(e),void this.deselectAll()}this._mouseMode="select",this._selectData={startedOnActiveCell:a==this.activeCellIndex,startingCellIndex:this.activeCellIndex},document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0)}}else"input"===c&&(2!==s||this.isSelectedOrActive(l)||(this.deselectAll(),this.activeCellIndex=a));this._ensureFocus(!0)}_evtDocumentMouseup(e){const[,t]=this._findEventTargetAndCell(e);let n=!0;if("select"===this._mouseMode&&this._selectData){const{startedOnActiveCell:e,startingCellIndex:i}=this._selectData;e&&t===i&&(n=!1),this._selectData=null}n&&(e.preventDefault(),e.stopPropagation()),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),"couldDrag"===this._mouseMode&&(this.deselectAll(),this.activeCellIndex=t,this.activeCell.node.contains(document.activeElement)||m.focusActiveCell(this)),this._mouseMode=null}_evtDocumentMousemove(e){switch(e.preventDefault(),e.stopPropagation(),this._mouseMode){case"select":{const t=e.target,n=this._findCell(t);-1!==n&&this.extendContiguousSelectionTo(n);break}case"couldDrag":{const t=this._dragData,n=Math.abs(e.clientX-t.pressX),i=Math.abs(e.clientY-t.pressY);(n>=5||i>=5)&&(this._mouseMode=null,this._startDrag(t.index,e.clientX,e.clientY));break}}}_evtDragEnter(e){if(!e.mimeData.hasData(Je))return;e.preventDefault(),e.stopPropagation();const t=e.target,n=this._findCell(t);-1!==n&&this.cellsArray[n].node.classList.add(Ne)}_evtDragLeave(e){if(!e.mimeData.hasData(Je))return;e.preventDefault(),e.stopPropagation();const t=this.node.getElementsByClassName(Ne);t.length&&t[0].classList.remove(Ne)}_evtDragOver(e){if(!e.mimeData.hasData(Je))return;e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction;const t=this.node.getElementsByClassName(Ne);t.length&&t[0].classList.remove(Ne);const n=e.target,i=this._findCell(n);-1!==i&&this.cellsArray[i].node.classList.add(Ne)}_evtDrop(e){if(!e.mimeData.hasData(Je))return;if(e.preventDefault(),e.stopPropagation(),"none"===e.proposedAction)return void(e.dropAction="none");let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(Ne)){t.classList.remove(Ne);break}t=t.parentElement}const n=this.model,i=e.source;if(i===this){e.dropAction="move";const n=e.mimeData.getData("internal:cells"),s=n[n.length-1];if(s instanceof o.KI&&s.headingCollapsed){const e=m.findNextParentHeading(s,i);if(e>0){const t=(0,l.findIndex)(i.widgets,(e=>s.model.id===e.model.id));n.push(...i.widgets.slice(t+1,e))}}let r=l.ArrayExt.firstIndexOf(this.widgets,n[0]),a=this._findCell(t);if(-1!==a&&a>r?a-=1:-1===a&&(a=this.widgets.length-1),a>=r&&a<r+n.length)return;this.moveCell(r,a,n.length)}else{e.dropAction="copy";let i=this._findCell(t);-1===i&&(i=this.widgets.length);const s=i,o=e.mimeData.getData(Je);n.sharedModel.insertCells(i,o),this.deselectAll(),this.activeCellIndex=s,this.extendContiguousSelectionTo(i-1)}m.focusActiveCell(this)}_startDrag(e,t,n){var i;const s=this.model.cells,o=[],r=[];let a=-1;for(const e of this.widgets){const t=s.get(++a);this.isSelectedOrActive(e)&&(e.addClass(De),o.push(t.toJSON()),r.push(e))}const l=this.activeCell;let d,h=null;if("code"===(null==l?void 0:l.model.type)){const e=l.model.executionCount;d=" ",e&&(d=e.toString())}else d="";h=Ye.createDragImage(o.length,d,null!==(i=null==l?void 0:l.model.sharedModel.getSource().split("\n")[0].slice(0,26))&&void 0!==i?i:""),this._drag=new Me.Drag({mimeData:new c.MimeData,dragImage:h,supportedActions:"copy-move",proposedAction:"copy",source:this}),this._drag.mimeData.setData(Je,o),this._drag.mimeData.setData("internal:cells",r);const u=r.map((e=>e.model.sharedModel.getSource())).join("\n");this._drag.mimeData.setData("text/plain",u),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),this._mouseMode=null,this._drag.start(t,n).then((e=>{if(!this.isDisposed){this._drag=null;for(const e of r)e.removeClass(De)}}))}_updateReadWrite(){const e=i.DOMUtils.hasActiveEditableElement(this.node);this.node.classList.toggle("jp-mod-readWrite",e)}_evtFocusIn(e){var t,n;this._updateReadWrite();const i=e.target,s=this._findCell(i);if(-1!==s){const e=this.widgets[s];e.editorWidget&&!e.editorWidget.node.contains(i)&&this.setMode("command",{focus:!1}),this.activeCellIndex=s;const n=null===(t=e.editorWidget)||void 0===t?void 0:t.node;(null==n?void 0:n.contains(i))&&this.setMode("edit",{focus:!1})}else{this.setMode("command",{focus:!1}),e.preventDefault();const t=e.relatedTarget;this._activeCell&&!this._activeCell.node.contains(t)?this._activeCell.ready.then((()=>{var e;null===(e=this._activeCell)||void 0===e||e.node.focus({preventScroll:!0})})).catch((()=>{var e;null===(e=this.layout.footer)||void 0===e||e.node.focus({preventScroll:!0})})):null===(n=this.layout.footer)||void 0===n||n.node.focus({preventScroll:!0})}}_evtFocusOut(e){var t;this._updateReadWrite();const n=e.relatedTarget;if(!n)return;const i=this._findCell(n);-1!==i&&(null===(t=this.widgets[i].editorWidget)||void 0===t?void 0:t.node.contains(n))||"command"!==this.mode&&this.setMode("command",{focus:!1})}_evtDblClick(e){const t=this.model;if(!t)return;this.deselectAll();const[n,i]=this._findEventTargetAndCell(e);e.target.classList.contains("jp-collapseHeadingButton")||-1===i||(this.activeCellIndex=i,"markdown"===t.cells.get(i).type?this.widgets[i].rendered=!1:"img"===n.localName&&n.classList.toggle("jp-mod-unconfined"))}_trimSelections(){for(let e=0;e<this.widgets.length;e++)if(e!==this._activeCellIndex){const t=this.widgets[e];!t.model.isDisposed&&t.editor&&t.model.selections.delete(t.editor.uuid)}}_updateSelectedCells(){this._selectedCells=this.widgets.filter((e=>this.isSelectedOrActive(e))),this.kernelHistory&&this.kernelHistory.reset()}}var Ye;!function(e){class t extends Ge.ContentFactory{}e.ContentFactory=t}(Qe||(Qe={})),function(e){e.selectedProperty=new Ie.AttachedProperty({name:"selected",create:()=>!1});class t extends fe.PanelLayout{onUpdateRequest(e){}}e.NotebookPanelLayout=t,e.createDragImage=function(e,t,n){return e>1?""!==t?Te.VirtualDOM.realize(Te.h.div(Te.h.div({className:We},Te.h.span({className:ze},"["+t+"]:"),Te.h.span({className:Ue},n)),Te.h.div({className:$e},""))):Te.VirtualDOM.realize(Te.h.div(Te.h.div({className:We},Te.h.span({className:ze}),Te.h.span({className:Ue},n)),Te.h.div({className:$e},""))):""!==t?Te.VirtualDOM.realize(Te.h.div(Te.h.div({className:`${We} ${Ve}`},Te.h.span({className:ze},"["+t+"]:"),Te.h.span({className:Ue},n)))):Te.VirtualDOM.realize(Te.h.div(Te.h.div({className:`${We} ${Ve}`},Te.h.span({className:ze}),Te.h.span({className:Ue},n))))}}(Ye||(Ye={}));class Xe extends ke.DocumentWidget{constructor(e){super(e),this._autorestarting=!1,this.addClass("jp-NotebookPanel"),this.toolbar.addClass("jp-NotebookPanel-toolbar"),this.content.addClass("jp-NotebookPanel-notebook"),this.content.model=this.context.model,this.context.sessionContext.kernelChanged.connect(this._onKernelChanged,this),this.context.sessionContext.statusChanged.connect(this._onSessionStatusChanged,this),this.context.saveState.connect(this._onSave,this),this.revealed.then((()=>{if(!this.isDisposed&&1===this.content.widgets.length){const e=this.content.widgets[0].model;"code"===e.type&&""===e.sharedModel.getSource()&&(this.content.mode="edit")}}))}_onSave(e,t){if("started"===t&&this.model)for(const e of this.model.cells)if((0,s.xW)(e))for(const t of e.attachments.keys)e.sharedModel.getSource().includes(t)||e.attachments.remove(t)}get sessionContext(){return this.context.sessionContext}get model(){return this.content.model}setConfig(e){this.content.editorConfig=e.editorConfig,this.content.notebookConfig=e.notebookConfig;const t=this.context.sessionContext.kernelPreference;this.context.sessionContext.kernelPreference={...t,shutdownOnDispose:e.kernelShutdown,autoStartDefault:e.autoStartDefault}}setFragment(e){this.context.ready.then((()=>{this.content.setFragment(e)}))}dispose(){this.content.dispose(),super.dispose()}[i.Printing.symbol](){return async()=>{this.context.model.dirty&&!this.context.model.readOnly&&await this.context.save(),await i.Printing.printURL(r.PageConfig.getNBConvertURL({format:"html",download:!1,path:this.context.path}))}}onBeforeHide(e){super.onBeforeHide(e),this.content.isParentHidden=!0}onBeforeShow(e){this.content.isParentHidden=!1,super.onBeforeShow(e)}_onKernelChanged(e,t){if(!this.model||!t.newValue)return;const{newValue:n}=t;n.info.then((e=>{var t;this.model&&(null===(t=this.context.sessionContext.session)||void 0===t?void 0:t.kernel)===n&&this._updateLanguage(e.language_info)})),this._updateSpec(n)}_onSessionStatusChanged(e,t){var n;"autorestarting"!==t||this._autorestarting?"restarting"===t||(this._autorestarting=!1):((0,i.showDialog)({title:this._trans.__("Kernel Restarting"),body:this._trans.__("The kernel for %1 appears to have died. It will restart automatically.",null===(n=this.sessionContext.session)||void 0===n?void 0:n.path),buttons:[i.Dialog.okButton({label:this._trans.__("Ok")})]}),this._autorestarting=!0)}_updateLanguage(e){this.model.setMetadata("language_info",e)}async _updateSpec(e){const t=await e.spec;this.isDisposed||this.model.setMetadata("kernelspec",{name:e.name,display_name:null==t?void 0:t.display_name,language:null==t?void 0:t.language})}}!function(e){class t extends Qe.ContentFactory{createNotebook(e){return new Qe(e)}}e.ContentFactory=t,e.IContentFactory=new c.Token("@jupyterlab/notebook:IContentFactory","A factory object that creates new notebooks.\n    Use this if you want to create and host notebooks in your own UI elements.")}(Xe||(Xe={}));var Ze=n(95587),et=n(81615);class tt extends Ze.EditorSearchProvider{constructor(e){super(),this.cell=e,this.cell.inViewport||this.cell.editor||(0,r.signalToPromise)(e.inViewportChanged).then((([,e])=>{e&&this.cmHandler.setEditor(this.editor)}))}get editor(){return this.cell.editor}get model(){return this.cell.model}}class nt extends tt{constructor(e){super(e),this.currentProviderIndex=-1,this.outputsProvider=[];const t=this.cell.outputArea;this._onOutputsChanged(t,t.widgets.length).catch((e=>{console.error("Failed to initialize search on cell outputs.",e)})),t.outputLengthChanged.connect(this._onOutputsChanged,this),t.disposed.connect((()=>{t.outputLengthChanged.disconnect(this._onOutputsChanged)}),this)}get matchesCount(){return this.isActive?super.matchesCount+this.outputsProvider.reduce(((e,t)=>{var n;return e+(null!==(n=t.matchesCount)&&void 0!==n?n:0)}),0):0}async clearHighlight(){await super.clearHighlight(),await Promise.all(this.outputsProvider.map((e=>e.clearHighlight())))}dispose(){this.isDisposed||(super.dispose(),this.outputsProvider.map((e=>{e.dispose()})),this.outputsProvider.length=0)}async highlightNext(e,t){var n;const i=null!==(n=null==t?void 0:t.from)&&void 0!==n?n:"";if(!(0===this.matchesCount||"previous-match"===i&&null!==this.currentIndex&&this.currentIndex+1>=this.cmHandler.matches.length)&&this.isActive){if(-1===this.currentProviderIndex){const n=await super.highlightNext(e,t);if(n)return this.currentIndex=this.cmHandler.currentIndex,n;this.currentProviderIndex=0}for(;this.currentProviderIndex<this.outputsProvider.length;){const e=this.outputsProvider[this.currentProviderIndex],t=await e.highlightNext(!1);if(t)return this.currentIndex=super.matchesCount+this.outputsProvider.slice(0,this.currentProviderIndex).reduce(((e,t)=>{var n;return e+(null!==(n=t.matchesCount)&&void 0!==n?n:0)}),0)+e.currentMatchIndex,t;this.currentProviderIndex+=1}return this.currentProviderIndex=-1,void(this.currentIndex=null)}this.currentIndex=null}async highlightPrevious(){if(0!==this.matchesCount&&this.isActive){for(null===this.currentIndex&&(this.currentProviderIndex=this.outputsProvider.length-1);this.currentProviderIndex>=0;){const e=this.outputsProvider[this.currentProviderIndex],t=await e.highlightPrevious(!1);if(t)return this.currentIndex=super.matchesCount+this.outputsProvider.slice(0,this.currentProviderIndex).reduce(((e,t)=>{var n;return e+(null!==(n=t.matchesCount)&&void 0!==n?n:0)}),0)+e.currentMatchIndex,t;this.currentProviderIndex-=1}const e=await super.highlightPrevious();return e?(this.currentIndex=this.cmHandler.currentIndex,e):void(this.currentIndex=null)}this.currentIndex=null}async startQuery(e,t){await super.startQuery(e,t),!1!==(null==t?void 0:t.output)&&this.isActive&&await Promise.all(this.outputsProvider.map((t=>t.startQuery(e))))}async endQuery(){var e;await super.endQuery(),!1!==(null===(e=this.filters)||void 0===e?void 0:e.output)&&this.isActive&&await Promise.all(this.outputsProvider.map((e=>e.endQuery())))}async replaceAllMatches(e){return!1===this.model.getMetadata("editable")?Promise.resolve(!1):await super.replaceAllMatches(e)}async replaceCurrentMatch(e,t,n){return!1===this.model.getMetadata("editable")?Promise.resolve(!1):await super.replaceCurrentMatch(e,t,n)}async _onOutputsChanged(e,t){var n;this.outputsProvider.forEach((e=>{e.dispose()})),this.outputsProvider.length=0,this.currentProviderIndex=-1,this.outputsProvider=this.cell.outputArea.widgets.map((e=>new et.VT(e))),this.isActive&&this.query&&!1!==(null===(n=this.filters)||void 0===n?void 0:n.output)&&await Promise.all([this.outputsProvider.map((e=>{e.startQuery(this.query)}))]),this._stateChanged.emit()}}class it extends tt{constructor(e){super(e),this._unrenderedByHighlight=!1,this.renderedProvider=new et.VT(e.renderer)}async clearHighlight(){await super.clearHighlight(),await this.renderedProvider.clearHighlight()}dispose(){this.isDisposed||(super.dispose(),this.renderedProvider.dispose())}async endQuery(){await super.endQuery(),await this.renderedProvider.endQuery()}async highlightNext(e=!0,t){let n;if(!this.isActive)return n;const i=this.cell;if(i.rendered&&this.matchesCount>0){this._unrenderedByHighlight=!0;const e=(0,r.signalToPromise)(i.renderedChanged);i.rendered=!1,await e}return n=await super.highlightNext(e,t),n}async highlightPrevious(){let e;const t=this.cell;if(t.rendered&&this.matchesCount>0){this._unrenderedByHighlight=!0;const e=(0,r.signalToPromise)(t.renderedChanged);t.rendered=!1,await e}return e=await super.highlightPrevious(),e}async startQuery(e,t){await super.startQuery(e,t);const n=this.cell;n.rendered&&this.onRenderedChanged(n,n.rendered),n.renderedChanged.connect(this.onRenderedChanged,this)}async replaceAllMatches(e){if(!1===this.model.getMetadata("editable"))return Promise.resolve(!1);const t=await super.replaceAllMatches(e);return this.cell.rendered&&this.cell.update(),t}async replaceCurrentMatch(e,t,n){return!1===this.model.getMetadata("editable")?Promise.resolve(!1):await super.replaceCurrentMatch(e,t,n)}onRenderedChanged(e,t){var n;this._unrenderedByHighlight||(this.currentIndex=null),this._unrenderedByHighlight=!1,this.isActive&&(t?this.renderedProvider.startQuery(this.query):(null===(n=e.editor)||void 0===n||n.setCursorPosition({column:0,line:0}),this.renderedProvider.endQuery()))}}function st(e){if(e.isPlaceholder())return new tt(e);switch(e.model.type){case"code":return new nt(e);case"markdown":return new it(e);default:return new tt(e)}}var ot=n(7865);class rt extends ot.Y{constructor(e,t=a.nullTranslator){super(e),this.translator=t,this._textSelection=null,this._currentProviderIndex=null,this._delayedActiveCellChangeHandler=null,this._onSelection=!1,this._selectedCells=1,this._selectedLines=0,this._query=null,this._searchProviders=[],this._editorSelectionsObservable=null,this._selectionSearchMode="cells",this._selectionLock=!1,this._searchActive=!1,this._handleHighlightsAfterActiveCellChange=this._handleHighlightsAfterActiveCellChange.bind(this),this.widget.model.cells.changed.connect(this._onCellsChanged,this),this.widget.content.activeCellChanged.connect(this._onActiveCellChanged,this),this.widget.content.selectionChanged.connect(this._onCellSelectionChanged,this),this.widget.content.stateChanged.connect(this._onNotebookStateChanged,this),this._observeActiveCell(),this._filtersChanged.connect(this._setEnginesSelectionSearchMode,this)}_onNotebookStateChanged(e,t){"mode"===t.name&&window.setTimeout((()=>{var e;"command"===t.newValue&&(null===(e=document.activeElement)||void 0===e?void 0:e.closest(".jp-DocumentSearch-overlay"))||(this._updateSelectionMode(),this._filtersChanged.emit())}),0)}static isApplicable(e){return e instanceof Xe}static createNew(e,t){return new rt(e,t)}get currentMatchIndex(){let e=0,t=!1;for(let n=0;n<this._searchProviders.length;n++){const i=this._searchProviders[n];if(this._currentProviderIndex==n){const n=i.currentMatchIndex;if(null===n)return null;e+=n,t=!0;break}e+=i.matchesCount}return t?e:null}get matchesCount(){return this._searchProviders.reduce(((e,t)=>e+t.matchesCount),0)}get isReadOnly(){var e,t,n;return null!==(n=null===(t=null===(e=this.widget)||void 0===e?void 0:e.content.model)||void 0===t?void 0:t.readOnly)&&void 0!==n&&n}get replaceOptionsSupport(){return{preserveCase:!0}}getSelectionState(){const e="cells"===this._selectionSearchMode,t=e?this._selectedCells:this._selectedLines;return t>1?"multiple":1!==t||e?"none":"single"}dispose(){var e;if(this.isDisposed)return;this.widget.content.activeCellChanged.disconnect(this._onActiveCellChanged,this),null===(e=this.widget.model)||void 0===e||e.cells.changed.disconnect(this._onCellsChanged,this),this.widget.content.stateChanged.disconnect(this._onNotebookStateChanged,this),this.widget.content.selectionChanged.disconnect(this._onCellSelectionChanged,this),this._stopObservingLastCell(),super.dispose();const t=this.widget.content.activeCellIndex;this.endQuery().then((()=>{this.widget.isDisposed||(this.widget.content.activeCellIndex=t)})).catch((e=>{console.error(`Fail to end search query in notebook:\n${e}`)}))}getFilters(){const e=this.translator.load("jupyterlab");return{output:{title:e.__("Search Cell Outputs"),description:e.__("Search in the cell outputs."),disabledDescription:e.__("Search in the cell outputs (not available when replace options are shown)."),default:!1,supportReplace:!1},selection:{title:"cells"===this._selectionSearchMode?e._n("Search in %1 Selected Cell","Search in %1 Selected Cells",this._selectedCells):e._n("Search in %1 Selected Line","Search in %1 Selected Lines",this._selectedLines),description:e.__("Search only in the selected cells or text (depending on edit/command mode)."),default:!1,supportReplace:!0}}}_updateSelectionMode(){this._selectionLock||(this._selectionSearchMode=1===this._selectedCells&&"edit"===this.widget.content.mode&&0!==this._selectedLines?"text":"cells")}getInitialQuery(){var e;return(null===(e=window.getSelection())||void 0===e?void 0:e.toString())||""}async clearHighlight(){this._selectionLock=!0,null!==this._currentProviderIndex&&this._currentProviderIndex<this._searchProviders.length&&(await this._searchProviders[this._currentProviderIndex].clearHighlight(),this._currentProviderIndex=null),this._selectionLock=!1}async highlightNext(e=!0,t){const n=await this._stepNext(!1,e,t);return null!=n?n:void 0}async highlightPrevious(e=!0,t){const n=await this._stepNext(!0,e,t);return null!=n?n:void 0}async startQuery(e,t){if(!this.widget)return;await this.endQuery(),this._searchActive=!0;let n=this.widget.content.widgets;this._query=e,this._filters={output:!1,selection:!1,...null!=t?t:{}},this._onSelection=this._filters.selection;const i=this.widget.content.activeCellIndex;return this._searchProviders=await Promise.all(n.map((async(t,n)=>{const s=st(t);return await s.setIsActive(!this._filters.selection||this.widget.content.isSelectedOrActive(t)),this._onSelection&&"text"===this._selectionSearchMode&&n===i&&this._textSelection&&await s.setSearchSelection(this._textSelection),await s.startQuery(e,this._filters),s}))),this._currentProviderIndex=i,await this.highlightNext(!0,{from:"selection-start",scroll:!1,select:!1}),Promise.resolve()}async endQuery(){await Promise.all(this._searchProviders.map((e=>e.endQuery().then((()=>{e.dispose()}))))),this._searchActive=!1,this._searchProviders.length=0,this._currentProviderIndex=null}async replaceCurrentMatch(e,t=!0,n){let i=!1;const s=async(e=!1)=>{var n;const i=null===(n=this.widget)||void 0===n?void 0:n.content.activeCell;"markdown"===(null==i?void 0:i.model.type)&&i.rendered&&(i.rendered=!1,e&&await this.highlightNext(t))};if(null!==this._currentProviderIndex){await s();const o=this._searchProviders[this._currentProviderIndex];i=await o.replaceCurrentMatch(e,!1,n),null===o.currentMatchIndex&&await this.highlightNext(t,{from:"previous-match"})}return await s(!0),i}async replaceAllMatches(e,t){return(await Promise.all(this._searchProviders.map((n=>n.replaceAllMatches(e,t))))).includes(!0)}async validateFilter(e,t){if("output"!==e)return t;if(t&&this.widget.content.widgets.some((e=>e instanceof o.Yr&&e.isPlaceholder()))){const e=this.translator.load("jupyterlab");if(!(await(0,i.showDialog)({title:e.__("Confirmation"),body:e.__("Searching outputs requires you to run all cells and render their outputs. Are you sure you want to search in the cell outputs?"),buttons:[i.Dialog.cancelButton({label:e.__("Cancel")}),i.Dialog.okButton({label:e.__("Ok")})]})).button.accept)return!1;this.widget.content.widgets.forEach(((e,t)=>{e instanceof o.Yr&&e.isPlaceholder()&&this.widget.content.renderCellOutputs(t)}))}return t}_addCellProvider(e){var t,n;const i=this.widget.content.widgets[e],s=st(i);l.ArrayExt.insert(this._searchProviders,e,s),s.setIsActive(!(null!==(n=null===(t=this._filters)||void 0===t?void 0:t.selection)&&void 0!==n&&n)||this.widget.content.isSelectedOrActive(i)).then((()=>{this._searchActive&&s.startQuery(this._query,this._filters)}))}_removeCellProvider(e){const t=l.ArrayExt.removeAt(this._searchProviders,e);null==t||t.dispose()}async _onCellsChanged(e,t){switch(t.type){case"add":t.newValues.forEach(((e,n)=>{this._addCellProvider(t.newIndex+n)}));break;case"move":l.ArrayExt.move(this._searchProviders,t.oldIndex,t.newIndex);break;case"remove":for(let e=0;e<t.oldValues.length;e++)this._removeCellProvider(t.oldIndex);break;case"set":t.newValues.forEach(((e,n)=>{this._addCellProvider(t.newIndex+n),this._removeCellProvider(t.newIndex+n+1)}))}this._stateChanged.emit()}async _stepNext(e=!1,t=!1,n){var i;const s=async e=>{var t;if(null!==(t=null==n?void 0:n.scroll)&&void 0!==t&&!t)return;if(this._selectionLock=!0,this.widget.content.activeCellIndex!==this._currentProviderIndex&&(this.widget.content.activeCellIndex=this._currentProviderIndex),-1===this.widget.content.activeCellIndex)return console.warn("No active cell (no cells or no model), aborting search"),void(this._selectionLock=!1);const i=this.widget.content.activeCell;if(!i.inViewport)try{await this.widget.content.scrollToItem(this._currentProviderIndex)}catch(e){}if(i.inputHidden&&(i.inputHidden=!1),!i.inViewport)return void(this._selectionLock=!1);await i.ready;const s=i.editor;s.revealPosition(s.getPositionAt(e.position)),this._selectionLock=!1};null===this._currentProviderIndex&&(this._currentProviderIndex=this.widget.content.activeCellIndex),e&&"command"===this.widget.content.mode&&(this._searchProviders[this._currentProviderIndex].getCurrentMatch()||(this._currentProviderIndex-=1),t&&(this._currentProviderIndex=(this._currentProviderIndex+this._searchProviders.length)%this._searchProviders.length));const o="previous-match"===(null!==(i=null==n?void 0:n.from)&&void 0!==i?i:"")&&null===this._searchProviders[this._currentProviderIndex].currentMatchIndex,r=this._currentProviderIndex;o&&this._searchProviders[this._currentProviderIndex].clearHighlight(),t&&o&&this._currentProviderIndex+1>=this._searchProviders.length?this._currentProviderIndex=0:this._currentProviderIndex+=o?1:0;do{const i=this._searchProviders[this._currentProviderIndex],o=e?await i.highlightPrevious(!1,n):await i.highlightNext(!1,n);if(o)return await s(o),o;this._currentProviderIndex=this._currentProviderIndex+(e?-1:1),t&&(this._currentProviderIndex=(this._currentProviderIndex+this._searchProviders.length)%this._searchProviders.length)}while(t?this._currentProviderIndex!==r:0<=this._currentProviderIndex&&this._currentProviderIndex<this._searchProviders.length);if(t){const t=this._searchProviders[r],i=e?await t.highlightPrevious(!1,n):await t.highlightNext(!1,n);if(i)return await s(i),i}return this._currentProviderIndex=null,null}async _onActiveCellChanged(){null!==this._delayedActiveCellChangeHandler&&(clearTimeout(this._delayedActiveCellChangeHandler),this._delayedActiveCellChangeHandler=null),this.widget.content.activeCellIndex!==this._currentProviderIndex&&(this._delayedActiveCellChangeHandler=window.setTimeout((()=>{this.delayedActiveCellChangeHandlerReady=this._handleHighlightsAfterActiveCellChange()}),0)),this._observeActiveCell()}async _handleHighlightsAfterActiveCellChange(){if(this._onSelection){const e=null!==this._currentProviderIndex&&this._currentProviderIndex<this.widget.content.widgets.length?this.widget.content.widgets[this._currentProviderIndex]:null;e&&this.widget.content.isSelectedOrActive(e)||(await this._updateCellSelection(),await this.clearHighlight(),this._currentProviderIndex=this.widget.content.activeCellIndex)}await this._ensureCurrentMatch()}async _ensureCurrentMatch(){if(null!==this._currentProviderIndex){const e=this._searchProviders[this._currentProviderIndex];if(!e)return;!e.getCurrentMatch()&&this.matchesCount&&await this.highlightNext(!0,{from:"start",scroll:!1,select:!1})}}_observeActiveCell(){var e;const t=null===(e=this.widget.content.activeCell)||void 0===e?void 0:e.editor;t&&(this._stopObservingLastCell(),t.model.selections.changed.connect(this._setSelectedLines,this),this._editorSelectionsObservable=t.model.selections)}_stopObservingLastCell(){this._editorSelectionsObservable&&this._editorSelectionsObservable.changed.disconnect(this._setSelectedLines,this)}_setSelectedLines(){var e;const t=null===(e=this.widget.content.activeCell)||void 0===e?void 0:e.editor;if(!t)return;const n=t.getSelection(),{start:i,end:s}=n,o=s.line===i.line&&s.column===i.column?0:s.line-i.line+1;this._textSelection=n,o!==this._selectedLines&&(this._selectedLines=o,this._updateSelectionMode()),this._filtersChanged.emit()}async _setEnginesSelectionSearchMode(){let e;e=!!this._onSelection&&"text"===this._selectionSearchMode,this._selectionLock||await Promise.all(this._searchProviders.map(((t,n)=>{const i=this.widget.content.activeCellIndex===n;return t.setProtectSelection(i&&this._onSelection),t.setSearchSelection(i&&e?this._textSelection:null)})))}async _onCellSelectionChanged(){if(null!==this._delayedActiveCellChangeHandler&&(clearTimeout(this._delayedActiveCellChangeHandler),this._delayedActiveCellChangeHandler=null),await this._updateCellSelection(),null===this._currentProviderIndex){const e=this.widget.content.widgets.findIndex((e=>this.widget.content.isSelectedOrActive(e)));this._currentProviderIndex=e}await this._ensureCurrentMatch()}async _updateCellSelection(){const e=this.widget.content.widgets;let t=0;await Promise.all(e.map((async(e,n)=>{const i=this._searchProviders[n],s=this.widget.content.isSelectedOrActive(e);s&&(t+=1),i&&this._onSelection&&await i.setIsActive(s)}))),t!==this._selectedCells&&(this._selectedCells=t,this._updateSelectionMode()),this._filtersChanged.emit()}}var at=n(36549);class lt extends w.VDomModel{constructor(e,t){super(),this.widget=e,this._activeHeading=null,this._activeHeadingChanged=new d.Signal(this),this._collapseChanged=new d.Signal(this),this._configuration=null!=t?t:{...at.MB.defaultConfig},this._headings=new Array,this._headingsChanged=new d.Signal(this),this._isActive=!1,this._isRefreshing=!1,this._needsRefreshing=!1}get activeHeading(){return this._activeHeading}get activeHeadingChanged(){return this._activeHeadingChanged}get collapseChanged(){return this._collapseChanged}get configuration(){return this._configuration}get headings(){return this._headings}get headingsChanged(){return this._headingsChanged}get isActive(){return this._isActive}set isActive(e){this._isActive=e,this._isActive&&!this.isAlwaysActive&&this.refresh().catch((e=>{console.error("Failed to refresh ToC model.",e)}))}get isAlwaysActive(){return!1}get supportedOptions(){return["maximalDepth"]}get title(){return this._title}set title(e){e!==this._title&&(this._title=e,this.stateChanged.emit())}async refresh(){if(this._isRefreshing)return this._needsRefreshing=!0,Promise.resolve();this._isRefreshing=!0;try{const e=await this.getHeadings();if(this._needsRefreshing)return this._needsRefreshing=!1,this._isRefreshing=!1,this.refresh();e&&!this._areHeadingsEqual(e,this._headings)&&(this._headings=e,this.stateChanged.emit(),this._headingsChanged.emit())}finally{this._isRefreshing=!1}}setActiveHeading(e,t=!0){this._activeHeading!==e&&(this._activeHeading=e,this.stateChanged.emit()),t&&this._activeHeadingChanged.emit(this._activeHeading)}setConfiguration(e){const t={...this._configuration,...e};c.JSONExt.deepEqual(this._configuration,t)||(this._configuration=t,this.refresh().catch((e=>{console.error("Failed to update the table of contents.",e)})))}toggleCollapse(e){var t,n;if(e.heading)e.heading.collapsed=null!==(t=e.collapsed)&&void 0!==t?t:!e.heading.collapsed,this.stateChanged.emit(),this._collapseChanged.emit(e.heading);else{const t=null!==(n=e.collapsed)&&void 0!==n?n:!this.headings.some((e=>{var t;return!(null!==(t=e.collapsed)&&void 0!==t&&t)}));this.headings.forEach((e=>e.collapsed=t)),this.stateChanged.emit(),this._collapseChanged.emit(null)}}isHeadingEqual(e,t){return e.level===t.level&&e.text===t.text&&e.prefix===t.prefix}_areHeadingsEqual(e,t){if(e.length===t.length){for(let n=0;n<e.length;n++)if(!this.isHeadingEqual(e[n],t[n]))return!1;return!0}return!1}}var ct,dt=n(15836);class ht{constructor(e){this.tracker=e}isApplicable(e){return!!this.tracker.has(e)}createNew(e,t){const n=this._createNew(e,t),i=e.context,s=()=>{n.refresh().catch((e=>{console.error("Failed to update the table of contents.",e)}))},o=new r.ActivityMonitor({signal:i.model.contentChanged,timeout:1e3});o.activityStopped.connect(s);const a=()=>{n.title=r.PathExt.basename(i.localPath)};return i.pathChanged.connect(a),i.ready.then((()=>{a(),s()})).catch((e=>{console.error(`Failed to initiate headings for ${i.localPath}.`)})),e.disposed.connect((()=>{o.activityStopped.disconnect(s),i.pathChanged.disconnect(a)})),n}}!function(e){e[e.Idle=-1]="Idle",e[e.Error=-.5]="Error",e[e.Scheduled=0]="Scheduled",e[e.Running=1]="Running"}(ct||(ct={}));class ut extends lt{constructor(e,t,n,i){super(e,i),this.parser=t,this.sanitizer=n,this.configMetadataMap={numberHeaders:["toc-autonumbering","toc/number_sections"],numberingH1:["!toc/skip_h1_title"],baseNumbering:["toc/base_numbering"]},this._runningCells=new Array,this._errorCells=new Array,this._cellToHeadingIndex=new WeakMap,e.context.ready.then((()=>{this.setConfiguration({})})),this.widget.context.model.metadataChanged.connect(this.onMetadataChanged,this),this.widget.content.activeCellChanged.connect(this.onActiveCellChanged,this),m.executionScheduled.connect(this.onExecutionScheduled,this),m.executed.connect(this.onExecuted,this),m.outputCleared.connect(this.onOutputCleared,this),this.headingsChanged.connect(this.onHeadingsChanged,this)}get documentType(){return"notebook"}get isAlwaysActive(){return!0}get supportedOptions(){return["baseNumbering","maximalDepth","numberingH1","numberHeaders","includeOutput","syncCollapseState"]}getCellHeadings(e){const t=new Array;let n=this._cellToHeadingIndex.get(e);if(void 0!==n){const e=this.headings[n];for(t.push(e);this.headings[n-1]&&this.headings[n-1].cellRef===e.cellRef;)n--,t.unshift(this.headings[n])}return t}dispose(){var e,t,n;this.isDisposed||(this.headingsChanged.disconnect(this.onHeadingsChanged,this),null===(t=null===(e=this.widget.context)||void 0===e?void 0:e.model)||void 0===t||t.metadataChanged.disconnect(this.onMetadataChanged,this),null===(n=this.widget.content)||void 0===n||n.activeCellChanged.disconnect(this.onActiveCellChanged,this),m.executionScheduled.disconnect(this.onExecutionScheduled,this),m.executed.disconnect(this.onExecuted,this),m.outputCleared.disconnect(this.onOutputCleared,this),this._runningCells.length=0,this._errorCells.length=0,super.dispose())}setConfiguration(e){const t=this.loadConfigurationFromMetadata();super.setConfiguration({...this.configuration,...t,...e})}toggleCollapse(e){super.toggleCollapse(e),this.updateRunningStatus(this.headings)}getHeadings(){const e=this.widget.content.widgets,t=[],n=new Array;for(let i=0;i<e.length;i++){const s=e[i];switch(s.model.type){case"code":!this.configuration.syncCollapseState&&this.configuration.includeOutput&&t.push(...dt.uQ(s.headings,this.configuration,n).map((e=>({...e,cellRef:s,collapsed:!1,isRunning:ct.Idle}))));break;case"markdown":{const e=dt.uQ(s.headings,this.configuration,n).map(((e,t)=>({...e,cellRef:s,collapsed:!1,isRunning:ct.Idle})));if(this.configuration.syncCollapseState&&s.headingCollapsed){const t=Math.min(...e.map((e=>e.level)));e.find((e=>e.level===t)).collapsed=s.headingCollapsed}t.push(...e);break}}t.length>0&&this._cellToHeadingIndex.set(s,t.length-1)}return this.updateRunningStatus(t),Promise.resolve(t)}isHeadingEqual(e,t){return super.isHeadingEqual(e,t)&&e.cellRef===t.cellRef}loadConfigurationFromMetadata(){const e=this.widget.content.model,t={};if(e)for(const n in this.configMetadataMap){const i=this.configMetadataMap[n];for(const s of i){let i=s;const o="!"===i[0];o&&(i=i.slice(1));const r=i.split("/");let a=e.getMetadata(r[0]);for(let e=1;e<r.length;e++)a=(null!=a?a:{})[r[e]];void 0!==a&&("boolean"==typeof a&&o&&(a=!a),t[n]=a)}}return t}onActiveCellChanged(e,t){const n=this.getCellHeadings(t)[0];this.setActiveHeading(null!=n?n:null,!1)}onHeadingsChanged(){this.widget.content.activeCell&&this.onActiveCellChanged(this.widget.content,this.widget.content.activeCell)}onExecuted(e,t){this._runningCells.forEach(((e,n)=>{var i;if(e===t.cell){this._runningCells.splice(n,1);const s=this._cellToHeadingIndex.get(e);if(void 0!==s){const n=this.headings[s];if(t.success||void 0===(null===(i=t.error)||void 0===i?void 0:i.errorName))return void(n.isRunning=ct.Idle);n.isRunning=ct.Error,this._errorCells.includes(e)||this._errorCells.push(e)}}})),this.updateRunningStatus(this.headings),this.stateChanged.emit()}onExecutionScheduled(e,t){this._runningCells.includes(t.cell)||this._runningCells.push(t.cell),this._errorCells.forEach(((e,n)=>{e===t.cell&&this._errorCells.splice(n,1)})),this.updateRunningStatus(this.headings),this.stateChanged.emit()}onOutputCleared(e,t){this._errorCells.forEach(((e,n)=>{if(e===t.cell){this._errorCells.splice(n,1);const t=this._cellToHeadingIndex.get(e);void 0!==t&&(this.headings[t].isRunning=ct.Idle)}})),this.updateRunningStatus(this.headings),this.stateChanged.emit()}onMetadataChanged(){this.setConfiguration({})}updateRunningStatus(e){this._runningCells.forEach(((e,t)=>{const n=this._cellToHeadingIndex.get(e);if(void 0!==n){const e=this.headings[n];e.isRunning!==ct.Running&&(e.isRunning=t>0?ct.Scheduled:ct.Running)}})),this._errorCells.forEach(((e,t)=>{const n=this._cellToHeadingIndex.get(e);if(void 0!==n){const e=this.headings[n];e.isRunning===ct.Idle&&(e.isRunning=ct.Error)}}));let t=0;for(;t<e.length;){const i=e[t];if(t++,i.collapsed){const t=Math.max(i.isRunning,n(e,i.level));i.dataset={...i.dataset,"data-running":t.toString()}}else i.dataset={...i.dataset,"data-running":i.isRunning.toString()}}function n(e,i){let s=ct.Idle;for(;t<e.length;){const o=e[t];if(o.dataset={...o.dataset,"data-running":o.isRunning.toString()},!(o.level>i))break;t++,s=Math.max(o.isRunning,s),o.collapsed&&(s=Math.max(s,n(e,o.level)),o.dataset={...o.dataset,"data-running":s.toString()})}return s}}}class gt extends ht{constructor(e,t,n){super(e),this.parser=t,this.sanitizer=n,this._scrollToTop=!0}get scrollToTop(){return this._scrollToTop}set scrollToTop(e){this._scrollToTop=e}_createNew(e,t){const n=new ut(e,this.parser,this.sanitizer,t);let i=new WeakMap;const s=(t,n)=>{if(n){const t=async t=>{if(!t.inViewport)return;const s=i.get(n);if(s)if(this.scrollToTop)s.scrollIntoView({block:"start"});else{const t=e.content.node.getBoundingClientRect(),n=s.getBoundingClientRect();(n.top>t.bottom||n.bottom<t.top)&&s.scrollIntoView({block:"center"})}else console.debug("scrolling to heading: using fallback strategy"),await e.content.scrollToItem(e.content.activeCellIndex,this.scrollToTop?"start":void 0,0)},s=n.cellRef,o=e.content.widgets.indexOf(s);"markdown"==s.model.type&&"command"!=e.content.mode&&(e.content.mode="command"),e.content.activeCellIndex=o,s.inViewport?t(s).catch((e=>{console.error(`Fail to scroll to cell to display the required heading (${e}).`)})):e.content.scrollToItem(o,this.scrollToTop?"start":void 0).then((()=>t(s))).catch((e=>{console.error(`Fail to scroll to cell to display the required heading (${e}).`)}))}},r=e=>{n.getCellHeadings(e).forEach((async e=>{var t,n;const s=await pt(e,this.parser,this.sanitizer),o=s?`h${e.level}[id="${CSS.escape(s)}"]`:`h${e.level}`;void 0!==e.outputIndex?i.set(e,dt.Mh(e.cellRef.outputArea.widgets[e.outputIndex].node,o,null!==(t=e.prefix)&&void 0!==t?t:"")):i.set(e,dt.Mh(e.cellRef.node,o,null!==(n=e.prefix)&&void 0!==n?n:""))}))},a=t=>{this.parser&&(dt.xg(e.content.node),i=new WeakMap,e.content.widgets.forEach((e=>{r(e)})))},l=(t,i)=>{var s,r,a,l;if(n.configuration.syncCollapseState)if(null!==i){const e=i.cellRef;e.headingCollapsed!==(null!==(s=i.collapsed)&&void 0!==s&&s)&&(e.headingCollapsed=null!==(r=i.collapsed)&&void 0!==r&&r)}else{const t=null!==(l=null===(a=n.headings[0])||void 0===a?void 0:a.collapsed)&&void 0!==l&&l;e.content.widgets.forEach((e=>{e instanceof o.KI&&e.headingInfo.level>=0&&(e.headingCollapsed=t)}))}},c=(e,t)=>{if(n.configuration.syncCollapseState){const e=n.getCellHeadings(t)[0];e&&n.toggleCollapse({heading:e,collapsed:t.headingCollapsed})}},d=(e,t)=>{t.inViewport?r(t):dt.xg(t.node)};return e.context.ready.then((()=>{a(),n.activeHeadingChanged.connect(s),n.headingsChanged.connect(a),n.collapseChanged.connect(l),e.content.cellCollapsed.connect(c),e.content.cellInViewportChanged.connect(d),e.disposed.connect((()=>{n.activeHeadingChanged.disconnect(s),n.headingsChanged.disconnect(a),n.collapseChanged.disconnect(l),e.content.cellCollapsed.disconnect(c),e.content.cellInViewportChanged.disconnect(d)}))})),n}}async function pt(e,t,n){let i=null;return e.type===o.fh.HeadingType.Markdown?i=await xe.oQ(t,e.raw,e.level,n):e.type===o.fh.HeadingType.HTML&&(i=e.id),i}const ft=new c.Token("@jupyterlab/notebook:INotebookWidgetFactory","A service to create the notebook viewer."),mt=new c.Token("@jupyterlab/notebook:INotebookTools",'A service for the "Notebook Tools" panel in the\n  right sidebar. Use this to add your own functionality to the panel.'),vt=new c.Token("@jupyterlab/notebook:INotebookTracker","A widget tracker for notebooks.\n  Use this if you want to be able to iterate over and interact with notebooks\n  created by the application."),_t=new c.Token("@jupyterlab/notebook:INotebookCellExecutor","The notebook cell executor");class Ct extends i.WidgetTracker{constructor(){super(...arguments),this._activeCell=null,this._activeCellChanged=new d.Signal(this),this._selectionChanged=new d.Signal(this)}get activeCell(){const e=this.currentWidget;return e&&e.content.activeCell||null}get activeCellChanged(){return this._activeCellChanged}get selectionChanged(){return this._selectionChanged}add(e){const t=super.add(e);return e.content.activeCellChanged.connect(this._onActiveCellChanged,this),e.content.selectionChanged.connect(this._onSelectionChanged,this),t}dispose(){this._activeCell=null,super.dispose()}onCurrentChanged(e){const t=this.activeCell;t&&t===this._activeCell||(this._activeCell=t,e&&this._activeCellChanged.emit(e.content.activeCell||null))}_onActiveCellChanged(e,t){this.currentWidget&&this.currentWidget.content===e&&(this._activeCell=t||null,this._activeCellChanged.emit(this._activeCell))}_onSelectionChanged(e){this.currentWidget&&this.currentWidget.content===e&&this._selectionChanged.emit(void 0)}}function yt(e){return e.allCellsTrusted?u().createElement(w.trustedIcon.react,{top:"2px",stylesheet:"statusBar"}):u().createElement(w.notTrustedIcon.react,{top:"2px",stylesheet:"statusBar"})}class wt extends w.VDomRenderer{constructor(e){super(new wt.Model),this.translator=e||a.nullTranslator,this.node.classList.add("jp-StatusItem-trust")}render(){if(!this.model)return null;const e=function(e,t){const n=(t=t||a.nullTranslator).load("jupyterlab");return e.trustedCells===e.totalCells?n.__("Notebook trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells):e.activeCellTrusted?n.__("Active cell trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells):n.__("Notebook not trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells)}(this.model,this.translator);return e!==this.node.title&&(this.node.title=e),u().createElement(yt,{allCellsTrusted:this.model.trustedCells===this.model.totalCells,activeCellTrusted:this.model.activeCellTrusted,totalCells:this.model.totalCells,trustedCells:this.model.trustedCells})}}!function(e){class t extends w.VDomModel{constructor(){super(...arguments),this._trustedCells=0,this._totalCells=0,this._activeCellTrusted=!1,this._notebook=null}get trustedCells(){return this._trustedCells}get totalCells(){return this._totalCells}get activeCellTrusted(){return this._activeCellTrusted}get notebook(){return this._notebook}set notebook(e){const t=this._notebook;null!==t&&(t.activeCellChanged.disconnect(this._onActiveCellChanged,this),t.modelContentChanged.disconnect(this._onModelChanged,this));const n=this._getAllState();if(this._notebook=e,null===this._notebook)this._trustedCells=0,this._totalCells=0,this._activeCellTrusted=!1;else{this._notebook.activeCellChanged.connect(this._onActiveCellChanged,this),this._notebook.modelContentChanged.connect(this._onModelChanged,this),this._notebook.activeCell?this._activeCellTrusted=this._notebook.activeCell.model.trusted:this._activeCellTrusted=!1;const{total:e,trusted:t}=this._deriveCellTrustState(this._notebook.model);this._totalCells=e,this._trustedCells=t}this._triggerChange(n,this._getAllState())}_onModelChanged(e){const t=this._getAllState(),{total:n,trusted:i}=this._deriveCellTrustState(e.model);this._totalCells=n,this._trustedCells=i,this._triggerChange(t,this._getAllState())}_onActiveCellChanged(e,t){const n=this._getAllState();this._activeCellTrusted=!!t&&t.model.trusted,this._triggerChange(n,this._getAllState())}_deriveCellTrustState(e){if(null===e)return{total:0,trusted:0};let t=0,n=0;for(const i of e.cells)"code"===i.type&&(t++,i.trusted&&n++);return{total:t,trusted:n}}_getAllState(){return[this._trustedCells,this._totalCells,this.activeCellTrusted]}_triggerChange(e,t){e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||this.stateChanged.emit(void 0)}}e.Model=t}(wt||(wt={}));class bt extends ke.ABCWidgetFactory{constructor(e){super(e),this.rendermime=e.rendermime,this.contentFactory=e.contentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig||Ge.defaultEditorConfig,this._notebookConfig=e.notebookConfig||Ge.defaultNotebookConfig}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}createNewWidget(e,t){const n=e.translator,i=new M({sessionContext:e.sessionContext,translator:n}),s={rendermime:t?t.content.rendermime:this.rendermime.clone({resolver:e.urlResolver}),contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:t?t.content.editorConfig:this._editorConfig,notebookConfig:t?t.content.notebookConfig:this._notebookConfig,translator:n,kernelHistory:i},o=this.contentFactory.createNotebook(s);return new Xe({context:e,content:o})}}},29540:(e,t,n)=>{"use strict";n.d(t,{U:()=>r});var i=n(68211),s=n(60731),o=n(22742);class r extends o.E{constructor(e={}){super({itemCmp:i.JSONExt.deepEqual,values:e.values})}toJSON(){const e=Object.create(null),t=this.keys();for(const n of t){const t=this.get(n);void 0!==t&&(e[n]=i.JSONExt.deepCopy(t))}return e}}!function(e){class t extends s.Message{constructor(e,t){super(e),this.args=t}}e.ChangeMessage=t}(r||(r={}))},41205:(e,t,n)=>{"use strict";n.d(t,{NZ:()=>o,$O:()=>g,a3:()=>u,pC:()=>h,yp:()=>c});var i=n(59407),s=n.n(i);function o(e){const{spacing:t,children:n,className:s,...o}=e,r=i.Children.count(n);return i.createElement("div",{className:`jp-StatusBar-GroupItem ${s||""}`,...o},i.Children.map(n,((e,n)=>0===n?i.createElement("div",{style:{marginRight:`${t}px`}},e):n===r-1?i.createElement("div",{style:{marginLeft:`${t}px`}},e):i.createElement("div",{style:{margin:`0px ${t}px`}},e))))}var r,a=n(64530),l=n(80281);function c(e){const t=new d(e);return e.startHidden||t.launch(),t}class d extends l.Widget{constructor(e){super(),this._body=e.body,this._body.addClass("jp-StatusBar-HoverItem"),this._anchor=e.anchor,this._align=e.align,e.hasDynamicSize&&(this._observer=new ResizeObserver((()=>{this.update()}))),(this.layout=new l.PanelLayout).addWidget(e.body),this._body.node.addEventListener("resize",(()=>{this.update()}))}launch(){this._setGeometry(),l.Widget.attach(this,document.body),this.update(),this._anchor.addClass("jp-mod-clicked"),this._anchor.removeClass("jp-mod-highlight")}onUpdateRequest(e){this._setGeometry(),super.onUpdateRequest(e)}onAfterAttach(e){var t;document.addEventListener("click",this,!1),this.node.addEventListener("keydown",this,!1),window.addEventListener("resize",this,!1),null===(t=this._observer)||void 0===t||t.observe(this._body.node)}onBeforeDetach(e){var t;null===(t=this._observer)||void 0===t||t.disconnect(),document.removeEventListener("click",this,!1),this.node.removeEventListener("keydown",this,!1),window.removeEventListener("resize",this,!1)}onResize(){this.update()}dispose(){var e;null===(e=this._observer)||void 0===e||e.disconnect(),super.dispose(),this._anchor.removeClass("jp-mod-clicked"),this._anchor.addClass("jp-mod-highlight")}handleEvent(e){switch(e.type){case"keydown":this._evtKeydown(e);break;case"click":this._evtClick(e);break;case"resize":this.onResize()}}_evtClick(e){!e.target||this._body.node.contains(e.target)||this._anchor.node.contains(e.target)||this.dispose()}_evtKeydown(e){27===e.keyCode&&(e.stopPropagation(),e.preventDefault(),this.dispose())}_setGeometry(){let e=0;const t=this._anchor.node.getBoundingClientRect(),n=this._body.node.getBoundingClientRect();"right"===this._align&&(e=-(n.width-t.width));const i=window.getComputedStyle(this._body.node);a.HoverBox.setGeometry({anchor:t,host:document.body,maxHeight:500,minHeight:20,node:this._body.node,offset:{horizontal:e},privilege:"forceAbove",style:i})}}function h(e){const{title:t,source:n,className:s,...o}=e;return i.createElement("span",{className:`jp-StatusBar-TextItem ${s}`,title:t,...o},n)}function u(e){return s().createElement("div",{className:"jp-Statusbar-ProgressCircle",role:"progressbar","aria-label":e.label||"Unlabelled progress circle","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":e.progress},s().createElement("svg",{viewBox:"0 0 250 250"},s().createElement("circle",{cx:"125",cy:"125",r:"104",stroke:"var(--jp-inverse-layout-color3)",strokeWidth:"20",fill:"none"}),s().createElement("path",{className:"jp-Statusbar-ProgressCirclePath",transform:"translate(125,125) scale(.9)",d:(e=>{const t=Math.max(3.6*e,.1),n=t*Math.PI/180,i=104*Math.sin(n),s=-104*Math.cos(n);return"M 0 0 v -104 A 104 104 1 "+(t<180?1:0)+" 0 "+i.toFixed(4)+" "+s.toFixed(4)+" z"})(e.progress),fill:"var(--jp-inverse-layout-color3)"})))}n(45945),n(49711),l.Widget,function(e){e.statusItemDefaults={align:"left",rank:0,priority:0,isActive:()=>!0,activeStateChanged:void 0}}(r||(r={}));const g=new(n(68211).Token)("@jupyterlab/statusbar:IStatusBar","A service for the status bar on the application. Use this if you want to add new status bar items.")},66229:(e,t,n)=>{e=n.nmd(e);var i="__lodash_hash_undefined__",s=9007199254740991,o="[object Arguments]",r="[object Function]",a="[object Object]",l=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,d={};d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d[o]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object Boolean]"]=d["[object DataView]"]=d["[object Date]"]=d["[object Error]"]=d[r]=d["[object Map]"]=d["[object Number]"]=d[a]=d["[object RegExp]"]=d["[object Set]"]=d["[object String]"]=d["[object WeakMap]"]=!1;var h,u,g,p="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,f="object"==typeof self&&self&&self.Object===Object&&self,m=p||f||Function("return this")(),v=t&&!t.nodeType&&t,_=v&&e&&!e.nodeType&&e,C=_&&_.exports===v,y=C&&p.process,w=function(){try{return _&&_.require&&_.require("util").types||y&&y.binding&&y.binding("util")}catch(e){}}(),b=w&&w.isTypedArray,S=Array.prototype,k=Function.prototype,x=Object.prototype,E=m["__core-js_shared__"],M=k.toString,I=x.hasOwnProperty,T=(h=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"",N=x.toString,D=M.call(Object),A=RegExp("^"+M.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=C?m.Buffer:void 0,O=m.Symbol,R=m.Uint8Array,L=(P&&P.allocUnsafe,u=Object.getPrototypeOf,g=Object,function(e){return u(g(e))}),H=Object.create,j=x.propertyIsEnumerable,F=S.splice,B=O?O.toStringTag:void 0,q=function(){try{var e=ae(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),W=P?P.isBuffer:void 0,V=Math.max,U=Date.now,z=ae(m,"Map"),$=ae(Object,"create"),J=function(){function e(){}return function(t){if(!Ce(t))return{};if(H)return H(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function K(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function G(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Q(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Y(e){var t=this.__data__=new G(e);this.size=t.size}function X(e,t,n){(void 0!==n&&!ue(e[t],n)||void 0===n&&!(t in e))&&te(e,t,n)}function Z(e,t,n){var i=e[t];I.call(e,t)&&ue(i,n)&&(void 0!==n||t in e)||te(e,t,n)}function ee(e,t){for(var n=e.length;n--;)if(ue(e[n][0],t))return n;return-1}function te(e,t,n){"__proto__"==t&&q?q(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}K.prototype.clear=function(){this.__data__=$?$(null):{},this.size=0},K.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},K.prototype.get=function(e){var t=this.__data__;if($){var n=t[e];return n===i?void 0:n}return I.call(t,e)?t[e]:void 0},K.prototype.has=function(e){var t=this.__data__;return $?void 0!==t[e]:I.call(t,e)},K.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=$&&void 0===t?i:t,this},G.prototype.clear=function(){this.__data__=[],this.size=0},G.prototype.delete=function(e){var t=this.__data__,n=ee(t,e);return!(n<0||(n==t.length-1?t.pop():F.call(t,n,1),--this.size,0))},G.prototype.get=function(e){var t=this.__data__,n=ee(t,e);return n<0?void 0:t[n][1]},G.prototype.has=function(e){return ee(this.__data__,e)>-1},G.prototype.set=function(e,t){var n=this.__data__,i=ee(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},Q.prototype.clear=function(){this.size=0,this.__data__={hash:new K,map:new(z||G),string:new K}},Q.prototype.delete=function(e){var t=re(this,e).delete(e);return this.size-=t?1:0,t},Q.prototype.get=function(e){return re(this,e).get(e)},Q.prototype.has=function(e){return re(this,e).has(e)},Q.prototype.set=function(e,t){var n=re(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},Y.prototype.clear=function(){this.__data__=new G,this.size=0},Y.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Y.prototype.get=function(e){return this.__data__.get(e)},Y.prototype.has=function(e){return this.__data__.has(e)},Y.prototype.set=function(e,t){var n=this.__data__;if(n instanceof G){var i=n.__data__;if(!z||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new Q(i)}return n.set(e,t),this.size=n.size,this};function ne(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":B&&B in Object(e)?function(e){var t=I.call(e,B),n=e[B];try{e[B]=void 0;var i=!0}catch(e){}var s=N.call(e);return i&&(t?e[B]=n:delete e[B]),s}(e):function(e){return N.call(e)}(e)}function ie(e){return ye(e)&&ne(e)==o}function se(e,t,n,i,s){e!==t&&function(e,t,n){for(var i=-1,s=Object(e),o=n(e),r=o.length;r--;){var a=o[++i];if(!1===t(s[a],a,s))break}}(t,(function(o,r){if(s||(s=new Y),Ce(o))!function(e,t,n,i,s,o,r){var l=de(e,n),c=de(t,n),d=r.get(c);if(d)X(e,n,d);else{var h,u,g,p,f,m=o?o(l,c,n+"",e,t,r):void 0,v=void 0===m;if(v){var _=pe(c),C=!_&&me(c),y=!_&&!C&&we(c);m=c,_||C||y?pe(l)?m=l:ye(f=l)&&fe(f)?m=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}(l):C?(v=!1,m=function(e){return e.slice()}(c)):y?(v=!1,p=new(g=(h=c).buffer).constructor(g.byteLength),new R(p).set(new R(g)),u=p,m=new h.constructor(u,h.byteOffset,h.length)):m=[]:function(e){if(!ye(e)||ne(e)!=a)return!1;var t=L(e);if(null===t)return!0;var n=I.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&M.call(n)==D}(c)||ge(c)?(m=l,ge(l)?m=function(e){return function(e,t,n){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var r=t[s],a=void 0;void 0===a&&(a=e[r]),i?te(n,r,a):Z(n,r,a)}return n}(e,be(e))}(l):Ce(l)&&!ve(l)||(m=function(e){return"function"!=typeof e.constructor||ce(e)?{}:J(L(e))}(c))):v=!1}v&&(r.set(c,m),s(m,c,i,o,r),r.delete(c)),X(e,n,m)}}(e,t,r,n,se,i,s);else{var l=i?i(de(e,r),o,r+"",e,t,s):void 0;void 0===l&&(l=o),X(e,r,l)}}),be)}var oe=q?function(e,t){return q(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:xe;function re(e,t){var n,i,s=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?s["string"==typeof t?"string":"hash"]:s.map}function ae(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Ce(e)||function(e){return!!T&&T in e}(e))&&(ve(e)?A:l).test(function(e){if(null!=e){try{return M.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}(n)?n:void 0}function le(e,t){var n=typeof e;return!!(t=null==t?s:t)&&("number"==n||"symbol"!=n&&c.test(e))&&e>-1&&e%1==0&&e<t}function ce(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||x)}function de(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var he=function(e){var t=0,n=0;return function(){var i=U(),s=16-(i-n);if(n=i,s>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(oe);function ue(e,t){return e===t||e!=e&&t!=t}var ge=ie(function(){return arguments}())?ie:function(e){return ye(e)&&I.call(e,"callee")&&!j.call(e,"callee")},pe=Array.isArray;function fe(e){return null!=e&&_e(e.length)&&!ve(e)}var me=W||function(){return!1};function ve(e){if(!Ce(e))return!1;var t=ne(e);return t==r||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function _e(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=s}function Ce(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ye(e){return null!=e&&"object"==typeof e}var we=b?function(e){return function(t){return e(t)}}(b):function(e){return ye(e)&&_e(e.length)&&!!d[ne(e)]};function be(e){return fe(e)?function(e,t){var n=pe(e),i=!n&&ge(e),s=!n&&!i&&me(e),o=!n&&!i&&!s&&we(e),r=n||i||s||o,a=r?function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}(e.length,String):[],l=a.length;for(var c in e)!t&&!I.call(e,c)||r&&("length"==c||s&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||le(c,l))||a.push(c);return a}(e,!0):function(e){if(!Ce(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=ce(e),n=[];for(var i in e)("constructor"!=i||!t&&I.call(e,i))&&n.push(i);return n}(e)}var Se,ke=(Se=function(e,t,n,i){se(e,t,n,i)},function(e,t){return he(function(e,t,n){return t=V(void 0===t?e.length-1:t,0),function(){for(var i=arguments,s=-1,o=V(i.length-t,0),r=Array(o);++s<o;)r[s]=i[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=i[s];return a[t]=n(r),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,a)}}(e,t,xe),e+"")}((function(e,t){var n=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=Se.length>3&&"function"==typeof s?(i--,s):void 0,o&&function(e,t,n){if(!Ce(n))return!1;var i=typeof t;return!!("number"==i?fe(n)&&le(t,n.length):"string"==i&&t in n)&&ue(n[t],e)}(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var r=t[n];r&&Se(e,r,n,s)}return e})));function xe(e){return e}e.exports=ke},84879:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageConnection=t.BrowserMessageWriter=t.BrowserMessageReader=void 0,n(78927).default.install();const o=n(78969);s(n(78969),t);class r extends o.AbstractMessageReader{constructor(e){super(),this._onData=new o.Emitter,this._messageListener=e=>{this._onData.fire(e.data)},e.addEventListener("error",(e=>this.fireError(e))),e.onmessage=this._messageListener}listen(e){return this._onData.event(e)}}t.BrowserMessageReader=r;class a extends o.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.addEventListener("error",(e=>this.fireError(e)))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}}t.BrowserMessageWriter=a,t.createMessageConnection=function(e,t,n,i){return void 0===n&&(n=o.NullLogger),o.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),(0,o.createMessageConnection)(e,t,n,i)}},78927:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(78969);class s extends i.AbstractMessageBuffer{constructor(e="utf-8"){super(e),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return s.emptyBuffer}fromString(e,t){return(new TextEncoder).encode(e)}toString(e,t){return"ascii"===t?this.asciiDecoder.decode(e):new TextDecoder(t).decode(e)}asNative(e,t){return void 0===t?e:e.slice(0,t)}allocNative(e){return new Uint8Array(e)}}s.emptyBuffer=new Uint8Array(0);class o{constructor(e){this.socket=e,this._onData=new i.Emitter,this._messageListener=e=>{e.data.arrayBuffer().then((e=>{this._onData.fire(new Uint8Array(e))}),(()=>{(0,i.RAL)().console.error("Converting blob to array buffer failed.")}))},this.socket.addEventListener("message",this._messageListener)}onClose(e){return this.socket.addEventListener("close",e),i.Disposable.create((()=>this.socket.removeEventListener("close",e)))}onError(e){return this.socket.addEventListener("error",e),i.Disposable.create((()=>this.socket.removeEventListener("error",e)))}onEnd(e){return this.socket.addEventListener("end",e),i.Disposable.create((()=>this.socket.removeEventListener("end",e)))}onData(e){return this._onData.event(e)}}class r{constructor(e){this.socket=e}onClose(e){return this.socket.addEventListener("close",e),i.Disposable.create((()=>this.socket.removeEventListener("close",e)))}onError(e){return this.socket.addEventListener("error",e),i.Disposable.create((()=>this.socket.removeEventListener("error",e)))}onEnd(e){return this.socket.addEventListener("end",e),i.Disposable.create((()=>this.socket.removeEventListener("end",e)))}write(e,t){if("string"==typeof e){if(void 0!==t&&"utf-8"!==t)throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${t}`);this.socket.send(e)}else this.socket.send(e);return Promise.resolve()}end(){this.socket.close()}}const a=new TextEncoder,l=Object.freeze({messageBuffer:Object.freeze({create:e=>new s(e)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(e,t)=>{if("utf-8"!==t.charset)throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${t.charset}`);return Promise.resolve(a.encode(JSON.stringify(e,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(e,t)=>{if(!(e instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(t.charset).decode(e)))}})}),stream:Object.freeze({asReadableStream:e=>new o(e),asWritableStream:e=>new r(e)}),console,timer:Object.freeze({setTimeout(e,t,...n){const i=setTimeout(e,t,...n);return{dispose:()=>clearTimeout(i)}},setImmediate(e,...t){const n=setTimeout(e,0,...t);return{dispose:()=>clearTimeout(n)}},setInterval(e,t,...n){const i=setInterval(e,t,...n);return{dispose:()=>clearInterval(i)}}})});function c(){return l}!function(e){e.install=function(){i.RAL.install(l)}}(c||(c={})),t.default=c},78969:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressType=t.ProgressToken=t.createMessageConnection=t.NullLogger=t.ConnectionOptions=t.ConnectionStrategy=t.AbstractMessageBuffer=t.WriteableStreamMessageWriter=t.AbstractMessageWriter=t.MessageWriter=t.ReadableStreamMessageReader=t.AbstractMessageReader=t.MessageReader=t.SharedArrayReceiverStrategy=t.SharedArraySenderStrategy=t.CancellationToken=t.CancellationTokenSource=t.Emitter=t.Event=t.Disposable=t.LRUCache=t.Touch=t.LinkedMap=t.ParameterStructures=t.NotificationType9=t.NotificationType8=t.NotificationType7=t.NotificationType6=t.NotificationType5=t.NotificationType4=t.NotificationType3=t.NotificationType2=t.NotificationType1=t.NotificationType0=t.NotificationType=t.ErrorCodes=t.ResponseError=t.RequestType9=t.RequestType8=t.RequestType7=t.RequestType6=t.RequestType5=t.RequestType4=t.RequestType3=t.RequestType2=t.RequestType1=t.RequestType0=t.RequestType=t.Message=t.RAL=void 0,t.MessageStrategy=t.CancellationStrategy=t.CancellationSenderStrategy=t.CancellationReceiverStrategy=t.ConnectionError=t.ConnectionErrors=t.LogTraceNotification=t.SetTraceNotification=t.TraceFormat=t.TraceValues=t.Trace=void 0;const i=n(44313);Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return i.Message}}),Object.defineProperty(t,"RequestType",{enumerable:!0,get:function(){return i.RequestType}}),Object.defineProperty(t,"RequestType0",{enumerable:!0,get:function(){return i.RequestType0}}),Object.defineProperty(t,"RequestType1",{enumerable:!0,get:function(){return i.RequestType1}}),Object.defineProperty(t,"RequestType2",{enumerable:!0,get:function(){return i.RequestType2}}),Object.defineProperty(t,"RequestType3",{enumerable:!0,get:function(){return i.RequestType3}}),Object.defineProperty(t,"RequestType4",{enumerable:!0,get:function(){return i.RequestType4}}),Object.defineProperty(t,"RequestType5",{enumerable:!0,get:function(){return i.RequestType5}}),Object.defineProperty(t,"RequestType6",{enumerable:!0,get:function(){return i.RequestType6}}),Object.defineProperty(t,"RequestType7",{enumerable:!0,get:function(){return i.RequestType7}}),Object.defineProperty(t,"RequestType8",{enumerable:!0,get:function(){return i.RequestType8}}),Object.defineProperty(t,"RequestType9",{enumerable:!0,get:function(){return i.RequestType9}}),Object.defineProperty(t,"ResponseError",{enumerable:!0,get:function(){return i.ResponseError}}),Object.defineProperty(t,"ErrorCodes",{enumerable:!0,get:function(){return i.ErrorCodes}}),Object.defineProperty(t,"NotificationType",{enumerable:!0,get:function(){return i.NotificationType}}),Object.defineProperty(t,"NotificationType0",{enumerable:!0,get:function(){return i.NotificationType0}}),Object.defineProperty(t,"NotificationType1",{enumerable:!0,get:function(){return i.NotificationType1}}),Object.defineProperty(t,"NotificationType2",{enumerable:!0,get:function(){return i.NotificationType2}}),Object.defineProperty(t,"NotificationType3",{enumerable:!0,get:function(){return i.NotificationType3}}),Object.defineProperty(t,"NotificationType4",{enumerable:!0,get:function(){return i.NotificationType4}}),Object.defineProperty(t,"NotificationType5",{enumerable:!0,get:function(){return i.NotificationType5}}),Object.defineProperty(t,"NotificationType6",{enumerable:!0,get:function(){return i.NotificationType6}}),Object.defineProperty(t,"NotificationType7",{enumerable:!0,get:function(){return i.NotificationType7}}),Object.defineProperty(t,"NotificationType8",{enumerable:!0,get:function(){return i.NotificationType8}}),Object.defineProperty(t,"NotificationType9",{enumerable:!0,get:function(){return i.NotificationType9}}),Object.defineProperty(t,"ParameterStructures",{enumerable:!0,get:function(){return i.ParameterStructures}});const s=n(6176);Object.defineProperty(t,"LinkedMap",{enumerable:!0,get:function(){return s.LinkedMap}}),Object.defineProperty(t,"LRUCache",{enumerable:!0,get:function(){return s.LRUCache}}),Object.defineProperty(t,"Touch",{enumerable:!0,get:function(){return s.Touch}});const o=n(17963);Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return o.Disposable}});const r=n(26780);Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return r.Event}}),Object.defineProperty(t,"Emitter",{enumerable:!0,get:function(){return r.Emitter}});const a=n(63106);Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return a.CancellationTokenSource}}),Object.defineProperty(t,"CancellationToken",{enumerable:!0,get:function(){return a.CancellationToken}});const l=n(46492);Object.defineProperty(t,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return l.SharedArraySenderStrategy}}),Object.defineProperty(t,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return l.SharedArrayReceiverStrategy}});const c=n(79813);Object.defineProperty(t,"MessageReader",{enumerable:!0,get:function(){return c.MessageReader}}),Object.defineProperty(t,"AbstractMessageReader",{enumerable:!0,get:function(){return c.AbstractMessageReader}}),Object.defineProperty(t,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return c.ReadableStreamMessageReader}});const d=n(87745);Object.defineProperty(t,"MessageWriter",{enumerable:!0,get:function(){return d.MessageWriter}}),Object.defineProperty(t,"AbstractMessageWriter",{enumerable:!0,get:function(){return d.AbstractMessageWriter}}),Object.defineProperty(t,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return d.WriteableStreamMessageWriter}});const h=n(92180);Object.defineProperty(t,"AbstractMessageBuffer",{enumerable:!0,get:function(){return h.AbstractMessageBuffer}});const u=n(22249);Object.defineProperty(t,"ConnectionStrategy",{enumerable:!0,get:function(){return u.ConnectionStrategy}}),Object.defineProperty(t,"ConnectionOptions",{enumerable:!0,get:function(){return u.ConnectionOptions}}),Object.defineProperty(t,"NullLogger",{enumerable:!0,get:function(){return u.NullLogger}}),Object.defineProperty(t,"createMessageConnection",{enumerable:!0,get:function(){return u.createMessageConnection}}),Object.defineProperty(t,"ProgressToken",{enumerable:!0,get:function(){return u.ProgressToken}}),Object.defineProperty(t,"ProgressType",{enumerable:!0,get:function(){return u.ProgressType}}),Object.defineProperty(t,"Trace",{enumerable:!0,get:function(){return u.Trace}}),Object.defineProperty(t,"TraceValues",{enumerable:!0,get:function(){return u.TraceValues}}),Object.defineProperty(t,"TraceFormat",{enumerable:!0,get:function(){return u.TraceFormat}}),Object.defineProperty(t,"SetTraceNotification",{enumerable:!0,get:function(){return u.SetTraceNotification}}),Object.defineProperty(t,"LogTraceNotification",{enumerable:!0,get:function(){return u.LogTraceNotification}}),Object.defineProperty(t,"ConnectionErrors",{enumerable:!0,get:function(){return u.ConnectionErrors}}),Object.defineProperty(t,"ConnectionError",{enumerable:!0,get:function(){return u.ConnectionError}}),Object.defineProperty(t,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return u.CancellationReceiverStrategy}}),Object.defineProperty(t,"CancellationSenderStrategy",{enumerable:!0,get:function(){return u.CancellationSenderStrategy}}),Object.defineProperty(t,"CancellationStrategy",{enumerable:!0,get:function(){return u.CancellationStrategy}}),Object.defineProperty(t,"MessageStrategy",{enumerable:!0,get:function(){return u.MessageStrategy}});const g=n(34254);t.RAL=g.default},63106:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationTokenSource=t.CancellationToken=void 0;const i=n(34254),s=n(86145),o=n(26780);var r;!function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:o.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:o.Event.None}),e.is=function(t){const n=t;return n&&(n===e.None||n===e.Cancelled||s.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}}(r||(t.CancellationToken=r={}));const a=Object.freeze((function(e,t){const n=(0,i.default)().timer.setTimeout(e.bind(t),0);return{dispose(){n.dispose()}}}));class l{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?a:(this._emitter||(this._emitter=new o.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}t.CancellationTokenSource=class{get token(){return this._token||(this._token=new l),this._token}cancel(){this._token?this._token.cancel():this._token=r.Cancelled}dispose(){this._token?this._token instanceof l&&this._token.dispose():this._token=r.None}}},22249:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageConnection=t.ConnectionOptions=t.MessageStrategy=t.CancellationStrategy=t.CancellationSenderStrategy=t.CancellationReceiverStrategy=t.RequestCancellationReceiverStrategy=t.IdCancellationReceiverStrategy=t.ConnectionStrategy=t.ConnectionError=t.ConnectionErrors=t.LogTraceNotification=t.SetTraceNotification=t.TraceFormat=t.TraceValues=t.Trace=t.NullLogger=t.ProgressType=t.ProgressToken=void 0;const i=n(34254),s=n(86145),o=n(44313),r=n(6176),a=n(26780),l=n(63106);var c,d,h,u,g,p,f,m,v,_,C,y,w,b,S,k,x,E,M;!function(e){e.type=new o.NotificationType("$/cancelRequest")}(c||(c={})),function(e){e.is=function(e){return"string"==typeof e||"number"==typeof e}}(d||(t.ProgressToken=d={})),function(e){e.type=new o.NotificationType("$/progress")}(h||(h={})),t.ProgressType=class{constructor(){}},function(e){e.is=function(e){return s.func(e)}}(u||(u={})),t.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}}),function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Compact=2]="Compact",e[e.Verbose=3]="Verbose"}(g||(t.Trace=g={})),function(e){e.Off="off",e.Messages="messages",e.Compact="compact",e.Verbose="verbose"}(p||(t.TraceValues=p={})),function(e){e.fromString=function(t){if(!s.string(t))return e.Off;switch(t=t.toLowerCase()){case"off":default:return e.Off;case"messages":return e.Messages;case"compact":return e.Compact;case"verbose":return e.Verbose}},e.toString=function(t){switch(t){case e.Off:return"off";case e.Messages:return"messages";case e.Compact:return"compact";case e.Verbose:return"verbose";default:return"off"}}}(g||(t.Trace=g={})),function(e){e.Text="text",e.JSON="json"}(f||(t.TraceFormat=f={})),function(e){e.fromString=function(t){return s.string(t)&&"json"===(t=t.toLowerCase())?e.JSON:e.Text}}(f||(t.TraceFormat=f={})),function(e){e.type=new o.NotificationType("$/setTrace")}(m||(t.SetTraceNotification=m={})),function(e){e.type=new o.NotificationType("$/logTrace")}(v||(t.LogTraceNotification=v={})),function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"}(_||(t.ConnectionErrors=_={}));class I extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,I.prototype)}}t.ConnectionError=I,function(e){e.is=function(e){const t=e;return t&&s.func(t.cancelUndispatched)}}(C||(t.ConnectionStrategy=C={})),function(e){e.is=function(e){const t=e;return t&&(void 0===t.kind||"id"===t.kind)&&s.func(t.createCancellationTokenSource)&&(void 0===t.dispose||s.func(t.dispose))}}(y||(t.IdCancellationReceiverStrategy=y={})),function(e){e.is=function(e){const t=e;return t&&"request"===t.kind&&s.func(t.createCancellationTokenSource)&&(void 0===t.dispose||s.func(t.dispose))}}(w||(t.RequestCancellationReceiverStrategy=w={})),function(e){e.Message=Object.freeze({createCancellationTokenSource:e=>new l.CancellationTokenSource}),e.is=function(e){return y.is(e)||w.is(e)}}(b||(t.CancellationReceiverStrategy=b={})),function(e){e.Message=Object.freeze({sendCancellation:(e,t)=>e.sendNotification(c.type,{id:t}),cleanup(e){}}),e.is=function(e){const t=e;return t&&s.func(t.sendCancellation)&&s.func(t.cleanup)}}(S||(t.CancellationSenderStrategy=S={})),function(e){e.Message=Object.freeze({receiver:b.Message,sender:S.Message}),e.is=function(e){const t=e;return t&&b.is(t.receiver)&&S.is(t.sender)}}(k||(t.CancellationStrategy=k={})),function(e){e.is=function(e){const t=e;return t&&s.func(t.handleMessage)}}(x||(t.MessageStrategy=x={})),function(e){e.is=function(e){const t=e;return t&&(k.is(t.cancellationStrategy)||C.is(t.connectionStrategy)||x.is(t.messageStrategy))}}(E||(t.ConnectionOptions=E={})),function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"}(M||(M={})),t.createMessageConnection=function(e,n,p,C){const w=void 0!==p?p:t.NullLogger;let b=0,S=0,E=0;const T="2.0";let N;const D=new Map;let A;const P=new Map,O=new Map;let R,L,H=new r.LinkedMap,j=new Map,F=new Set,B=new Map,q=g.Off,W=f.Text,V=M.New;const U=new a.Emitter,z=new a.Emitter,$=new a.Emitter,J=new a.Emitter,K=new a.Emitter,G=C&&C.cancellationStrategy?C.cancellationStrategy:k.Message;function Q(e){if(null===e)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+e.toString()}function Y(e){}function X(){return V===M.Listening}function Z(){return V===M.Closed}function ee(){return V===M.Disposed}function te(){V!==M.New&&V!==M.Listening||(V=M.Closed,z.fire(void 0))}function ne(){R||0===H.size||(R=(0,i.default)().timer.setImmediate((()=>{R=void 0,function(){if(0===H.size)return;const e=H.shift();try{const t=C?.messageStrategy;x.is(t)?t.handleMessage(e,ie):ie(e)}finally{ne()}}()})))}function ie(e){o.Message.isRequest(e)?function(e){if(ee())return;function t(t,i,s){const r={jsonrpc:T,id:e.id};t instanceof o.ResponseError?r.error=t.toJson():r.result=void 0===t?null:t,re(r,i,s),n.write(r).catch((()=>w.error("Sending response failed.")))}function i(t,i,s){const o={jsonrpc:T,id:e.id,error:t.toJson()};re(o,i,s),n.write(o).catch((()=>w.error("Sending response failed.")))}!function(e){if(q!==g.Off&&L)if(W===f.Text){let t;q!==g.Verbose&&q!==g.Compact||!e.params||(t=`Params: ${oe(e.params)}\n\n`),L.log(`Received request '${e.method} - (${e.id})'.`,t)}else le("receive-request",e)}(e);const r=D.get(e.method);let a,l;r&&(a=r.type,l=r.handler);const c=Date.now();if(l||N){const r=e.id??String(Date.now()),d=y.is(G.receiver)?G.receiver.createCancellationTokenSource(r):G.receiver.createCancellationTokenSource(e);null!==e.id&&F.has(e.id)&&d.cancel(),null!==e.id&&B.set(r,d);try{let h;if(l)if(void 0===e.params){if(void 0!==a&&0!==a.numberOfParams)return void i(new o.ResponseError(o.ErrorCodes.InvalidParams,`Request ${e.method} defines ${a.numberOfParams} params but received none.`),e.method,c);h=l(d.token)}else if(Array.isArray(e.params)){if(void 0!==a&&a.parameterStructures===o.ParameterStructures.byName)return void i(new o.ResponseError(o.ErrorCodes.InvalidParams,`Request ${e.method} defines parameters by name but received parameters by position`),e.method,c);h=l(...e.params,d.token)}else{if(void 0!==a&&a.parameterStructures===o.ParameterStructures.byPosition)return void i(new o.ResponseError(o.ErrorCodes.InvalidParams,`Request ${e.method} defines parameters by position but received parameters by name`),e.method,c);h=l(e.params,d.token)}else N&&(h=N(e.method,e.params,d.token));const u=h;h?u.then?u.then((n=>{B.delete(r),t(n,e.method,c)}),(t=>{B.delete(r),t instanceof o.ResponseError?i(t,e.method,c):t&&s.string(t.message)?i(new o.ResponseError(o.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,c):i(new o.ResponseError(o.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,c)})):(B.delete(r),t(h,e.method,c)):(B.delete(r),function(t,i,s){void 0===t&&(t=null);const o={jsonrpc:T,id:e.id,result:t};re(o,i,s),n.write(o).catch((()=>w.error("Sending response failed.")))}(h,e.method,c))}catch(n){B.delete(r),n instanceof o.ResponseError?t(n,e.method,c):n&&s.string(n.message)?i(new o.ResponseError(o.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${n.message}`),e.method,c):i(new o.ResponseError(o.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,c)}}else i(new o.ResponseError(o.ErrorCodes.MethodNotFound,`Unhandled method ${e.method}`),e.method,c)}(e):o.Message.isNotification(e)?function(e){if(ee())return;let t,n;if(e.method===c.type.method){const t=e.params.id;return F.delete(t),void ae(e)}{const i=P.get(e.method);i&&(n=i.handler,t=i.type)}if(n||A)try{if(ae(e),n)if(void 0===e.params)void 0!==t&&0!==t.numberOfParams&&t.parameterStructures!==o.ParameterStructures.byName&&w.error(`Notification ${e.method} defines ${t.numberOfParams} params but received none.`),n();else if(Array.isArray(e.params)){const i=e.params;e.method===h.type.method&&2===i.length&&d.is(i[0])?n({token:i[0],value:i[1]}):(void 0!==t&&(t.parameterStructures===o.ParameterStructures.byName&&w.error(`Notification ${e.method} defines parameters by name but received parameters by position`),t.numberOfParams!==e.params.length&&w.error(`Notification ${e.method} defines ${t.numberOfParams} params but received ${i.length} arguments`)),n(...i))}else void 0!==t&&t.parameterStructures===o.ParameterStructures.byPosition&&w.error(`Notification ${e.method} defines parameters by position but received parameters by name`),n(e.params);else A&&A(e.method,e.params)}catch(t){t.message?w.error(`Notification handler '${e.method}' failed with message: ${t.message}`):w.error(`Notification handler '${e.method}' failed unexpectedly.`)}else $.fire(e)}(e):o.Message.isResponse(e)?function(e){if(!ee())if(null===e.id)e.error?w.error(`Received response message without id: Error is: \n${JSON.stringify(e.error,void 0,4)}`):w.error("Received response message without id. No further error information provided.");else{const t=e.id,n=j.get(t);if(function(e,t){if(q!==g.Off&&L)if(W===f.Text){let n;if(q!==g.Verbose&&q!==g.Compact||(e.error&&e.error.data?n=`Error data: ${oe(e.error.data)}\n\n`:e.result?n=`Result: ${oe(e.result)}\n\n`:void 0===e.error&&(n="No result returned.\n\n")),t){const i=e.error?` Request failed: ${e.error.message} (${e.error.code}).`:"";L.log(`Received response '${t.method} - (${e.id})' in ${Date.now()-t.timerStart}ms.${i}`,n)}else L.log(`Received response ${e.id} without active response promise.`,n)}else le("receive-response",e)}(e,n),void 0!==n){j.delete(t);try{if(e.error){const t=e.error;n.reject(new o.ResponseError(t.code,t.message,t.data))}else{if(void 0===e.result)throw new Error("Should never happen.");n.resolve(e.result)}}catch(e){e.message?w.error(`Response handler '${n.method}' failed with message: ${e.message}`):w.error(`Response handler '${n.method}' failed unexpectedly.`)}}}}(e):function(e){if(!e)return void w.error("Received empty message.");w.error(`Received message which is neither a response nor a notification message:\n${JSON.stringify(e,null,4)}`);const t=e;if(s.string(t.id)||s.number(t.id)){const e=t.id,n=j.get(e);n&&n.reject(new Error("The received response has neither a result nor an error property."))}}(e)}e.onClose(te),e.onError((function(e){U.fire([e,void 0,void 0])})),n.onClose(te),n.onError((function(e){U.fire(e)}));const se=e=>{try{if(o.Message.isNotification(e)&&e.method===c.type.method){const t=e.params.id,i=Q(t),s=H.get(i);if(o.Message.isRequest(s)){const o=C?.connectionStrategy,r=o&&o.cancelUndispatched?o.cancelUndispatched(s,Y):void 0;if(r&&(void 0!==r.error||void 0!==r.result))return H.delete(i),B.delete(t),r.id=s.id,re(r,e.method,Date.now()),void n.write(r).catch((()=>w.error("Sending response for canceled message failed.")))}const r=B.get(t);if(void 0!==r)return r.cancel(),void ae(e);F.add(t)}!function(e,t){var n;o.Message.isRequest(t)?e.set(Q(t.id),t):o.Message.isResponse(t)?e.set(null===(n=t.id)?"res-unknown-"+(++E).toString():"res-"+n.toString(),t):e.set("not-"+(++S).toString(),t)}(H,e)}finally{ne()}};function oe(e){if(null!=e)switch(q){case g.Verbose:return JSON.stringify(e,null,4);case g.Compact:return JSON.stringify(e);default:return}}function re(e,t,n){if(q!==g.Off&&L)if(W===f.Text){let i;q!==g.Verbose&&q!==g.Compact||(e.error&&e.error.data?i=`Error data: ${oe(e.error.data)}\n\n`:e.result?i=`Result: ${oe(e.result)}\n\n`:void 0===e.error&&(i="No result returned.\n\n")),L.log(`Sending response '${t} - (${e.id})'. Processing request took ${Date.now()-n}ms`,i)}else le("send-response",e)}function ae(e){if(q!==g.Off&&L&&e.method!==v.type.method)if(W===f.Text){let t;q!==g.Verbose&&q!==g.Compact||(t=e.params?`Params: ${oe(e.params)}\n\n`:"No parameters provided.\n\n"),L.log(`Received notification '${e.method}'.`,t)}else le("receive-notification",e)}function le(e,t){if(!L||q===g.Off)return;const n={isLSPMessage:!0,type:e,message:t,timestamp:Date.now()};L.log(n)}function ce(){if(Z())throw new I(_.Closed,"Connection is closed.");if(ee())throw new I(_.Disposed,"Connection is disposed.")}function de(e){return void 0===e?null:e}function he(e){return null===e?void 0:e}function ue(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function ge(e,t){switch(e){case o.ParameterStructures.auto:return ue(t)?he(t):[de(t)];case o.ParameterStructures.byName:if(!ue(t))throw new Error("Received parameters by name but param is not an object literal.");return he(t);case o.ParameterStructures.byPosition:return[de(t)];default:throw new Error(`Unknown parameter structure ${e.toString()}`)}}function pe(e,t){let n;const i=e.numberOfParams;switch(i){case 0:n=void 0;break;case 1:n=ge(e.parameterStructures,t[0]);break;default:n=[];for(let e=0;e<t.length&&e<i;e++)n.push(de(t[e]));if(t.length<i)for(let e=t.length;e<i;e++)n.push(null)}return n}const fe={sendNotification:(e,...t)=>{let i,r;if(ce(),s.string(e)){i=e;const n=t[0];let s=0,a=o.ParameterStructures.auto;o.ParameterStructures.is(n)&&(s=1,a=n);let l=t.length;const c=l-s;switch(c){case 0:r=void 0;break;case 1:r=ge(a,t[s]);break;default:if(a===o.ParameterStructures.byName)throw new Error(`Received ${c} parameters for 'by Name' notification parameter structure.`);r=t.slice(s,l).map((e=>de(e)))}}else{const n=t;i=e.method,r=pe(e,n)}const a={jsonrpc:T,method:i,params:r};return function(e){if(q!==g.Off&&L)if(W===f.Text){let t;q!==g.Verbose&&q!==g.Compact||(t=e.params?`Params: ${oe(e.params)}\n\n`:"No parameters provided.\n\n"),L.log(`Sending notification '${e.method}'.`,t)}else le("send-notification",e)}(a),n.write(a).catch((e=>{throw w.error("Sending notification failed."),e}))},onNotification:(e,t)=>{let n;return ce(),s.func(e)?A=e:t&&(s.string(e)?(n=e,P.set(e,{type:void 0,handler:t})):(n=e.method,P.set(e.method,{type:e,handler:t}))),{dispose:()=>{void 0!==n?P.delete(n):A=void 0}}},onProgress:(e,t,n)=>{if(O.has(t))throw new Error(`Progress handler for token ${t} already registered`);return O.set(t,n),{dispose:()=>{O.delete(t)}}},sendProgress:(e,t,n)=>fe.sendNotification(h.type,{token:t,value:n}),onUnhandledProgress:J.event,sendRequest:(e,...t)=>{let i,r,a;if(ce(),function(){if(!X())throw new Error("Call listen() first.")}(),s.string(e)){i=e;const n=t[0],s=t[t.length-1];let c=0,d=o.ParameterStructures.auto;o.ParameterStructures.is(n)&&(c=1,d=n);let h=t.length;l.CancellationToken.is(s)&&(h-=1,a=s);const u=h-c;switch(u){case 0:r=void 0;break;case 1:r=ge(d,t[c]);break;default:if(d===o.ParameterStructures.byName)throw new Error(`Received ${u} parameters for 'by Name' request parameter structure.`);r=t.slice(c,h).map((e=>de(e)))}}else{const n=t;i=e.method,r=pe(e,n);const s=e.numberOfParams;a=l.CancellationToken.is(n[s])?n[s]:void 0}const c=b++;let d;a&&(d=a.onCancellationRequested((()=>{const e=G.sender.sendCancellation(fe,c);return void 0===e?(w.log(`Received no promise from cancellation strategy when cancelling id ${c}`),Promise.resolve()):e.catch((()=>{w.log(`Sending cancellation messages for id ${c} failed`)}))})));const h={jsonrpc:T,id:c,method:i,params:r};return function(e){if(q!==g.Off&&L)if(W===f.Text){let t;q!==g.Verbose&&q!==g.Compact||!e.params||(t=`Params: ${oe(e.params)}\n\n`),L.log(`Sending request '${e.method} - (${e.id})'.`,t)}else le("send-request",e)}(h),"function"==typeof G.sender.enableCancellation&&G.sender.enableCancellation(h),new Promise((async(e,t)=>{const s={method:i,timerStart:Date.now(),resolve:t=>{e(t),G.sender.cleanup(c),d?.dispose()},reject:e=>{t(e),G.sender.cleanup(c),d?.dispose()}};try{j.set(c,s),await n.write(h)}catch(e){throw j.delete(c),s.reject(new o.ResponseError(o.ErrorCodes.MessageWriteError,e.message?e.message:"Unknown reason")),w.error("Sending request failed."),e}}))},onRequest:(e,t)=>{ce();let n=null;return u.is(e)?(n=void 0,N=e):s.string(e)?(n=null,void 0!==t&&(n=e,D.set(e,{handler:t,type:void 0}))):void 0!==t&&(n=e.method,D.set(e.method,{type:e,handler:t})),{dispose:()=>{null!==n&&(void 0!==n?D.delete(n):N=void 0)}}},hasPendingResponse:()=>j.size>0,trace:async(e,t,n)=>{let i=!1,o=f.Text;void 0!==n&&(s.boolean(n)?i=n:(i=n.sendNotification||!1,o=n.traceFormat||f.Text)),q=e,W=o,L=q===g.Off?void 0:t,!i||Z()||ee()||await fe.sendNotification(m.type,{value:g.toString(e)})},onError:U.event,onClose:z.event,onUnhandledNotification:$.event,onDispose:K.event,end:()=>{n.end()},dispose:()=>{if(ee())return;V=M.Disposed,K.fire(void 0);const t=new o.ResponseError(o.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(const e of j.values())e.reject(t);j=new Map,B=new Map,F=new Set,H=new r.LinkedMap,s.func(n.dispose)&&n.dispose(),s.func(e.dispose)&&e.dispose()},listen:()=>{ce(),function(){if(X())throw new I(_.AlreadyListening,"Connection is already listening")}(),V=M.Listening,e.listen(se)},inspect:()=>{(0,i.default)().console.log("inspect")}};return fe.onNotification(v.type,(e=>{if(q===g.Off||!L)return;const t=q===g.Verbose||q===g.Compact;L.log(e.message,t?e.verbose:void 0)})),fe.onNotification(h.type,(e=>{const t=O.get(e.token);t?t(e.value):J.fire(e)})),fe}},17963:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Disposable=void 0,function(e){e.create=function(e){return{dispose:e}}}(n||(t.Disposable=n={}))},26780:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Emitter=t.Event=void 0;const i=n(34254);var s;!function(e){const t={dispose(){}};e.None=function(){return t}}(s||(t.Event=s={}));class o{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e){if(this._contexts[i]===t)return this._callbacks.splice(i,1),void this._contexts.splice(i,1);n=!0}if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];const t=[],n=this._callbacks.slice(0),s=this._contexts.slice(0);for(let o=0,r=n.length;o<r;o++)try{t.push(n[o].apply(s[o],e))}catch(e){(0,i.default)().console.error(e)}return t}isEmpty(){return!this._callbacks||0===this._callbacks.length}dispose(){this._callbacks=void 0,this._contexts=void 0}}class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new o),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);const i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}t.Emitter=r,r._noop=function(){}},86145:(e,t)=>{"use strict";function n(e){return"string"==typeof e||e instanceof String}function i(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.stringArray=t.array=t.func=t.error=t.number=t.string=t.boolean=void 0,t.boolean=function(e){return!0===e||!1===e},t.string=n,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=function(e){return"function"==typeof e},t.array=i,t.stringArray=function(e){return i(e)&&e.every((e=>n(e)))}},6176:(e,t)=>{"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=t.LinkedMap=t.Touch=void 0,function(e){e.None=0,e.First=1,e.AsOld=e.First,e.Last=2,e.AsNew=e.Last}(i||(t.Touch=i={}));class s{constructor(){this[n]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=i.None){const n=this._map.get(e);if(n)return t!==i.None&&this.touch(n,t),n.value}set(e,t,n=i.None){let s=this._map.get(e);if(s)s.value=t,n!==i.None&&this.touch(s,n);else{switch(s={key:e,value:t,next:void 0,previous:void 0},n){case i.None:this.addItemLast(s);break;case i.First:this.addItemFirst(s);break;case i.Last:default:this.addItemLast(s)}this._map.set(e,s),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){const t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){const n=this._state;let i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){const e=this._state;let t=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:t.key,done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return n}values(){const e=this._state;let t=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:t.value,done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return n}entries(){const e=this._state;let t=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:[t.key,t.value],done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return n}[(n=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(0===e)return void this.clear();let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e,this._state++}addItemLast(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(t===i.First||t===i.Last)if(t===i.First){if(e===this._head)return;const t=e.next,n=e.previous;e===this._tail?(n.next=void 0,this._tail=n):(t.previous=n,n.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===i.Last){if(e===this._tail)return;const t=e.next,n=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=n,n.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}toJSON(){const e=[];return this.forEach(((t,n)=>{e.push([n,t])})),e}fromJSON(e){this.clear();for(const[t,n]of e)this.set(t,n)}}t.LinkedMap=s,t.LRUCache=class extends s{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=i.AsNew){return super.get(e,t)}peek(e){return super.get(e,i.None)}set(e,t){return super.set(e,t,i.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}},92180:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractMessageBuffer=void 0,t.AbstractMessageBuffer=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){const t="string"==typeof e?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(0===this._chunks.length)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){const e=this._chunks[n];for(i=0;i<e.length;){switch(e[i]){case 13:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case 10:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=e.byteLength,n++}if(4!==t)return;const o=this._read(s+i),r=new Map,a=this.toString(o,"ascii").split("\r\n");if(a.length<2)return r;for(let t=0;t<a.length-2;t++){const n=a[t],i=n.indexOf(":");if(-1===i)throw new Error(`Message header must separate key and value using ':'\n${n}`);const s=n.substr(0,i),o=n.substr(i+1).trim();r.set(e?s.toLowerCase():s,o)}return r}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(0===e)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const t=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(t)}if(this._chunks[0].byteLength>e){const t=this._chunks[0],n=this.asNative(t,e);return this._chunks[0]=t.slice(e),this._totalLength-=e,n}const t=this.allocNative(e);let n=0;for(;e>0;){const i=this._chunks[0];if(i.byteLength>e){const s=i.slice(0,e);t.set(s,n),n+=e,this._chunks[0]=i.slice(e),this._totalLength-=e,e-=e}else t.set(i,n),n+=i.byteLength,this._chunks.shift(),this._totalLength-=i.byteLength,e-=i.byteLength}return t}}},79813:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadableStreamMessageReader=t.AbstractMessageReader=t.MessageReader=void 0;const i=n(34254),s=n(86145),o=n(26780),r=n(9931);var a,l;!function(e){e.is=function(e){let t=e;return t&&s.func(t.listen)&&s.func(t.dispose)&&s.func(t.onError)&&s.func(t.onClose)&&s.func(t.onPartialMessage)}}(a||(t.MessageReader=a={}));class c{constructor(){this.errorEmitter=new o.Emitter,this.closeEmitter=new o.Emitter,this.partialMessageEmitter=new o.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${s.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageReader=c,function(e){e.fromOptions=function(e){let t,n;const s=new Map;let o;const r=new Map;if(void 0===e||"string"==typeof e)t=e??"utf-8";else{if(t=e.charset??"utf-8",void 0!==e.contentDecoder&&(n=e.contentDecoder,s.set(n.name,n)),void 0!==e.contentDecoders)for(const t of e.contentDecoders)s.set(t.name,t);if(void 0!==e.contentTypeDecoder&&(o=e.contentTypeDecoder,r.set(o.name,o)),void 0!==e.contentTypeDecoders)for(const t of e.contentTypeDecoders)r.set(t.name,t)}return void 0===o&&(o=(0,i.default)().applicationJson.decoder,r.set(o.name,o)),{charset:t,contentDecoder:n,contentDecoders:s,contentTypeDecoder:o,contentTypeDecoders:r}}}(l||(l={})),t.ReadableStreamMessageReader=class extends c{constructor(e,t){super(),this.readable=e,this.options=l.fromOptions(t),this.buffer=(0,i.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new r.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;const t=this.readable.onData((e=>{this.onData(e)}));return this.readable.onError((e=>this.fireError(e))),this.readable.onClose((()=>this.fireClose())),t}onData(e){try{for(this.buffer.append(e);;){if(-1===this.nextMessageLength){const e=this.buffer.tryReadHeaders(!0);if(!e)return;const t=e.get("content-length");if(!t)return void this.fireError(new Error(`Header must provide a Content-Length property.\n${JSON.stringify(Object.fromEntries(e))}`));const n=parseInt(t);if(isNaN(n))return void this.fireError(new Error(`Content-Length value must be a number. Got ${t}`));this.nextMessageLength=n}const e=this.buffer.tryReadBody(this.nextMessageLength);if(void 0===e)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock((async()=>{const t=void 0!==this.options.contentDecoder?await this.options.contentDecoder.decode(e):e,n=await this.options.contentTypeDecoder.decode(t,this.options);this.callback(n)})).catch((e=>{this.fireError(e)}))}}catch(e){this.fireError(e)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=(0,i.default)().timer.setTimeout(((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())}),this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}},87745:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WriteableStreamMessageWriter=t.AbstractMessageWriter=t.MessageWriter=void 0;const i=n(34254),s=n(86145),o=n(9931),r=n(26780);var a,l;!function(e){e.is=function(e){let t=e;return t&&s.func(t.dispose)&&s.func(t.onClose)&&s.func(t.onError)&&s.func(t.write)}}(a||(t.MessageWriter=a={}));class c{constructor(){this.errorEmitter=new r.Emitter,this.closeEmitter=new r.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${s.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageWriter=c,function(e){e.fromOptions=function(e){return void 0===e||"string"==typeof e?{charset:e??"utf-8",contentTypeEncoder:(0,i.default)().applicationJson.encoder}:{charset:e.charset??"utf-8",contentEncoder:e.contentEncoder,contentTypeEncoder:e.contentTypeEncoder??(0,i.default)().applicationJson.encoder}}}(l||(l={})),t.WriteableStreamMessageWriter=class extends c{constructor(e,t){super(),this.writable=e,this.options=l.fromOptions(t),this.errorCount=0,this.writeSemaphore=new o.Semaphore(1),this.writable.onError((e=>this.fireError(e))),this.writable.onClose((()=>this.fireClose()))}async write(e){return this.writeSemaphore.lock((async()=>this.options.contentTypeEncoder.encode(e,this.options).then((e=>void 0!==this.options.contentEncoder?this.options.contentEncoder.encode(e):e)).then((t=>{const n=[];return n.push("Content-Length: ",t.byteLength.toString(),"\r\n"),n.push("\r\n"),this.doWrite(e,n,t)}),(e=>{throw this.fireError(e),e}))))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}}},44313:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message=t.NotificationType9=t.NotificationType8=t.NotificationType7=t.NotificationType6=t.NotificationType5=t.NotificationType4=t.NotificationType3=t.NotificationType2=t.NotificationType1=t.NotificationType0=t.NotificationType=t.RequestType9=t.RequestType8=t.RequestType7=t.RequestType6=t.RequestType5=t.RequestType4=t.RequestType3=t.RequestType2=t.RequestType1=t.RequestType=t.RequestType0=t.AbstractMessageSignature=t.ParameterStructures=t.ResponseError=t.ErrorCodes=void 0;const i=n(86145);var s,o;!function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.jsonrpcReservedErrorRangeStart=-32099,e.serverErrorStart=-32099,e.MessageWriteError=-32099,e.MessageReadError=-32098,e.PendingResponseRejected=-32097,e.ConnectionInactive=-32096,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.jsonrpcReservedErrorRangeEnd=-32e3,e.serverErrorEnd=-32e3}(s||(t.ErrorCodes=s={}));class r extends Error{constructor(e,t,n){super(t),this.code=i.number(e)?e:s.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){const e={code:this.code,message:this.message};return void 0!==this.data&&(e.data=this.data),e}}t.ResponseError=r;class a{constructor(e){this.kind=e}static is(e){return e===a.auto||e===a.byName||e===a.byPosition}toString(){return this.kind}}t.ParameterStructures=a,a.auto=new a("auto"),a.byPosition=new a("byPosition"),a.byName=new a("byName");class l{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return a.auto}}t.AbstractMessageSignature=l,t.RequestType0=class extends l{constructor(e){super(e,0)}},t.RequestType=class extends l{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.RequestType1=class extends l{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.RequestType2=class extends l{constructor(e){super(e,2)}},t.RequestType3=class extends l{constructor(e){super(e,3)}},t.RequestType4=class extends l{constructor(e){super(e,4)}},t.RequestType5=class extends l{constructor(e){super(e,5)}},t.RequestType6=class extends l{constructor(e){super(e,6)}},t.RequestType7=class extends l{constructor(e){super(e,7)}},t.RequestType8=class extends l{constructor(e){super(e,8)}},t.RequestType9=class extends l{constructor(e){super(e,9)}},t.NotificationType=class extends l{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.NotificationType0=class extends l{constructor(e){super(e,0)}},t.NotificationType1=class extends l{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.NotificationType2=class extends l{constructor(e){super(e,2)}},t.NotificationType3=class extends l{constructor(e){super(e,3)}},t.NotificationType4=class extends l{constructor(e){super(e,4)}},t.NotificationType5=class extends l{constructor(e){super(e,5)}},t.NotificationType6=class extends l{constructor(e){super(e,6)}},t.NotificationType7=class extends l{constructor(e){super(e,7)}},t.NotificationType8=class extends l{constructor(e){super(e,8)}},t.NotificationType9=class extends l{constructor(e){super(e,9)}},function(e){e.isRequest=function(e){const t=e;return t&&i.string(t.method)&&(i.string(t.id)||i.number(t.id))},e.isNotification=function(e){const t=e;return t&&i.string(t.method)&&void 0===e.id},e.isResponse=function(e){const t=e;return t&&(void 0!==t.result||!!t.error)&&(i.string(t.id)||i.number(t.id)||null===t.id)}}(o||(t.Message=o={}))},34254:(e,t)=>{"use strict";let n;function i(){if(void 0===n)throw new Error("No runtime abstraction layer installed");return n}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.install=function(e){if(void 0===e)throw new Error("No runtime abstraction layer provided");n=e}}(i||(i={})),t.default=i},9931:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;const i=n(34254);t.Semaphore=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise(((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()}))}get active(){return this._active}runNext(){0!==this._waiting.length&&this._active!==this._capacity&&(0,i.default)().timer.setImmediate((()=>this.doRunNext()))}doRunNext(){if(0===this._waiting.length||this._active===this._capacity)return;const e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{const t=e.thunk();t instanceof Promise?t.then((t=>{this._active--,e.resolve(t),this.runNext()}),(t=>{this._active--,e.reject(t),this.runNext()})):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}}},46492:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharedArrayReceiverStrategy=t.SharedArraySenderStrategy=void 0;const i=n(63106);var s;!function(e){e.Continue=0,e.Cancelled=1}(s||(s={})),t.SharedArraySenderStrategy=class{constructor(){this.buffers=new Map}enableCancellation(e){if(null===e.id)return;const t=new SharedArrayBuffer(4);new Int32Array(t,0,1)[0]=s.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){const n=this.buffers.get(t);if(void 0===n)return;const i=new Int32Array(n,0,1);Atomics.store(i,0,s.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};class o{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===s.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}}class r{constructor(e){this.token=new o(e)}cancel(){}dispose(){}}t.SharedArrayReceiverStrategy=class{constructor(){this.kind="request"}createCancellationTokenSource(e){const t=e.$cancellationData;return void 0===t?new i.CancellationTokenSource:new r(t)}}}}]);